import{d as I,u as N,r as g,w as O,c as R,a as o,e as V,f as r,h as X,i as p,t as b,b as x,j as q,k as K,l as L,m as P,U as _,R as B,o as A,_ as E,F as Z,y as tt,z as et,n as z,C as at,s as st,D as ot}from"./index-DBm1KP3k.js";import{w as lt,a as nt,b as it,c as ut,d as dt,e as rt,P as mt}from"./index-Bb0WFh3g.js";import{w as pt}from"./index-CVdsFch2.js";import{w as vt}from"./Total-DasP4GI6.js";import{w as ft}from"./index-B0IaA1k1.js";const wt={class:"label"},ct={colspan:"3"},gt={class:"label"},xt={class:"label"},bt={colspan:"3"},kt=I({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(h,{emit:S}){const v=h,$=S,l=N().state,w=l.langs,m=g(!1),y=g("base"),f=g([{label:w.info,value:"base",slot:"base"},{label:w.sys_role_perm,value:"perm",slot:"perm"}]),a=g({id:0,status:!0,name:"",remark:"",perm:""}),s=g({perm:[]});O(()=>v.show,c=>{m.value=c,c&&(a.value.id=v.data.id||0,a.value.name=v.data.name||"",a.value.status=typeof v.data.status<"u"?v.data.status:!0,a.value.remark=v.data.remark||"",a.value.perm=v.data.perm||"",n())},{deep:!0});const n=()=>{B.Post("sys_role/get_perm?lang="+l.lang,{token:l.token,perm:a.value.perm},c=>{const{code:i,data:u}=c.data;i==0&&(s.value.perm=u)})},U=c=>{let i={},u=[];for(let D of c)u=D.split(":"),i[u[0]]?i[u[0]]+=parseInt(u[1]):i[u[0]]=parseInt(u[1]);let C="";for(let D in i)C+=D+":"+i[D].toString()+" ";a.value.perm=C.trim()},k=c=>c.name.length<2||c.name.length>16?_.Toast(w.sys_role_verify_name):c,H=()=>{const c=k(a.value);if(!c)return;const i=_.Loading();B.Post("sys_role/save?lang="+l.lang,{token:l.token,data:c},u=>{i.clear();const C=u.data;_.Toast(C.msg),$("submit",C.code==0)})},W=()=>{$("update:show",!1)};return(c,i)=>(A(),R(V,{show:m.value,"onUpdate:show":i[5]||(i[5]=u=>m.value=u),title:h.title,width:"640px",bottom:"40px",overflow:y.value=="perm"?"hidden auto":"hidden",onClose:i[6]||(i[6]=u=>W())},{bottom:o(()=>[r(P,{height:"40px",padding:"0 32px",onClick:i[4]||(i[4]=u=>H())},{default:o(()=>[L(b(x(w).confirm),1)]),_:1})]),default:o(()=>[r(K,{paddingY:"0"},{default:o(()=>[r(lt,{value:y.value,"onUpdate:value":i[3]||(i[3]=u=>y.value=u),columns:f.value},{base:o(()=>[r(X,null,{default:o(()=>[p("tr",null,[p("td",wt,b(x(w).status),1),p("td",ct,[r(nt,{value:a.value.status,"onUpdate:value":i[0]||(i[0]=u=>a.value.status=u)},null,8,["value"])])]),p("tr",null,[p("td",gt,b(x(w).name),1),p("td",null,[r(q,{value:a.value.name,"onUpdate:value":i[1]||(i[1]=u=>a.value.name=u),maxlength:"16"},null,8,["value"])])]),p("tr",null,[p("td",xt,b(x(w).remark),1),p("td",bt,[r(q,{value:a.value.remark,"onUpdate:value":i[2]||(i[2]=u=>a.value.remark=u),type:"textarea",height:"80px",maxlength:"32"},null,8,["value"])])])]),_:1})]),perm:o(()=>[r(ft,{"onUpdate:value":U,options:s.value.perm},null,8,["options"])]),_:1},8,["value","columns"])]),_:1})]),_:1},8,["show","title","overflow"]))}}),ht=E(kt,[["__scopeId","data-v-7f70b376"]]),yt=["innerHTML"],_t=I({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(h,{emit:S}){const v=h,$=S,l=N().state,w=l.langs,m=g(!1);O(()=>v.show,a=>{m.value=a},{deep:!0});const y=()=>{const a=_.Loading();B.Post("sys_role/del?lang="+l.lang,{token:l.token,data:v.data},s=>{a.clear();const n=s.data;_.Toast(n.msg),$("submit",n.code==0)})},f=()=>{$("update:show",!1)};return(a,s)=>(A(),R(V,{show:m.value,"onUpdate:show":s[1]||(s[1]=n=>m.value=n),title:h.title||x(w).del,width:"360px",bottom:"40px",onClose:s[2]||(s[2]=n=>f())},{bottom:o(()=>[r(P,{effect:"dark",type:"danger",height:"40px",onClick:s[0]||(s[0]=n=>y())},{default:o(()=>[L(b(x(w).confirm),1)]),_:1})]),default:o(()=>[r(K,{lineHeight:"60px"},{default:o(()=>[p("span",{innerHTML:x(w).del_warn(h.data.length)},null,8,yt)]),_:1})]),_:1},8,["show","title"]))}}),$t=["innerHTML"],St=I({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(h,{emit:S}){const v=h,$=S,l=N().state,w=l.langs,m=g(!1);O(()=>v.show,a=>{m.value=a},{deep:!0});const y=()=>{const a=_.Loading();B.Post("sys_role/export?lang="+l.lang,{token:l.token,data:v.data,order:v.order},s=>{a.clear();const n=s.data;_.Toast(n.msg),n.code==0&&Z.Down(n.data.path+n.data.filename,n.data.filename),$("submit",n.code==0)})},f=()=>{$("update:show",!1)};return(a,s)=>(A(),R(V,{show:m.value,"onUpdate:show":s[1]||(s[1]=n=>m.value=n),title:h.title||x(w).export,width:"360px",bottom:"40px",onClose:s[2]||(s[2]=n=>f())},{bottom:o(()=>[r(P,{height:"40px",padding:"0 32px",onClick:s[0]||(s[0]=n=>y())},{default:o(()=>[L(b(x(w).confirm),1)]),_:1})]),default:o(()=>[r(K,{lineHeight:"60px"},{default:o(()=>[p("span",{innerHTML:x(w).export_warn(h.num)},null,8,$t)]),_:1})]),_:1},8,["show","title"]))}}),Tt=["innerHTML"],Ut={class:"app_action flex"},Ct={class:"app_action_tools scrollbar"},Lt={class:"app_action_search flex"},Pt={class:"app_ct"},Dt={class:"tCenter"},At={class:"tCenter"},Bt={key:1},Ht={class:"tCenter"},Mt={class:"app_page"},It=I({__name:"index",setup(h){const S=g(!1),v=g(),T=N().state,l=T.langs,w=mt.isAction,m=g({show:!1,key:"",placeholder:"名称、备注",columns:[{label:l.name,value:"",name:"name"},{label:l.remark,value:"",name:"remark"}]}),y=g({time:"",list:{}}),f=g({columns:[{title:"ID",index:"id",slot:"id",order:"",width:"80px",minWidth:"60px",textAlign:"center"},{title:l.name,index:"name",order:"",width:"120px",minWidth:"80px"},{title:l.sys_role_perm,slot:"perm",width:"90px",textAlign:"center"},{title:l.date,index:"date",slot:"date",width:"120px",minWidth:"110px",textAlign:"center"},{title:l.remark,index:"remark"}],data:[],num:0,total:0,order:""}),a=g({total:0,num:1,limit:100}),s=g({show:!1,type:"",title:"添加/编辑",data:{}}),n=g({show:!1,title:"删除",data:[]}),U=g({show:!1,title:"导出",num:0});tt(()=>{S.value=!0}),et(()=>{S&&k()});const k=()=>{m.value.show=!1,f.value.data=[];const d=_.Loading();B.Post("sys_role/list?lang="+T.lang,{token:T.token,data:H(),page:a.value.num,limit:a.value.limit,order:f.value.order},t=>{d.clear();const{code:e,msg:M,time:j,data:F}=t.data;e===0?(y.value.time=j,f.value.data=F,u()):_.Toast(M)}),a.value.total=0,B.Post("sys_role/total?lang="+T.lang,{token:T.token,data:H()},t=>{const{code:e,msg:M,time:j,data:F}=t.data;e==0?(y.value.time=j,a.value.total=F.total):_.Toast(M)})},H=()=>{const d={key:m.value.key};for(let t of m.value.columns)t.name&&(d[t.name]=t.value);return d},W=(d,t)=>{f.value.num=d,f.value.total=t},c=d=>{f.value.order=d,k()},i=()=>{m.value.key="";for(let d of m.value.columns)d.value="";f.value.order="",a.value.num=1,k()},u=()=>{ot(()=>{v.value.checkboxAll(!1)})},C=(d,t)=>{s.value.show=!0,s.value.type=d,d=="add"?(s.value.title=l.add,s.value.data={}):d=="edit"&&(s.value.title=l.edit+"( "+t.name+" )",s.value.data=t)},D=d=>{d&&(s.value.show=!1,k())},Y=()=>{n.value.show=!0;const d=v.value.getData();let t=[];for(let e of d)t.push(e.id);n.value.data=t},G=d=>{d&&(n.value.show=!1,k())},J=d=>{U.value.show=!0,U.value.num=d},Q=d=>{d&&(U.value.show=!1,u())};return(d,t)=>(A(),z(st,null,[r(vt,{time:y.value.time,onRefresh:t[0]||(t[0]=e=>k())},{default:o(()=>[p("span",{innerHTML:x(l).sys_role_total(a.value.total)},null,8,Tt)]),_:1},8,["time"]),p("div",Ut,[p("div",Ct,[r(it,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0}]},{add:o(()=>[r(P,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:t[1]||(t[1]=e=>C("add"))},{default:o(()=>[L(b(x(l).add),1)]),_:1})]),del:o(()=>[r(P,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:f.value.num==0,onClick:t[2]||(t[2]=e=>Y())},{default:o(()=>[L(b(x(l).del)+"("+b(f.value.num)+")",1)]),_:1},8,["disabled"])]),line:o(()=>t[20]||(t[20]=[p("span",{class:"line"},"|",-1)])),export:o(()=>[r(P,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!a.value.total,onClick:t[3]||(t[3]=e=>J(a.value.total))},{default:o(()=>[L(b(x(l).export)+"("+b(a.value.total)+")",1)]),_:1},8,["disabled"])]),_:1})]),p("div",Lt,[r(ut,{show:m.value.show,"onUpdate:show":t[4]||(t[4]=e=>m.value.show=e),keys:m.value.key,"onUpdate:keys":t[5]||(t[5]=e=>m.value.key=e),columns:m.value.columns,onKeyup:t[6]||(t[6]=at(e=>k(),["enter"])),onSearch:t[7]||(t[7]=e=>k()),onReset:t[8]||(t[8]=e=>i())},null,8,["show","keys","columns"])])]),p("div",Pt,[r(dt,{ref_key:"tableList",ref:v,overflow:"auto",columns:f.value.columns,options:f.value.data,onOrderBy:c,onPartially:W},{id:o(e=>[p("div",Dt,b(e.id),1)]),perm:o(e=>[p("div",At,[x(w)("save")?(A(),R(P,{key:0,onClick:M=>C("edit",e)},{default:o(()=>[L(b(x(l).edit),1)]),_:2},1032,["onClick"])):(A(),z("span",Bt,"-"))])]),date:o(e=>[p("div",Ht,[r(pt,{title:"创建: "+e.ctime+`
更新: `+e.utime},{default:o(()=>[L(b(e.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),_:1},8,["columns","options"])]),p("div",Mt,[r(rt,{total:a.value.total,"onUpdate:total":t[9]||(t[9]=e=>a.value.total=e),page:a.value.num,"onUpdate:page":[t[10]||(t[10]=e=>a.value.num=e),t[11]||(t[11]=e=>k())],limit:a.value.limit,"onUpdate:limit":[t[12]||(t[12]=e=>a.value.limit=e),t[13]||(t[13]=e=>{a.value.num=1,k()})]},null,8,["total","page","limit"])]),r(ht,{show:s.value.show,"onUpdate:show":t[14]||(t[14]=e=>s.value.show=e),title:s.value.title,data:s.value.data,onSubmit:t[15]||(t[15]=e=>D(e))},null,8,["show","title","data"]),r(_t,{show:n.value.show,"onUpdate:show":t[16]||(t[16]=e=>n.value.show=e),data:n.value.data,onSubmit:t[17]||(t[17]=e=>G(e))},null,8,["show","data"]),r(St,{show:U.value.show,"onUpdate:show":t[18]||(t[18]=e=>U.value.show=e),data:H(),order:f.value.order,num:U.value.num,onSubmit:t[19]||(t[19]=e=>Q(e))},null,8,["show","data","order","num"])],64))}}),Ot=E(It,[["__scopeId","data-v-8237c4a4"]]);export{Ot as default};
