import{d as ie,u as ue,r as D,w as pe,c as se,a as t,e as le,f as r,h as Le,i as s,j as _e,k as ae,l as h,t as n,b as k,m as M,U as w,R as K,o as v,G as he,F as ye,n as g,s as Q,E as ke,D as we,M as ne,N as We,O as Pe,A as Ce,B as oe,L as be,x as Ae,K as Ie,_ as $e,I as Te,T as O,y as Be,z as Ye,H as He,v as Re}from"./index--Aaw8Kh1.js";import{c as ve,P as Se,w as Me,a as Ne,b as Fe}from"./Search-DMryvUDg.js";import{w as je}from"./Total-C1JsSOot.js";import{P as Ve}from"./PrintGoods-H0ebf_0s.js";import{w as Ue}from"./index-9lX5YKhj.js";import{w as De}from"./index-CONZkG9F.js";import"./index-QqPnWr-n.js";const Ee=ie({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,T=ue().state,L=T.langs,U=D(!1),o=D({tp:"",id:"",type:"",wms_co_id:"",brand:"",remark:""}),x=D({type_name:[],partner_name:[],brand_name:[]});pe(()=>y.show,b=>{U.value=b,b&&(o.value.tp=y.data.tp||"",o.value.id=y.data.id||"",o.value.remark=y.data.remark||"",W())},{deep:!0});const W=()=>{K.Post("erp_purchase_in/get_select?lang="+T.lang,{token:T.token},b=>{const{code:S,msg:H,data:N}=b.data;S==0?(x.value.type_name=N.type_name,x.value.partner_name=N.partner_name,x.value.brand_name=N.brand_name,y.data.tp=="edit"&&he(()=>{o.value.type=[parseInt(y.data.type)],o.value.wms_co_id=[parseInt(y.data.wms_co_id)],o.value.brand=[y.data.brand]})):w.Toast(H)})},_=b=>!b.wms_co_id||b.wms_co_id.length==0?w.Toast("请选择采购仓库"):!b.type||b.type.length==0?w.Toast("请选择采购类型"):!b.brand||b.brand.length==0?w.Toast("请选择品牌"):b,p=()=>{const b=_(o.value);if(!b)return;const S=w.Loading();K.Post("erp_purchase_in/save?lang="+T.lang,{token:T.token,data:b},H=>{S.clear();const{code:N,msg:P}=H.data;w.Toast(P),E("submit",N==0)})},i=()=>{E("update:show",!1)};return(b,S)=>(v(),se(le,{show:U.value,"onUpdate:show":S[5]||(S[5]=H=>U.value=H),title:Y.title,width:"620px",bottom:"40px",onClose:S[6]||(S[6]=H=>i())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:S[4]||(S[4]=H=>p())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(ae,null,{default:t(()=>[r(Le,null,{default:t(()=>[s("tr",null,[S[7]||(S[7]=s("td",{class:"label"},[s("span",{class:"red_dot"},"采购仓库")],-1)),s("td",null,[r(ve,{value:o.value.wms_co_id,"onUpdate:value":S[0]||(S[0]=H=>o.value.wms_co_id=H),options:x.value.partner_name,disabled:o.value.tp=="edit"},null,8,["value","options","disabled"])])]),s("tr",null,[S[8]||(S[8]=s("td",{class:"label"},[s("span",{class:"red_dot"},"采购类型")],-1)),s("td",null,[r(ve,{value:o.value.type,"onUpdate:value":S[1]||(S[1]=H=>o.value.type=H),options:x.value.type_name},null,8,["value","options"])])]),s("tr",null,[S[9]||(S[9]=s("td",{class:"label"},[s("span",{class:"red_dot"},"品牌")],-1)),s("td",null,[r(ve,{value:o.value.brand,"onUpdate:value":S[2]||(S[2]=H=>o.value.brand=H),options:x.value.brand_name},null,8,["value","options"])])]),s("tr",null,[S[10]||(S[10]=s("td",{class:"label"},"备注",-1)),s("td",null,[r(_e,{value:o.value.remark,"onUpdate:value":S[3]||(S[3]=H=>o.value.remark=H),type:"textarea",height:"160px"},null,8,["value"])])])]),_:1})]),_:1})]),_:1},8,["show","title"]))}}),Oe=["innerHTML"],Ke=ie({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,T=ue().state,L=T.langs,U=D(!1);pe(()=>y.show,W=>{U.value=W},{deep:!0});const o=()=>{const W=w.Loading();K.Post("erp_purchase_in/del?lang="+T.lang,{token:T.token,data:y.data},_=>{W.clear();const{code:p,msg:i}=_.data;w.Toast(i),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,_)=>(v(),se(le,{show:U.value,"onUpdate:show":_[1]||(_[1]=p=>U.value=p),title:Y.title||k(L).del,width:"360px",bottom:"40px",onClose:_[2]||(_[2]=p=>x())},{bottom:t(()=>[r(M,{effect:"dark",type:"danger",height:"40px",onClick:_[0]||(_[0]=p=>o())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[s("span",{innerHTML:k(L).del_warn(Y.data.length)},null,8,Oe)]),_:1})]),_:1},8,["show","title"]))}}),ze=["innerHTML"],Ge=ie({__name:"push",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,T=ue().state,L=T.langs,U=D(!1);pe(()=>y.show,W=>{U.value=W},{deep:!0});const o=()=>{const W=w.Loading();K.Post("erp_purchase_in/push?lang="+T.lang,{token:T.token,data:y.data},_=>{W.clear();const{code:p,msg:i}=_.data;w.Toast(i),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,_)=>(v(),se(le,{show:U.value,"onUpdate:show":_[1]||(_[1]=p=>U.value=p),title:Y.title,width:"480px",bottom:"40px",onClose:_[2]||(_[2]=p=>x())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=p=>o())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(Ue,null,{default:t(()=>_[3]||(_[3]=[h("提醒: 扫货完成，将推送库房验收")])),_:1}),r(ae,{lineHeight:"60px"},{default:t(()=>[s("div",{class:"tCenter",innerHTML:Y.info,style:{"word-wrap":"break-word"}},null,8,ze)]),_:1})]),_:1},8,["show","title"]))}}),qe=["innerHTML"],Je=ie({__name:"revoke",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,T=ue().state,L=T.langs,U=D(!1);pe(()=>y.show,W=>{U.value=W},{deep:!0});const o=()=>{const W=w.Loading();K.Post("erp_purchase_in/revoke?lang="+T.lang,{token:T.token,data:y.data},_=>{W.clear();const{code:p,msg:i}=_.data;w.Toast(i),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,_)=>(v(),se(le,{show:U.value,"onUpdate:show":_[1]||(_[1]=p=>U.value=p),title:Y.title,width:"600px",bottom:"40px",onClose:_[2]||(_[2]=p=>x())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=p=>o())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(Ue,null,{default:t(()=>_[3]||(_[3]=[h("提醒: 将撤回以下单据")])),_:1}),r(ae,{lineHeight:"60px",class:"tCenter"},{default:t(()=>[s("div",{class:"tCenter",innerHTML:Y.info,style:{"word-wrap":"break-word"}},null,8,qe)]),_:1})]),_:1},8,["show","title"]))}}),Qe=["innerHTML"],Xe=ie({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,T=ue().state,L=T.langs,U=D(!1);pe(()=>y.show,W=>{U.value=W},{deep:!0});const o=()=>{const W=w.Loading();K.Post("erp_purchase_in/export?lang="+T.lang,{token:T.token,data:y.data,order:y.order},_=>{W.clear();const{code:p,msg:i,data:b}=_.data;w.Toast(i),p==0&&ye.Down(b.path+b.filename,b.filename),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,_)=>(v(),se(le,{show:U.value,"onUpdate:show":_[1]||(_[1]=p=>U.value=p),title:Y.title||k(L).export,width:"360px",bottom:"40px",onClose:_[2]||(_[2]=p=>x())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=p=>o())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[s("span",{innerHTML:k(L).export_warn(Y.num)},null,8,Qe)]),_:1})]),_:1},8,["show","title"]))}}),Ze={class:"goods_info flex"},et={class:"goods_info_tools flex"},tt={class:"goods_info_total"},st={class:"tCenter"},lt={class:"tCenter"},at={class:"flex_center"},ot={class:"flex_center"},nt={class:"flex_center"},it={key:0,class:"c_success"},ut={key:1,class:"c_info"},dt={key:2,class:"c_info"},rt=ie({__name:"import",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,T=ue().state,L=T.langs,U=D(!1),o=D({key:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"40px",textAlign:"center"},{title:"商品编码",index:"sku_id"},{title:"数量",slot:"num",textAlign:"center",width:"80px",minWidth:"80px"},{title:"操作",slot:"action",textAlign:"center",width:"80px",minWidth:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"status",textAlign:"center",width:"80px"}],list:[],num:0});D({show:!1,title:"新增商品",cost_price:"0.00",supply_price:"0.00",sale_price:"0.00",purchase_price:"0.00",supplier_price:"0.00",market_price:"0.00",weight:"0.00",unit:"个",sku_id:"",labels:"",name:"",category:"",properties_value:"",brand:"",short_name:"",i_id:"",owner:"",supplier_name:""});const x=D({show:!1,type:"",title:"移除",info:"",index:0});pe(()=>y.show,P=>{U.value=P},{deep:!0});const W=()=>{const P=o.value.key.trim().toUpperCase();if(P.length==0)return;const $=P.split(" ");for(let A of $){if(A=ne.LTrim(A,"0"),p(A)){w.Toast("[ "+A+" ]已存在!");continue}o.value.list.unshift({sku_id:A,num:1})}o.value.key="",i()},_=()=>{ye.Select({mimeType:[]},P=>{ye.FileToBase64(P,$=>{const A=We($,{type:"binary"}),V=A.SheetNames[0],G=Pe.sheet_to_json(A.Sheets[V],{raw:!1});if(G.length>3e3)return w.Toast("不能超过3000条");let X="";for(let ee of G){if(!ee.商品编码||!ee.数量){w.Toast("必须存在“商品编码”、“数量”");continue}if(X=ne.LTrim(ne.Trim(ee.商品编码).toUpperCase(),"0"),p(X)){w.Toast("[ "+X+" ]已存在!");continue}o.value.list.push({sku_id:X,num:ee.数量})}i()},"blob")})},p=P=>{for(let $ of o.value.list)if(P==$.sku_id)return!0;return!1},i=()=>{const P=o.value.list;o.value.num=0;for(let $ of P)o.value.num+=parseInt($.num)},b=(P,$=0)=>{if(o.value.list.length==0)return w.Toast("无商品资料!");x.value.show=!0,x.value.type=P,P=="all"?(x.value.title="清空",x.value.info="移除全部资料"):(P="one")&&(x.value.title="移除",x.value.info=o.value.list[$].sku_id,x.value.index=$)},S=()=>{x.value.show=!1,x.value.type=="all"?o.value.list=[]:x.value.type=="one"&&o.value.list.splice(x.value.index,1),i()},H=()=>{if(o.value.list.length<1)return w.Toast("暂无导入数据!");const P=w.Loading();K.Post("erp_purchase_in/goods_safety?lang="+T.lang,{token:T.token,wms_co_id:y.data.wms_co_id,data:o.value.list},$=>{P.clear();const{code:A,msg:V,data:G}=$.data;A===0?(E("submit",o.value.list),o.value.num=0,o.value.list=[],N()):A===5e3?(w.Toast(V),o.value.list=G||[]):w.Toast(V)})},N=()=>{E("update:show",!1)};return(P,$)=>(v(),g(Q,null,[r(le,{show:U.value,"onUpdate:show":$[5]||($[5]=A=>U.value=A),title:Y.title,width:"720px",top:"56px",bottom:"40px",overflow:"hidden auto",onClose:$[6]||($[6]=A=>N())},{top:t(()=>[s("div",Ze,[s("ul",et,[s("li",null,[r(_e,{value:o.value.key,"onUpdate:value":$[0]||($[0]=A=>o.value.key=A),onKeyup:$[1]||($[1]=we(A=>W(),["enter"])),onTextClick:$[2]||($[2]=A=>_()),text:"选择文件",textColor:"#0064C8",placeholder:"商品编码，多条空格分隔",width:"320px",padding:"0 40px 0 10px"},null,8,["value"])]),s("li",null,[r(M,{type:"danger",effect:"text",padding:"0 4px",onClick:$[3]||($[3]=A=>b("all"))},{default:t(()=>$[9]||($[9]=[h("清空")])),_:1})])]),s("div",tt,[$[10]||($[10]=h(" 数量: ")),s("b",null,n(o.value.num),1)])])]),bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:$[4]||($[4]=A=>H())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref:"tableList",columns:o.value.columns,options:o.value.list,isCheckbox:!1},{index:t(A=>[s("div",st,n(A.index+1),1)]),num:t(A=>[s("div",lt,n(A.num),1)]),action:t(A=>[s("div",at,[r(M,{type:"danger",effect:"text",padding:"0 4px",onClick:V=>b("one",A.index)},{default:t(()=>[h(n(k(L).remove),1)]),_:2},1032,["onClick"])])]),view:t(A=>[s("div",ot,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:V=>{k(T).goods.show=!0,k(T).goods.sku_id=A.sku_id}},{default:t(()=>[h(n(k(L).goods_flow),1)]),_:2},1032,["onClick"])])]),status:t(A=>[s("div",nt,[A.status===!0?(v(),g("span",it,"可用")):A.status===!1?(v(),g("span",ut,n(A.status_name),1)):(v(),g("span",dt,"-"))])]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),r(le,{show:x.value.show,"onUpdate:show":$[8]||($[8]=A=>x.value.show=A),title:x.value.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[r(M,{effect:"dark",type:"danger",height:"40px",onClick:$[7]||($[7]=A=>S())},{default:t(()=>[h(n(k(L).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[h(n(x.value.info),1)]),_:1})]),_:1},8,["show","title"])],64))}}),pt={class:"goods_info flex"},mt={class:"goods_info_tools flex"},ct={key:0},vt={key:1},_t={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 630px)"}},ft={class:"tCenter"},gt={class:"flex_center"},xt=["onClick"],ht=["onClick"],kt={class:"tCenter"},wt={class:"tCenter"},yt={class:"tRight"},bt={key:0},$t={key:1},Ct={key:1},At={class:"tRight"},Tt={key:0},St={key:1},Ut={key:1},Dt={class:"tRight"},Lt={key:0},Wt={key:1},Pt={key:1},It={class:"tCenter"},Bt={class:"tCenter"},Yt={class:"tCenter"},Ht={key:1},Rt={class:"tCenter"},Mt={class:"tCenter"},Nt={class:"tCenter"},Ft={key:0,class:"flex_center status2"},jt={key:1,class:"tCenter"},Vt={class:"tCenter"},Et={class:"tCenter"},Ot={class:"flex_center"},Kt={key:0,class:"c_danger"},zt={key:1,class:"c_success"},Gt=["title"],qt={class:"tCenter color1"},Jt=ie({__name:"goods",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,j=D(),L=ue().state,U=L.langs,o=be.priceEncode,x=Se.isAction,W=D(!1);let _=null,p=[];const i=D({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:U.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",order:"",width:"150px",minWidth:"150px"},{title:"暗码",slot:"short_name",index:"short_name",order:"",textAlign:"center",width:"80px"},{title:"款式编码",slot:"i_id",index:"i_id",order:"",textAlign:"center",width:"80px"},{title:"商品名称",index:"name",order:"",width:"80px"},{title:"颜色及规格",index:"properties_value",order:""},{title:"供应链价(元)",slot:"supply_price",index:"supply_price",order:"",textAlign:"center",width:"100px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px"},{title:"重量",slot:"weight",index:"weight",order:"",textAlign:"center",width:"60px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"折扣",slot:"ratio",index:"ratio",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"标签",slot:"labels",index:"labels",order:"",textAlign:"center",width:"80px"},{title:"分类",slot:"category",index:"category",order:"",textAlign:"center",width:"80px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"采购员",slot:"owner",index:"owner",order:"",textAlign:"center",width:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作",slot:"action",textAlign:"center",width:"60px",minWidth:"60px"},{title:"时间",slot:"utime",index:"utime",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作员",slot:"operator_name",index:"operator_name",order:"",textAlign:"center",width:"60px",minWidth:"60px"}],list:[],cost_price:0,sale_price:0,purchase_price:0,market_price:0,num:0,print:0,total:0,is_sku:{label:"校对商品",value:"is_sku",checked:!0},remove:{show:!1,type:"",title:"",info:"",data:[]},refresh:!1}),b=D({show:!1,title:"导入"}),S=D(!1),H=D(0),N=D([]);pe(()=>y.show,f=>{W.value=f,f&&(i.value.key="",i.value.refresh=!1,V())},{deep:!0});const P=(f,d)=>{i.value.print=f,i.value.total=d},$=f=>{i.value.order=f,V()},A=()=>{const f=ne.LTrim(i.value.key.trim().toUpperCase(),"0");if(i.value.key="",y.data.status==0){if(f.length==0)return;X([{sku_id:f,num:1}])}else V(f)},V=(f="")=>{i.value.list=[],G(!1);const d=w.Loading();K.Post("erp_purchase_in/goods_list?lang="+L.lang,{token:L.token,id:y.data.id,order:i.value.order,sku_id:f},e=>{d.clear();const{code:C,msg:I,data:J}=e.data;C==0?(i.value.list=J,Z(),G(!1)):w.Toast(I)})},G=f=>{const d=i.value.list;i.value.cost_price=0,i.value.sale_price=0,i.value.purchase_price=0,i.value.market_price=0,i.value.num=0;const e=d.length-1,C=e>=0?d[e].sku_id:"";let I=0,J=0;for(let m of d)m.ratio&&(I=parseInt(m.num),J=parseFloat(m.ratio),i.value.cost_price+=parseFloat(m.cost_price)*I*J,i.value.sale_price+=parseFloat(m.sale_price)*I*J,i.value.purchase_price+=parseFloat(m.purchase_price)*I*J,i.value.market_price+=parseFloat(m.market_price)*I*J,i.value.num+=I,m.is_date=C.substring(0,7)!=m.sku_id.substring(0,7));f&&(i.value.refresh=!0)},X=(f,d="")=>{for(let e of f){const C=ee(e.sku_id);if(i.value.is_sku.checked&&C)return w.Toast("[ "+e.sku_id+" ]已存在",5e3,"danger");if(C)for(let I of i.value.list)I.sku_id==e.sku_id&&(I.num+=parseInt(e.num),e.num=I.num,w.Toast("[ "+e.sku_id+" ]数量 "+I.num+" "));else i.value.list.unshift({id:"s"+e.sku_id,sku_id:e.sku_id,num:e.num,loading:0})}d==="import"?me(f):(p.push(f[0]),clearTimeout(_),_=setTimeout(()=>{me(p),p=[]},1e3))},ee=f=>{let d=!1;for(let e of i.value.list)e.sku_id==f&&(d=!0);return d},me=f=>{K.Post("erp_purchase_in/goods_add?lang="+L.lang,{token:L.token,id:y.data.id,ctime:y.data.ctime,wms_co_id:y.data.wms_co_id,data:f},d=>{const{code:e,msg:C,data:I}=d.data;e==0?(de(I),G(!0)):(w.Toast(C,5e3,"danger"),de(I))},()=>{de(f,!0)})},de=(f,d=!1)=>{if(f.length==0)return;const e=i.value.list;for(let C in f){f[C].brand!=y.data.brand&&w.Toast("[ "+f[C].sku_id+" ]品牌为“"+f[C].brand+"”不等于“"+y.data.brand+"”",5e3,"danger");for(let I in e)if(e[I].sku_id==f[C].sku_id){d?e[I].loading=1:e[I]=f[C];continue}}},fe=(f,d,e)=>{const C=parseInt(f);if(C.toString()=="NaN")return w.Toast("请输入数字");for(let I of i.value.list)I.sku_id==e&&(I.num=C);K.Post("erp_purchase_in/goods_num?lang="+L.lang,{token:L.token,id:d,num:C,sku_id:e,pid:y.data.id,ctime:y.data.ctime,wms_co_id:y.data.wms_co_id},I=>{const{code:J,msg:m}=I.data;J==0?(w.Toast(m),G(!0)):w.Toast(m,5e3,"danger")})},ce=(f,d={})=>{if(i.value.remove.type=f,i.value.remove.data=[],f=="one")i.value.remove.show=!0,i.value.remove.title='移除" '+d.sku_id+' "',i.value.remove.info="是否移除单条数据?",i.value.remove.data=[{index:d.index,id:d.id,sku_id:d.sku_id,num:d.num}];else if(f=="part"){const e=j.value.getData();if(e.length==0)return w.Toast("请选择数据");i.value.remove.show=!0,i.value.remove.title="移除选中",i.value.remove.info="是否移除选中数据?";for(let C of e)i.value.remove.data.unshift({index:C.index,id:C.id,sku_id:C.sku_id,num:C.num})}},ge=()=>{i.value.remove.show=!1;const f=i.value.remove.data,d=i.value.list;let e=[];for(let I of f){if(I.id.toString().substring(0,1)=="s"){d.splice(I.index,1),G(!0);continue}e.push({index:I.index,id:I.id,sku_id:I.sku_id,num:I.num})}if(e.length==0)return;const C=w.Loading();K.Post("erp_purchase_in/goods_remove?lang="+L.lang,{token:L.token,id:y.data.id,ctime:y.data.ctime,wms_co_id:y.data.wms_co_id,data:e},I=>{C.clear();const{code:J,msg:m}=I.data;if(J==0){if(i.value.remove.type=="all")i.value.list=[];else for(let u of e)d.splice(u.index,1);G(!0)}else w.Toast(m,5e3,"danger")})},R=()=>{b.value.show=!0,b.value.title="导入"},c=f=>{f.length<1||X(f,"import")},l=f=>{let d=[],e=0;for(let C of i.value.list)C.img&&(C.img==f&&(H.value=e),d.push({label:C.sku_id,value:C.img,other:{颜色及规格:C.properties_value,标签价:C.sale_price+"元",吊牌价:C.market_price+"W"}}),e++);S.value=!0,N.value=d},F=(f,d)=>{const e=j.value.getData();let C="";for(let I in e)C+=e[I][f]+" ";C?ne.CopyText(C):ne.CopyText(d)},q=()=>{if(i.value.print<=0)return w.Toast("请选择!");const f=j.value.getData();let d=[];for(let e of f)d.push({sku_id:e.sku_id});if(d.length==0)return w.Toast("请选择!");L.print.sku=d,L.print.show=!0},Z=()=>{he(()=>{j.value.checkboxAll(!1)})},re=()=>{for(let f of i.value.list)if(f.brand!=y.data.brand&&w.Toast("[ "+f.sku_id+" ]品牌为“"+f.brand+"”不等于“"+y.data.brand+"”",5e3,"danger"),f.loading==0||f.loading==1)return w.Toast("["+f.sku_id+"]未加载完成!");if(i.value.refresh){const f=w.Loading();K.Post("erp_purchase_in/goods_price?lang="+L.lang,{token:L.token,id:y.data.id,ctime:y.data.ctime},d=>{f.clear();const{code:e,msg:C}=d.data;e!==0&&w.Toast(C,5e3,"danger"),E("update:show",!1),E("submit",i.value.refresh)})}else E("update:show",!1),E("submit",i.value.refresh)};return(f,d)=>(v(),g(Q,null,[r(le,{show:W.value,"onUpdate:show":d[6]||(d[6]=e=>W.value=e),title:Y.title,width:"calc(100% - 40px)",top:"56px",bottom:"0px",overflow:"auto",bgClose:!1,onClose:d[7]||(d[7]=e=>re())},{top:t(()=>[s("div",pt,[s("ul",mt,[s("li",null,[r(_e,{value:i.value.key,"onUpdate:value":d[0]||(d[0]=e=>i.value.key=e),onKeyup:d[1]||(d[1]=we(e=>A(),["enter"])),onIconClick:d[2]||(d[2]=e=>A()),placeholder:k(L).langs.sku_id,maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value","placeholder"])]),Y.data.status==0?(v(),g(Q,{key:0},[s("li",null,[r(Ie,{options:i.value.is_sku},null,8,["options"])]),k(x)("save")?(v(),g("li",ct,[r(M,{type:"danger",effect:"text",padding:"0 4px",onClick:d[3]||(d[3]=e=>ce("part"))},{default:t(()=>d[13]||(d[13]=[h("移除")])),_:1})])):oe("",!0),d[15]||(d[15]=s("li",null,"|",-1)),k(x)("goods_imp")?(v(),g("li",vt,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:d[4]||(d[4]=e=>R())},{default:t(()=>d[14]||(d[14]=[h("导入")])),_:1})])):oe("",!0),d[16]||(d[16]=s("li",null,"|",-1))],64)):oe("",!0),s("li",null,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:d[5]||(d[5]=e=>q())},{default:t(()=>[h("打印标签("+n(i.value.print)+")",1)]),_:1})])]),s("div",_t,[d[17]||(d[17]=h(" 标签价: ")),s("b",null,n(k(o)(i.value.sale_price)),1),d[18]||(d[18]=h(" 元   吊牌价: ")),s("b",null,n(k(o)(i.value.market_price)),1),d[19]||(d[19]=h(" W   数量: ")),s("b",null,n(i.value.num),1)])])]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref_key:"tableList",ref:j,columns:i.value.columns,options:i.value.list,onOrderBy:$,onPartially:P,maxLen:100},{index:t(e=>[s("div",ft,n(i.value.list.length-e.index),1)]),img:t(e=>[s("div",gt,[s("span",{onClick:C=>e.img?l(e.img):""},[r(De,{img:e.img?e.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,xt)])]),sku_id:t(e=>[s("div",{class:Ae(["copy",e.is_date?"c_danger":"c_primary"])},[h(n(e.sku_id),1),s("span",{onClick:C=>F("sku_id",e.sku_id)},"复",8,ht)],2)]),short_name:t(e=>[s("div",kt,n(e.short_name||"-"),1)]),i_id:t(e=>[s("div",wt,n(e.i_id||"-"),1)]),supply_price:t(e=>[s("div",yt,[e.supply_price>0?(v(),g(Q,{key:0},[e.ratio!="1.00"?(v(),g("span",bt,[s("del",null,n(k(o)(e.supply_price)),1),d[20]||(d[20]=h()),s("b",null,n(k(o)(e.supply_price*e.ratio)),1)])):(v(),g("b",$t,n(k(o)(e.supply_price)),1))],64)):(v(),g("span",Ct,"-"))])]),sale_price:t(e=>[s("div",At,[e.sale_price>0?(v(),g(Q,{key:0},[e.ratio!="1.00"?(v(),g("span",Tt,[s("del",null,n(k(o)(e.sale_price)),1),d[21]||(d[21]=h()),s("b",null,n(k(o)(e.sale_price*e.ratio)),1)])):(v(),g("b",St,n(k(o)(e.sale_price)),1))],64)):(v(),g("span",Ut,"-"))])]),market_price:t(e=>[s("div",Dt,[e.market_price>0?(v(),g(Q,{key:0},[e.ratio!="1.00"?(v(),g("span",Lt,[s("del",null,n(k(o)(e.market_price)),1),d[22]||(d[22]=h()),s("b",null,n(k(o)(e.market_price*e.ratio)),1)])):(v(),g("b",Wt,n(k(o)(e.market_price)),1))],64)):(v(),g("span",Pt,"-"))])]),unit:t(e=>[s("div",It,n(e.unit||"-"),1)]),weight:t(e=>[s("div",Bt,n(e.weight||"-"),1)]),num:t(e=>[s("div",Yt,[Y.data.status==0&&e.loading!=0?(v(),se(_e,{key:0,value:e.num,"onUpdate:value":C=>e.num=C,"onUpdate:blur":C=>fe(C,e.id,e.sku_id),inputAlign:"center"},null,8,["value","onUpdate:value","onUpdate:blur"])):(v(),g("span",Ht,[s("b",null,n(e.num||"-"),1)]))])]),ratio:t(e=>[s("div",Rt,n(e.ratio||"-"),1)]),labels:t(e=>[s("div",Mt,n(e.labels||"-"),1)]),category:t(e=>[s("div",Nt,n(e.category||"-"),1)]),brand:t(e=>[e.brand!=Y.data.brand?(v(),g("div",Ft,n(e.brand||">"),1)):(v(),g("div",jt,n(e.brand||">"),1))]),owner:t(e=>[s("div",Vt,n(e.owner||"-"),1)]),view:t(e=>[s("div",Et,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:C=>{k(L).goods.show=!0,k(L).goods.sku_id=e.sku_id}},{default:t(()=>[h(n(k(U).goods_flow),1)]),_:2},1032,["onClick"])])]),action:t(e=>[s("div",Ot,[Y.data.status==0?(v(),g(Q,{key:0},[e.loading==0?(v(),se(M,{key:0,type:"warning",effect:"text",padding:"0 4px"},{default:t(()=>d[23]||(d[23]=[h("加载中")])),_:1})):e.loading==1?(v(),se(M,{key:1,type:"success",effect:"text",padding:"0 4px",onClick:C=>me([{id:e.id,sku_id:e.sku_id,num:e.num}])},{default:t(()=>d[24]||(d[24]=[h("刷新")])),_:2},1032,["onClick"])):oe("",!0),e.loading!=0?(v(),se(M,{key:2,type:"danger",effect:"text",padding:"0 4px",onClick:C=>ce("one",e)},{default:t(()=>d[25]||(d[25]=[h("移除")])),_:2},1032,["onClick"])):oe("",!0)],64)):(v(),g(Q,{key:1},[e.status==0?(v(),g("span",Kt,"待入库")):e.status==1?(v(),g("span",zt,"完成")):oe("",!0)],64))])]),utime:t(e=>[s("div",{class:"tCenter color1",title:"创建: "+e.ctime+`
更新: `+e.utime},n(e.ctime?e.ctime.substr(11,8):"-"),9,Gt)]),operator_name:t(e=>[s("div",qt,n(e.operator_name||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),r(le,{show:i.value.remove.show,"onUpdate:show":d[9]||(d[9]=e=>i.value.remove.show=e),title:i.value.remove.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[r(M,{effect:"dark",type:"danger",height:"40px",onClick:d[8]||(d[8]=e=>ge())},{default:t(()=>[h(n(k(U).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[h(n(i.value.remove.info),1)]),_:1})]),_:1},8,["show","title"]),r(rt,{show:b.value.show,"onUpdate:show":d[10]||(d[10]=e=>b.value.show=e),title:b.value.title,data:{wms_co_id:y.data.wms_co_id},onSubmit:d[11]||(d[11]=e=>c(e))},null,8,["show","title","data"]),r(Ce,{show:S.value,"onUpdate:show":d[12]||(d[12]=e=>S.value=e),index:H.value,options:N.value},null,8,["show","index","options"])],64))}}),Qt=$e(Jt,[["__scopeId","data-v-ea96ffca"]]),Xt={class:"goods_info flex"},Zt={class:"goods_info_tools flex"},es={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},ts={class:"tCenter"},ss={class:"flex_center"},ls=["onClick"],as={class:"copy c_primary"},os=["onClick"],ns={class:"tCenter"},is={class:"tRight"},us={key:0},ds={key:1},rs={key:1},ps={class:"tRight"},ms={key:0},cs={key:1},vs={key:1},_s={class:"tCenter"},fs={class:"tCenter"},gs={class:"tCenter"},xs={class:"tCenter"},hs={key:0,class:"c_danger"},ks={key:1,class:"c_success"},ws={class:"tCenter"},ys={class:"tCenter type"},bs={key:0,class:"type_warning"},$s={key:1,class:"type_success"},Cs={key:2,class:"type_warning"},As={key:3,class:"type_success"},Ts={key:4,class:"type_info"},Ss={key:5,class:"type_danger"},Us={key:6,class:"type_primary"},Ds={key:7,class:"type_info"},Ls={class:"tCenter"},Ws={class:"goods_info flex"},Ps={class:"goods_info_tools flex"},Is={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},Bs={class:"tCenter"},Ys={class:"tCenter"},Hs={class:"tCenter"},Rs={class:"tCenter"},Ms={class:"tCenter"},Ns={key:0,class:"flex_center status0"},Fs={key:1,class:"flex_center status1"},js={key:2,class:"flex_center status2"},Vs={key:3,class:"tCenter"},Es=ie({__name:"diff",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,j=D(),T=D(),U=ue().state,o=U.langs,x=be.priceEncode,W=D(!1);let _=D([]);const p=D({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:o.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",width:"120px",minWidth:"120px"},{title:"款式编码",slot:"i_id",index:"i_id",textAlign:"center",width:"80px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px"},{title:"重量",slot:"weight",index:"weight",textAlign:"center",width:"60px"},{title:"数量",slot:"num",index:"num",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"action",index:"status",textAlign:"center",width:"60px",minWidth:"60px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"类型",slot:"type_name",textAlign:"center",width:"60px"},{title:"采购员",slot:"owner",textAlign:"center",width:"60px"},{title:"仓库",index:"warehouse"}],list:[],sale_price:0,market_price:0,num:0,out_num:0}),i=D({show:!1,key:"",order:"",columns:[{title:"单号",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:o.date,index:"date",slot:"date",width:"90px",textAlign:"center"},{title:"类型",slot:"type",width:"80px",minWidth:"80px",textAlign:"center"},{title:"仓库",index:"wms_co_name"},{title:"数量",slot:"num",textAlign:"center"},{title:"条数",slot:"total",textAlign:"center"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:"制单员",index:"creator_name",textAlign:"center"},{title:"备注",index:"remark"}],list:[],total:0,num:0}),b=D(!1),S=D(0),H=D([]);pe(()=>y.show,R=>{if(W.value=R,R){_.value=[];for(let c of y.data)K.Post("erp_purchase_in/goods_list?lang="+U.lang,{token:U.token,id:c},l=>{const{code:F,msg:q,data:Z}=l.data;if(F==0)for(let re of Z)_.value.push(re);else w.Toast(q)})}},{deep:!0});const N=R=>{p.value.order=R,$(p.value.key)},P=()=>{const R=ne.LTrim(p.value.key.trim().toUpperCase(),"0");$(R)},$=R=>{p.value.list=[],p.value.out_num=0;const c=R.split(" ");for(let l of c){const F=w.Loading();K.Post("erp_purchase_out/goods_list?lang="+U.lang,{token:U.token,id:l},q=>{F.clear();const{code:Z,msg:re,data:f}=q.data;if(Z==0)for(let d of f)p.value.out_num+=d.num,A(d.sku_id)||(p.value.list.push({sku_id:d.sku_id}),V(d.sku_id));else w.Toast(re)})}},A=(R="")=>{for(let c of _.value)if(R===c.sku_id)return!0;return!1},V=R=>{K.Post("goods/direct?lang="+U.lang,{token:U.token,sku_id:R,time:24},c=>{const{code:l,msg:F,data:q}=c.data;if(l==0){if(q.list.length===0)return;for(let Z in p.value.list)p.value.list[Z].sku_id==q.list[0].sku_id&&(p.value.list[Z]=q.list[0],G())}else w.Toast(F)})},G=()=>{p.value.sale_price=0,p.value.market_price=0,p.value.num=0;for(let R of p.value.list)p.value.sale_price+=R.sale_price*R.num,p.value.market_price+=R.market_price*R.num,p.value.num+=R.num},X=()=>{const R=ne.LTrim(i.value.key.trim().toUpperCase(),"0");i.value.key="",ee(R)},ee=R=>{i.value.list=[];const c=w.Loading();K.Post("erp_purchase_out/list?lang="+U.lang,{token:U.token,data:{key:R},page:1,limit:30,order:""},l=>{c.clear();const{code:F,msg:q,data:Z,time:re}=l.data;F==0?(i.value.list=Z,he(()=>{T.value.checkboxAll(!1)})):w.Toast(q)})},me=(R,c)=>{i.value.total=R,i.value.num=0;const l=T.value.getData();for(let F of l)i.value.num+=parseInt(F.num)},de=()=>{const R=T.value.getData();if(R.length==0)return w.Toast("请选择采退单");let c=[];for(let l of R)c.push(l.id);i.value.show=!1,p.value.key=c.join(" "),P()},fe=R=>{let c=[],l=0;for(let F of p.value.list)F.img&&(F.img==R&&(S.value=l),c.push({label:F.sku_id,value:F.img,other:{颜色及规格:F.properties_value,标签价:F.sale_price+"元",吊牌价:F.market_price+"W"}}),l++);b.value=!0,H.value=c},ce=(R,c)=>{const l=j.value.getData();let F="";for(let q in l)F+=l[q][R]+" ";F?ne.CopyText(F):ne.CopyText(c)},ge=()=>{_.value=[],p.value.key="",p.value.list=[],p.value.num=0,p.value.out_num=0,p.value.sale_price=0,p.value.market_price=0,E("update:show",!1)};return(R,c)=>(v(),g(Q,null,[r(le,{show:W.value,"onUpdate:show":c[4]||(c[4]=l=>W.value=l),title:Y.title,width:"calc(100% - 40px)",maxWidth:"1366px",overflow:"auto",top:"56px",bottom:"0px",bgClose:!1,onClose:c[5]||(c[5]=l=>ge())},{top:t(()=>[s("div",Xt,[s("ul",Zt,[s("li",null,[r(_e,{value:p.value.key,"onUpdate:value":c[0]||(c[0]=l=>p.value.key=l),onKeyup:c[1]||(c[1]=we(l=>P(),["enter"])),onIconClick:c[2]||(c[2]=l=>P()),placeholder:"采退单号,多个空格分离",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])]),s("li",null,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:c[3]||(c[3]=l=>{i.value.show=!0,ee(i.value.key)})},{default:t(()=>c[13]||(c[13]=[h("选择采退单")])),_:1})])]),s("div",es,[c[14]||(c[14]=h(" 入库数: ")),s("b",null,n(Y.num),1),c[15]||(c[15]=h("    采退数: ")),s("b",null,n(p.value.out_num),1),c[16]||(c[16]=h("    标签价: ")),s("b",null,n(k(x)(p.value.sale_price)),1),c[17]||(c[17]=h(" 元   吊牌价: ")),s("b",null,n(k(x)(p.value.market_price)),1),c[18]||(c[18]=h(" W   数量: ")),s("b",null,n(p.value.num),1)])])]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref_key:"tableList",ref:j,columns:p.value.columns,options:p.value.list,onOrderBy:N},{index:t(l=>[s("div",ts,n(p.value.list.length-l.index),1)]),img:t(l=>[s("div",ss,[s("span",{onClick:F=>l.img?fe(l.img):""},[r(De,{img:l.img?l.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,ls)])]),sku_id:t(l=>[s("div",as,[h(n(l.sku_id),1),s("span",{onClick:F=>ce("sku_id",l.sku_id)},"复",8,os)])]),i_id:t(l=>[s("div",ns,n(l.i_id||"-"),1)]),sale_price:t(l=>[s("div",is,[l.sale_price>0?(v(),g(Q,{key:0},[l.ratio!="1.00"?(v(),g("span",us,[s("del",null,n(k(x)(l.sale_price)),1),c[19]||(c[19]=h()),s("b",null,n(k(x)(l.sale_price*l.ratio)),1)])):(v(),g("b",ds,n(k(x)(l.sale_price)),1))],64)):(v(),g("span",rs,"-"))])]),market_price:t(l=>[s("div",ps,[l.market_price>0?(v(),g(Q,{key:0},[l.ratio!="1.00"?(v(),g("span",ms,[s("del",null,n(k(x)(l.market_price)),1),c[20]||(c[20]=h()),s("b",null,n(k(x)(l.market_price*l.ratio)),1)])):(v(),g("b",cs,n(k(x)(l.market_price)),1))],64)):(v(),g("span",vs,"-"))])]),unit:t(l=>[s("div",_s,n(l.unit||"-"),1)]),weight:t(l=>[s("div",fs,n(l.weight||"-"),1)]),num:t(l=>[s("div",gs,[s("b",null,n(l.num||"-"),1)])]),action:t(l=>[s("div",xs,[l.status==0?(v(),g("span",hs,"进行中")):l.status==1?(v(),g("span",ks,"完成")):oe("",!0)])]),view:t(l=>[s("div",ws,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:F=>{k(U).goods.show=!0,k(U).goods.sku_id=l.sku_id}},{default:t(()=>[h(n(k(o).goods_flow),1)]),_:2},1032,["onClick"])])]),type_name:t(l=>[s("div",ys,[l.type=="6"?(v(),g("span",bs,n(l.type_name||"-"),1)):l.type=="5"?(v(),g("span",$s,n(l.type_name||"-"),1)):l.type=="4"?(v(),g("span",Cs,n(l.type_name||"-"),1)):l.type=="3"?(v(),g("span",As,n(l.type_name||"-"),1)):l.type=="2"?(v(),g("span",Ts,n(l.type_name||"-"),1)):l.type=="1"?(v(),g("span",Ss,n(l.type_name||"-"),1)):l.type=="0"?(v(),g("span",Us,n(l.type_name||"-"),1)):l.type=="-1"?(v(),g("span",Ds,n(l.type_name||"-"),1)):oe("",!0)])]),owner:t(l=>[s("div",Ls,n(l.owner||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),r(Ce,{show:b.value,"onUpdate:show":c[6]||(c[6]=l=>b.value=l),index:S.value,options:H.value},null,8,["show","index","options"]),r(le,{show:i.value.show,"onUpdate:show":c[11]||(c[11]=l=>i.value.show=l),title:"选择采退单",width:"calc(100% - 40px)",maxWidth:"1280px",overflow:"auto",top:"56px",bottom:"40px",onClose:c[12]||(c[12]=l=>i.value.show=!1)},{top:t(()=>[s("div",Ws,[s("ul",Ps,[s("li",null,[r(_e,{value:i.value.key,"onUpdate:value":c[7]||(c[7]=l=>i.value.key=l),onKeyup:c[8]||(c[8]=we(l=>X(),["enter"])),onIconClick:c[9]||(c[9]=l=>X()),placeholder:"单号、商品编码、备注",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])])]),s("div",Is,[c[21]||(c[21]=h(" 入库数: ")),s("b",null,n(Y.num),1),c[22]||(c[22]=h("   采退数: ")),s("b",null,n(i.value.num),1),c[23]||(c[23]=h("    差异: ")),s("b",null,n(Y.num-i.value.num>0?Y.num-i.value.num:i.value.num-Y.num),1)])])]),bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:c[10]||(c[10]=l=>de())},{default:t(()=>[h(n(k(o).confirm),1)]),_:1})]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref_key:"formList",ref:T,overflow:"auto",columns:i.value.columns,options:i.value.list,onPartially:me},{id:t(l=>[s("div",Bs,n(l.id),1)]),date:t(l=>[s("div",Ys,[r(Te,{title:"创建: "+l.ctime+`
更新: `+l.utime+`
制单: `+l.creator_name+", 审核: "+l.operator_name+`
备注: `+l.remark},{default:t(()=>[h(n(l.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(l=>[s("div",Hs,n(l.type_name),1)]),num:t(l=>[s("div",Rs,n(l.num),1)]),total:t(l=>[s("div",Ms,n(l.total),1)]),status:t(l=>[l.status=="0"?(v(),g("div",Ns,n(l.status_name),1)):l.status=="1"?(v(),g("div",Fs,n(l.status_name),1)):l.status=="2"?(v(),g("div",js,n(l.status_name),1)):(v(),g("div",Vs,n(l.status_name),1))]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show"])],64))}}),Os=$e(Es,[["__scopeId","data-v-e66dc8b3"]]),Ks={class:"app_action flex"},zs={class:"app_action_tools scrollbar"},Gs={key:0,class:"line"},qs={key:0,class:"line"},Js={class:"app_action_search flex"},Qs={class:"custom_time flex_center"},Xs=["onClick"],Zs={class:"app_ct"},el={class:"tCenter"},tl={class:"tCenter"},sl={class:"tCenter"},ll={class:"tCenter"},al={class:"tRight"},ol={class:"tRight"},nl={class:"tCenter"},il={class:"tCenter"},ul={key:0,class:"flex_center status0"},dl={key:1,class:"flex_center status1"},rl={key:2,class:"flex_center status2"},pl={key:3,class:"tCenter"},ml={class:"tCenter"},cl={key:2,class:"c_info"},vl={class:"tCenter"},_l={class:"tCenter"},fl={class:"app_page"},gl=ie({__name:"index",setup(Y){const z=D(!1),y=D(),j=ue().state,T=j.langs,L=Se.isAction,U=be.priceEncode,o=D({show:!1,key:"",placeholder:"ID、品牌、操作员、备注",time:[O.Date("Y/m/d",O.StrToTime("-1 month")),O.Date("Y/m/d")],maxDate:O.Date("Y/m/d"),customTime:{active:"",list:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"3个月",value:"month"},{label:"近1年",value:"year"}]},columns:[{label:"",value:"",slot:"customTime"},{label:T.select,value:"",slot:"time"},{label:"仓库名称",value:"",slot:"wms_co_id"},{label:"入库类型",value:"",slot:"type"},{label:"状态",value:"",slot:"status"},{label:"品牌",value:"",slot:"brand"},{label:"单号, 多条空格分离",value:"",name:"id"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label:"制单员",value:"",name:"creator_name"},{label:"操作员",value:"",name:"operator_name"},{label:"备注",value:"",name:"remark"}],type:"",wms_co_id:"",brand:"",status:""}),x=D({time:"",list:{num:0,cost_price:0,sale_price:0,purchase_price:0,market_price:0}}),W=D({columns:[{title:"单号",slot:"id",textAlign:"center",width:"100px"},{title:T.date,slot:"date",textAlign:"center",width:"90px"},{title:"类型",slot:"type",index:"type",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"入库仓库",index:"wms_co_name",width:"200px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"标签总额(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌总额(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px"},{title:"条数",slot:"total",index:"total",order:"",textAlign:"center",width:"60px"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:T.action,slot:"action",textAlign:"center",width:"40px"},{title:"商品",slot:"goods",textAlign:"center",width:"40px"},{title:T.review,slot:"print",textAlign:"center",width:"40px"},{title:"制单员",index:"creator_name",textAlign:"center",width:"100px"},{title:"操作员",index:"operator_name",textAlign:"center",width:"100px"},{title:"备注",index:"remark"}],data:[],num:0,total:0,order:""}),_=D({total:0,num:1,limit:100}),p=D({show:!1,title:"添加/编辑",data:{}}),i=D({show:!1,title:"删除",data:[]}),b=D({show:!1,title:"推送",info:"",num:0,data:[]}),S=D({show:!1,title:"撤回",info:"",data:[]}),H=D({show:!1,title:"导出",num:0,data:[]}),N=D({show:!1,title:"对比",num:0,data:[]}),P=D({show:!1,title:"商品",data:{}}),$=D({show:!1,title:"入库单",info:{},columns:[],data:[]}),A=D({partner_name:[],brand_name:[],type_name:[],status_name:[]});Be(()=>{j.token&&J()}),Ye(()=>{z&&j.isLogin&&V()});const V=()=>{o.value.show=!1,W.value.data=[];const m=w.Loading();K.Post("erp_purchase_in/list?lang="+j.lang,{token:j.token,data:G(),page:_.value.num,limit:_.value.limit,order:W.value.order},u=>{m.clear();const{code:a,msg:B,data:te,time:xe}=u.data;a==0?(x.value.time=xe,W.value.data=te,he(()=>de())):w.Toast(B)}),_.value.total=0,x.value.list.num=0,x.value.list.cost_price=0,x.value.list.sale_price=0,x.value.list.purchase_price=0,x.value.list.market_price=0,K.Post("erp_purchase_in/total?lang="+j.lang,{token:j.token,data:G()},u=>{const{code:a,msg:B,data:te,time:xe}=u.data;a==0?(x.value.time=xe,_.value.total=te.total,x.value.list.cost_price=te.cost_price,x.value.list.sale_price=te.sale_price,x.value.list.purchase_price=te.purchase_price,x.value.list.market_price=te.market_price,x.value.list.num=te.num):w.Toast(B)})},G=()=>{const m={key:o.value.key,stime:typeof o.value.time[0]=="string"?o.value.time[0]:O.Date("Y/m/d",o.value.time[0]),etime:typeof o.value.time[1]=="string"?o.value.time[1]:O.Date("Y/m/d",o.value.time[1]),wms_co_id:o.value.wms_co_id,type:o.value.type,status:o.value.status,brand:o.value.brand};for(let u of o.value.columns)u.name&&(m[u.name]=u.value);return m},X=(m,u)=>{W.value.num=m,W.value.total=u;const a=y.value.getData();i.value.data=[],b.value.data=[],b.value.num=0,H.value.data=[],H.value.num=0,N.value.data=[],N.value.num=0;for(let B of a)B.status==0&&(i.value.data.push(B.id),b.value.data.push(B.id),b.value.num+=parseInt(B.num)),H.value.data.push(B.id),H.value.num+=parseInt(B.num),N.value.data.push(B.id),N.value.num+=parseInt(B.num)},ee=m=>{W.value.order=m,V()},me=()=>{o.value.time=[O.Date("Y/m/d",O.StrToTime("-1 month")),O.Date("Y/m/d")],o.value.customTime.active="",o.value.key="",o.value.wms_co_id="",o.value.type="",o.value.status="",o.value.brand="";for(let m of o.value.columns)m.value="";W.value.order="",_.value.num=1,V()},de=()=>{he(()=>{y.value.checkboxAll(!1)})},fe=m=>{switch(o.value.customTime.active=m,m){case"today":o.value.time=[O.Date("Y/m/d"),O.Date("Y/m/d")];break;case"yesterday":o.value.time=[O.Date("Y/m/d",O.StrToTime("-1 day")),O.Date("Y/m/d",O.StrToTime("-1 day"))];break;case"month":o.value.time=[O.Date("Y/m/d",O.StrToTime("-3 month")),O.Date("Y/m/d")];break;case"year":o.value.time=[O.Date("Y/m/d",O.StrToTime("-1 year")),O.Date("Y/m/d")];break}},ce=(m,u={})=>{p.value.show=!0,p.value.data=u,p.value.data.tp=m,m=="add"?p.value.title=T.add:m=="edit"&&(p.value.title=T.edit+"( "+u.id+" )",p.value.data.id=u.id)},ge=m=>{m&&(p.value.show=!1,V())},R=()=>{i.value.show=!0},c=m=>{m&&(i.value.show=!1,V())},l=()=>{b.value.show=!0,b.value.info="单号:[ <b>"+b.value.data.join(",")+"</b> ]&nbsp;&nbsp;&nbsp;&nbsp;数量: <b>"+b.value.num+"</b>"},F=m=>{m&&(b.value.show=!1,V())},q=(m,u,a)=>{S.value.show=!0,S.value.data=[m],S.value.info="单号: <b>"+m+"</b>&nbsp;&nbsp;品牌: <b>"+u+"</b>&nbsp;&nbsp;数量: <b>"+a+"</b>"},Z=m=>{m&&(S.value.show=!1,V())},re=()=>{H.value.show=!0},f=m=>{m&&(H.value.show=!1,de())},d=()=>{N.value.show=!0,N.value.title="对比采退单( "+N.value.data.join(",")+" )"},e=m=>{P.value.show=!0,P.value.title=m.type_name+" > "+m.wms_co_name+"( "+m.id+" )",P.value.data.id=m.id,P.value.data.ctime=m.ctime,P.value.data.utime=m.utime,P.value.data.wms_co_id=m.wms_co_id,P.value.data.status=m.status,P.value.data.brand=m.brand},C=m=>{m&&(P.value.show=!1,V())},I=m=>{$.value.show=!0,$.value.info={title:"[入库] "+m.wms_co_name,id:m.id,cost_price:m.cost_price,sale_price:m.sale_price,purchase_price:m.purchase_price,market_price:m.market_price,num:m.num,ctime:m.ctime,utime:m.utime,creator_name:m.creator_name,operator_name:m.operator_name,remark:m.remark},$.value.columns=[{label:"商品编码",value:"sku_id",checked:!0,textAlign:"center"},{label:"商品名称",value:"name",checked:!0,textAlign:"center"},{label:"颜色及规格",value:"properties_value",checked:!0},{label:"成本金额(元)",value:"cost_price",checked:!1,price:!0,textAlign:"right"},{label:"标签金额(元)",value:"sale_price",checked:!0,price:!0,textAlign:"right"},{label:"采购金额(W)",value:"purchase_price",checked:!1,price:!0,textAlign:"right"},{label:"吊牌金额(W)",value:"market_price",checked:!0,price:!0,textAlign:"right"},{label:"数量",value:"num",checked:!0,textAlign:"center"},{label:"折扣",value:"ratio",checked:!0,textAlign:"center"},{label:"单位",value:"unit",checked:!0,textAlign:"center"},{label:"重量",value:"weight",checked:!0,textAlign:"center"},{label:"标签",value:"labels",checked:!1,textAlign:"center"},{label:"商品分类",value:"category",checked:!1,textAlign:"center"},{label:"品牌",value:"brand",checked:!0,textAlign:"center"},{label:"采购员",value:"owner",checked:!0,textAlign:"center"},{label:"供应商",value:"supplier_name",checked:!1,textAlign:"center"},{label:"制单员",value:"operator_name",checked:!0,textAlign:"center"},{label:"创建时间",value:"ctime",checked:!0,textAlign:"center"},{label:"更新时间",value:"ctime",checked:!1,textAlign:"center"}];const u=w.Loading();K.Post("erp_purchase_in/goods_list?lang="+j.lang,{token:j.token,id:m.id,ctime:m.ctime,utime:m.utime,wms_co_id:m.wms_co_id},a=>{u.clear();const{code:B,msg:te,data:xe}=a.data;B==0?$.value.data=xe:w.Toast(te)})},J=()=>{K.Post("erp_purchase_in/get_select?lang="+j.lang,{token:j.token},m=>{const{code:u,msg:a,data:B}=m.data;u==0?(A.value.partner_name=B.partner_name,A.value.brand_name=B.brand_name,A.value.type_name=B.type_name,A.value.status_name=B.status_name,z.value=!0):w.Toast(a)})};return(m,u)=>(v(),g(Q,null,[r(je,{time:x.value.time,onRefresh:u[0]||(u[0]=a=>V())},{default:t(()=>[u[35]||(u[35]=h(" 标签金额: ")),s("b",null,n(k(U)(x.value.list.sale_price)),1),u[36]||(u[36]=h(" 元   吊牌金额: ")),s("b",null,n(k(U)(x.value.list.market_price)),1),u[37]||(u[37]=h(" W   数量: ")),s("b",null,n(x.value.list.num),1),u[38]||(u[38]=h("   "))]),_:1},8,["time"]),s("div",Ks,[s("div",zs,[r(Me,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line1"},{action:"push",slot:"push",is_action:!0},{action:"line",slot:"line2"},{action:"export",slot:"export",is_action:!0},{action:"diff",slot:"diff",is_action:!1}]},{add:t(()=>[r(M,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:u[1]||(u[1]=a=>ce("add"))},{default:t(()=>[h(n(k(T).add),1)]),_:1})]),del:t(()=>[r(M,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:i.value.data.length==0,onClick:u[2]||(u[2]=a=>R())},{default:t(()=>[h(n(k(T).del)+"("+n(i.value.data.length)+")",1)]),_:1},8,["disabled"])]),line1:t(()=>[k(L)("save")?(v(),g("span",Gs,"|")):oe("",!0)]),push:t(()=>[r(M,{effect:"plain",type:"primary",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:b.value.data.length==0,onClick:u[3]||(u[3]=a=>l())},{default:t(()=>[h(n(b.value.title)+"("+n(b.value.data.length)+")",1)]),_:1},8,["disabled"])]),line2:t(()=>[k(L)("push")?(v(),g("span",qs,"|")):oe("",!0)]),export:t(()=>[r(M,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:H.value.data.length==0,onClick:u[4]||(u[4]=a=>re())},{default:t(()=>[h(n(k(T).export)+"("+n(H.value.num)+")",1)]),_:1},8,["disabled"])]),diff:t(()=>[r(M,{effect:"plain",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:N.value.data.length==0,onClick:u[5]||(u[5]=a=>d())},{default:t(()=>[h("对比("+n(N.value.num)+")",1)]),_:1},8,["disabled"])]),_:1})]),s("div",Js,[r(Ne,{show:o.value.show,"onUpdate:show":u[11]||(u[11]=a=>o.value.show=a),keys:o.value.key,"onUpdate:keys":u[12]||(u[12]=a=>o.value.key=a),columns:o.value.columns,placeholder:o.value.placeholder,onKeyup:u[13]||(u[13]=we(a=>{_.value.num=1,V()},["enter"])),onSearch:u[14]||(u[14]=a=>{_.value.num=1,V()}),onReset:u[15]||(u[15]=a=>me())},{customTime:t(a=>[s("ul",Qs,[(v(!0),g(Q,null,Re(o.value.customTime.list,B=>(v(),g("li",{key:B.value,onClick:te=>fe(B.value),class:Ae({active:o.value.customTime.active===B.value})},n(B.label),11,Xs))),128))])]),time:t(a=>[r(He,{value:o.value.time,"onUpdate:value":u[6]||(u[6]=B=>o.value.time=B),range:"",maxDate:o.value.maxDate,placeholder:a.label},null,8,["value","maxDate","placeholder"])]),wms_co_id:t(a=>[r(ve,{value:o.value.wms_co_id,"onUpdate:value":u[7]||(u[7]=B=>o.value.wms_co_id=B),options:A.value.partner_name,placeholder:a.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),type:t(a=>[r(ve,{value:o.value.type,"onUpdate:value":u[8]||(u[8]=B=>o.value.type=B),options:A.value.type_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),status:t(a=>[r(ve,{value:o.value.status,"onUpdate:value":u[9]||(u[9]=B=>o.value.status=B),options:A.value.status_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),brand:t(a=>[r(ve,{value:o.value.brand,"onUpdate:value":u[10]||(u[10]=B=>o.value.brand=B),options:A.value.brand_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["show","keys","columns","placeholder"])])]),s("div",Zs,[r(ke,{ref_key:"tableList",ref:y,overflow:"auto",columns:W.value.columns,options:W.value.data,onOrderBy:ee,onPartially:X},{id:t(a=>[s("div",el,n(a.id),1)]),date:t(a=>[s("div",tl,[r(Te,{title:"创建: "+a.ctime+`
更新: `+a.utime+`
制单: `+a.creator_name+", 审核: "+a.operator_name+`
备注: `+a.remark},{default:t(()=>[h(n(a.ctime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(a=>[s("div",sl,n(a.type_name),1)]),brand:t(a=>[s("div",ll,n(a.brand),1)]),sale_price:t(a=>[s("div",al,n(a.sale_price>0?k(U)(a.sale_price):"-"),1)]),market_price:t(a=>[s("div",ol,n(a.market_price>0?k(U)(a.market_price):"-"),1)]),num:t(a=>[s("div",nl,n(a.num),1)]),total:t(a=>[s("div",il,n(a.total),1)]),status:t(a=>[a.status=="0"?(v(),g("div",ul,n(a.status_name),1)):a.status=="1"?(v(),g("div",dl,n(a.status_name),1)):a.status=="2"?(v(),g("div",rl,n(a.status_name),1)):(v(),g("div",pl,n(a.status_name),1))]),action:t(a=>[s("div",ml,[k(L)("save")&&a.state=="0"?(v(),se(M,{key:0,onClick:B=>ce("edit",a)},{default:t(()=>[h(n(k(T).edit),1)]),_:2},1032,["onClick"])):k(L)("save")&&a.state=="1"?(v(),se(M,{key:1,type:"danger",effect:"text",onClick:B=>q(a.id,a.brand,a.num)},{default:t(()=>u[39]||(u[39]=[h("撤回")])),_:2},1032,["onClick"])):(v(),g("span",cl,u[40]||(u[40]=[s("i",{class:"ui ui_safety"},null,-1)])))])]),goods:t(a=>[s("div",vl,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:B=>e(a)},{default:t(()=>u[41]||(u[41]=[h("商品")])),_:2},1032,["onClick"])])]),print:t(a=>[s("div",_l,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:B=>I(a),disabled:a.num==0},{default:t(()=>[h(n(k(T).print),1)]),_:2},1032,["onClick","disabled"])])]),_:1},8,["columns","options"])]),s("div",fl,[r(Fe,{total:_.value.total,"onUpdate:total":u[16]||(u[16]=a=>_.value.total=a),page:_.value.num,"onUpdate:page":[u[17]||(u[17]=a=>_.value.num=a),u[18]||(u[18]=a=>V())],limit:_.value.limit,"onUpdate:limit":[u[19]||(u[19]=a=>_.value.limit=a),u[20]||(u[20]=a=>{_.value.num=1,V()})]},null,8,["total","page","limit"])]),r(Ee,{show:p.value.show,"onUpdate:show":u[21]||(u[21]=a=>p.value.show=a),title:p.value.title,data:p.value.data,onSubmit:u[22]||(u[22]=a=>ge(a))},null,8,["show","title","data"]),r(Ke,{show:i.value.show,"onUpdate:show":u[23]||(u[23]=a=>i.value.show=a),data:i.value.data,onSubmit:u[24]||(u[24]=a=>c(a))},null,8,["show","data"]),r(Ge,{show:b.value.show,"onUpdate:show":u[25]||(u[25]=a=>b.value.show=a),title:b.value.title,info:b.value.info,data:b.value.data,onSubmit:u[26]||(u[26]=a=>F(a))},null,8,["show","title","info","data"]),r(Je,{show:S.value.show,"onUpdate:show":u[27]||(u[27]=a=>S.value.show=a),title:S.value.title,info:S.value.info,data:S.value.data,onSubmit:u[28]||(u[28]=a=>Z(a))},null,8,["show","title","info","data"]),r(Xe,{show:H.value.show,"onUpdate:show":u[29]||(u[29]=a=>H.value.show=a),data:H.value.data,num:H.value.num,onSubmit:u[30]||(u[30]=a=>f(a))},null,8,["show","data","num"]),r(Os,{show:N.value.show,"onUpdate:show":u[31]||(u[31]=a=>N.value.show=a),title:N.value.title,data:N.value.data,num:N.value.num},null,8,["show","title","data","num"]),r(Qt,{show:P.value.show,"onUpdate:show":u[32]||(u[32]=a=>P.value.show=a),title:P.value.title,data:P.value.data,onSubmit:u[33]||(u[33]=a=>C(a))},null,8,["show","title","data"]),r(Ve,{show:$.value.show,"onUpdate:show":u[34]||(u[34]=a=>$.value.show=a),title:$.value.title,info:$.value.info,columns:$.value.columns,data:$.value.data},null,8,["show","title","info","columns","data"])],64))}}),Cl=$e(gl,[["__scopeId","data-v-e0583850"]]);export{Cl as default};
