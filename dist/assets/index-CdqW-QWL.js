import{d as ue,u as de,r as L,w as ne,c as se,a as t,e as le,f as r,h as Le,i as s,K as me,j as _e,k as ae,l as k,t as u,b as h,m as M,U as w,R as K,o as c,G as he,F as ye,n as g,s as Q,E as ke,D as we,N as oe,O as We,P as Pe,A as Ce,B as ee,M as be,x as Ae,L as Ie,_ as $e,I as Te,T as O,y as Be,z as Ye,H as He,v as Re}from"./index-Bk_N_zTm.js";import{P as Se,w as Me,a as Ne,b as Fe}from"./Search-C7OhwOKh.js";import{w as je}from"./Total-BtOkyXsH.js";import{P as Ve}from"./PrintGoods-Cbbx1bk5.js";import{w as Ue}from"./index-CjqO9AXO.js";import{w as De}from"./index-CbFQVDYo.js";import"./index-4vNOW6-5.js";const Ee=ue({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,S=de().state,T=S.langs,D=L(!1),n=L({tp:"",id:"",type:"",wms_co_id:"",brand:"",remark:""}),x=L({type_name:[],partner_name:[],brand_name:[]});ne(()=>y.show,b=>{D.value=b,b&&(n.value.tp=y.data.tp||"",n.value.id=y.data.id||"",n.value.remark=y.data.remark||"",W())},{deep:!0});const W=()=>{K.Post("erp_purchase_in/get_select?lang="+S.lang,{token:S.token},b=>{const{code:U,msg:H,data:N}=b.data;U==0?(x.value.type_name=N.type_name,x.value.partner_name=N.partner_name,x.value.brand_name=N.brand_name,y.data.tp=="edit"&&he(()=>{n.value.type=[parseInt(y.data.type)],n.value.wms_co_id=[parseInt(y.data.wms_co_id)],n.value.brand=[y.data.brand]})):w.Toast(H)})},f=b=>!b.wms_co_id||b.wms_co_id.length==0?w.Toast("请选择采购仓库"):!b.type||b.type.length==0?w.Toast("请选择采购类型"):!b.brand||b.brand.length==0?w.Toast("请选择品牌"):b,p=()=>{const b=f(n.value);if(!b)return;const U=w.Loading();K.Post("erp_purchase_in/save?lang="+S.lang,{token:S.token,data:b},H=>{U.clear();const{code:N,msg:I}=H.data;w.Toast(I),E("submit",N==0)})},i=()=>{E("update:show",!1)};return(b,U)=>(c(),se(le,{show:D.value,"onUpdate:show":U[5]||(U[5]=H=>D.value=H),title:Y.title,width:"620px",bottom:"40px",onClose:U[6]||(U[6]=H=>i())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:U[4]||(U[4]=H=>p())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(ae,null,{default:t(()=>[r(Le,null,{default:t(()=>[s("tr",null,[U[7]||(U[7]=s("td",{class:"label"},[s("span",{class:"red_dot"},"采购仓库")],-1)),s("td",null,[r(me,{value:n.value.wms_co_id,"onUpdate:value":U[0]||(U[0]=H=>n.value.wms_co_id=H),options:x.value.partner_name,disabled:n.value.tp=="edit"},null,8,["value","options","disabled"])])]),s("tr",null,[U[8]||(U[8]=s("td",{class:"label"},[s("span",{class:"red_dot"},"采购类型")],-1)),s("td",null,[r(me,{value:n.value.type,"onUpdate:value":U[1]||(U[1]=H=>n.value.type=H),options:x.value.type_name},null,8,["value","options"])])]),s("tr",null,[U[9]||(U[9]=s("td",{class:"label"},[s("span",{class:"red_dot"},"品牌")],-1)),s("td",null,[r(me,{value:n.value.brand,"onUpdate:value":U[2]||(U[2]=H=>n.value.brand=H),options:x.value.brand_name},null,8,["value","options"])])]),s("tr",null,[U[10]||(U[10]=s("td",{class:"label"},"备注",-1)),s("td",null,[r(_e,{value:n.value.remark,"onUpdate:value":U[3]||(U[3]=H=>n.value.remark=H),type:"textarea",height:"160px"},null,8,["value"])])])]),_:1})]),_:1})]),_:1},8,["show","title"]))}}),Oe=["innerHTML"],Ke=ue({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,S=de().state,T=S.langs,D=L(!1);ne(()=>y.show,W=>{D.value=W},{deep:!0});const n=()=>{const W=w.Loading();K.Post("erp_purchase_in/del?lang="+S.lang,{token:S.token,data:y.data},f=>{W.clear();const{code:p,msg:i}=f.data;w.Toast(i),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,f)=>(c(),se(le,{show:D.value,"onUpdate:show":f[1]||(f[1]=p=>D.value=p),title:Y.title||h(T).del,width:"360px",bottom:"40px",onClose:f[2]||(f[2]=p=>x())},{bottom:t(()=>[r(M,{effect:"dark",type:"danger",height:"40px",onClick:f[0]||(f[0]=p=>n())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[s("span",{innerHTML:h(T).del_warn(Y.data.length)},null,8,Oe)]),_:1})]),_:1},8,["show","title"]))}}),ze=["innerHTML"],Ge=ue({__name:"push",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,S=de().state,T=S.langs,D=L(!1);ne(()=>y.show,W=>{D.value=W},{deep:!0});const n=()=>{const W=w.Loading();K.Post("erp_purchase_in/push?lang="+S.lang,{token:S.token,data:y.data},f=>{W.clear();const{code:p,msg:i}=f.data;w.Toast(i),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,f)=>(c(),se(le,{show:D.value,"onUpdate:show":f[1]||(f[1]=p=>D.value=p),title:Y.title,width:"480px",bottom:"40px",onClose:f[2]||(f[2]=p=>x())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:f[0]||(f[0]=p=>n())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(Ue,null,{default:t(()=>[...f[3]||(f[3]=[k("提醒: 扫货完成，将推送库房验收",-1)])]),_:1}),r(ae,{lineHeight:"60px"},{default:t(()=>[s("div",{class:"tCenter",innerHTML:Y.info,style:{"word-wrap":"break-word"}},null,8,ze)]),_:1})]),_:1},8,["show","title"]))}}),qe=["innerHTML"],Je=ue({__name:"revoke",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,S=de().state,T=S.langs,D=L(!1);ne(()=>y.show,W=>{D.value=W},{deep:!0});const n=()=>{const W=w.Loading();K.Post("erp_purchase_in/revoke?lang="+S.lang,{token:S.token,data:y.data},f=>{W.clear();const{code:p,msg:i}=f.data;w.Toast(i),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,f)=>(c(),se(le,{show:D.value,"onUpdate:show":f[1]||(f[1]=p=>D.value=p),title:Y.title,width:"600px",bottom:"40px",onClose:f[2]||(f[2]=p=>x())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:f[0]||(f[0]=p=>n())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(Ue,null,{default:t(()=>[...f[3]||(f[3]=[k("提醒: 将撤回以下单据",-1)])]),_:1}),r(ae,{lineHeight:"60px",class:"tCenter"},{default:t(()=>[s("div",{class:"tCenter",innerHTML:Y.info,style:{"word-wrap":"break-word"}},null,8,qe)]),_:1})]),_:1},8,["show","title"]))}}),Qe=["innerHTML"],Xe=ue({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,S=de().state,T=S.langs,D=L(!1);ne(()=>y.show,W=>{D.value=W},{deep:!0});const n=()=>{const W=w.Loading();K.Post("erp_purchase_in/export?lang="+S.lang,{token:S.token,data:y.data,order:y.order},f=>{W.clear();const{code:p,msg:i,data:b}=f.data;w.Toast(i),p==0&&ye.Down(b.path+b.filename,b.filename),E("submit",p==0)})},x=()=>{E("update:show",!1)};return(W,f)=>(c(),se(le,{show:D.value,"onUpdate:show":f[1]||(f[1]=p=>D.value=p),title:Y.title||h(T).export,width:"360px",bottom:"40px",onClose:f[2]||(f[2]=p=>x())},{bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:f[0]||(f[0]=p=>n())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[s("span",{innerHTML:h(T).export_warn(Y.num)},null,8,Qe)]),_:1})]),_:1},8,["show","title"]))}}),Ze={class:"goods_info flex"},et={class:"goods_info_tools flex"},tt={class:"goods_info_total"},st={class:"tCenter"},lt={class:"tCenter"},at={class:"flex_center"},ot={class:"flex_center"},it={class:"flex_center"},nt={key:0,class:"c_success"},ut={key:1,class:"c_info"},dt={key:2,class:"c_info"},rt=ue({__name:"import",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,S=de().state,T=S.langs,D=L(!1),n=L({key:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"40px",textAlign:"center"},{title:"商品编码",index:"sku_id"},{title:"数量",slot:"num",textAlign:"center",width:"80px",minWidth:"80px"},{title:"操作",slot:"action",textAlign:"center",width:"80px",minWidth:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"status",textAlign:"center",width:"80px"}],list:[],num:0});L({show:!1,title:"新增商品",cost_price:"0.00",supply_price:"0.00",sale_price:"0.00",purchase_price:"0.00",supplier_price:"0.00",market_price:"0.00",weight:"0.00",unit:"个",sku_id:"",labels:"",name:"",category:"",properties_value:"",brand:"",short_name:"",i_id:"",owner:"",supplier_name:""});const x=L({show:!1,type:"",title:"移除",info:"",index:0});ne(()=>y.show,I=>{D.value=I},{deep:!0});const W=()=>{const I=n.value.key.trim().toUpperCase();if(I.length==0)return;const $=I.split(" ");for(let A of $){if(A=oe.LTrim(A,"0"),p(A)){w.Toast("[ "+A+" ]已存在!");continue}n.value.list.unshift({sku_id:A,num:1})}n.value.key="",i()},f=()=>{ye.Select({mimeType:[]},I=>{ye.FileToBase64(I,$=>{const A=We($,{type:"binary"}),j=A.SheetNames[0],G=Pe.sheet_to_json(A.Sheets[j],{raw:!1});if(G.length>3e3)return w.Toast("不能超过3000条");let X="";for(let te of G){if(!te.商品编码||!te.数量){w.Toast("必须存在“商品编码”、“数量”");continue}if(X=oe.LTrim(oe.Trim(te.商品编码).toUpperCase(),"0"),p(X)){w.Toast("[ "+X+" ]已存在!");continue}n.value.list.push({sku_id:X,num:te.数量})}i()},"blob")})},p=I=>{for(let $ of n.value.list)if(I==$.sku_id)return!0;return!1},i=()=>{const I=n.value.list;n.value.num=0;for(let $ of I)n.value.num+=parseInt($.num)},b=(I,$=0)=>{if(n.value.list.length==0)return w.Toast("无商品资料!");x.value.show=!0,x.value.type=I,I=="all"?(x.value.title="清空",x.value.info="移除全部资料"):(I="one")&&(x.value.title="移除",x.value.info=n.value.list[$].sku_id,x.value.index=$)},U=()=>{x.value.show=!1,x.value.type=="all"?n.value.list=[]:x.value.type=="one"&&n.value.list.splice(x.value.index,1),i()},H=()=>{if(n.value.list.length<1)return w.Toast("暂无导入数据!");const I=w.Loading();K.Post("erp_purchase_in/goods_safety?lang="+S.lang,{token:S.token,wms_co_id:y.data.wms_co_id,data:n.value.list},$=>{I.clear();const{code:A,msg:j,data:G}=$.data;A===0?(E("submit",n.value.list),n.value.num=0,n.value.list=[],N()):A===5e3?(w.Toast(j),n.value.list=G||[]):w.Toast(j)})},N=()=>{E("update:show",!1)};return(I,$)=>(c(),g(Q,null,[r(le,{show:D.value,"onUpdate:show":$[5]||($[5]=A=>D.value=A),title:Y.title,width:"720px",top:"56px",bottom:"40px",overflow:"hidden auto",onClose:$[6]||($[6]=A=>N())},{top:t(()=>[s("div",Ze,[s("ul",et,[s("li",null,[r(_e,{value:n.value.key,"onUpdate:value":$[0]||($[0]=A=>n.value.key=A),onKeyup:$[1]||($[1]=we(A=>W(),["enter"])),onTextClick:$[2]||($[2]=A=>f()),text:"选择文件",textColor:"#0064C8",placeholder:"商品编码，多条空格分隔",width:"320px",padding:"0 40px 0 10px"},null,8,["value"])]),s("li",null,[r(M,{type:"danger",effect:"text",padding:"0 4px",onClick:$[3]||($[3]=A=>b("all"))},{default:t(()=>[...$[9]||($[9]=[k("清空",-1)])]),_:1})])]),s("div",tt,[$[10]||($[10]=k(" 数量: ",-1)),s("b",null,u(n.value.num),1)])])]),bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:$[4]||($[4]=A=>H())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref:"tableList",columns:n.value.columns,options:n.value.list,isCheckbox:!1},{index:t(A=>[s("div",st,u(A.index+1),1)]),num:t(A=>[s("div",lt,u(A.num),1)]),action:t(A=>[s("div",at,[r(M,{type:"danger",effect:"text",padding:"0 4px",onClick:j=>b("one",A.index)},{default:t(()=>[k(u(h(T).remove),1)]),_:1},8,["onClick"])])]),view:t(A=>[s("div",ot,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:j=>{h(S).goods.show=!0,h(S).goods.sku_id=A.sku_id}},{default:t(()=>[k(u(h(T).flow),1)]),_:1},8,["onClick"])])]),status:t(A=>[s("div",it,[A.status===!0?(c(),g("span",nt,"可用")):A.status===!1?(c(),g("span",ut,u(A.status_name),1)):(c(),g("span",dt,"-"))])]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),r(le,{show:x.value.show,"onUpdate:show":$[8]||($[8]=A=>x.value.show=A),title:x.value.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[r(M,{effect:"dark",type:"danger",height:"40px",onClick:$[7]||($[7]=A=>U())},{default:t(()=>[k(u(h(T).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[k(u(x.value.info),1)]),_:1})]),_:1},8,["show","title"])],64))}}),pt={class:"goods_info flex"},mt={class:"goods_info_tools flex"},ct={key:0},vt={key:1},_t={key:2},ft={key:3},gt={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 630px)"}},xt={class:"tCenter"},ht={class:"flex_center"},kt=["onClick"],wt=["onClick"],yt={class:"tCenter"},bt={class:"tCenter"},$t={class:"tRight"},Ct={key:0},At={key:1},Tt={key:1},St={class:"tRight"},Ut={key:0},Dt={key:1},Lt={key:1},Wt={class:"tRight"},Pt={key:0},It={key:1},Bt={key:1},Yt={class:"tCenter"},Ht={class:"tCenter"},Rt={class:"tCenter"},Mt={key:1},Nt={class:"tCenter"},Ft={class:"tCenter"},jt={class:"tCenter"},Vt={key:0,class:"flex_center status2"},Et={key:1,class:"tCenter"},Ot={class:"tCenter"},Kt={class:"tCenter"},zt={class:"flex_center"},Gt={key:0,class:"c_danger"},qt={key:1,class:"c_success"},Jt=["title"],Qt={class:"tCenter color1"},Xt=ue({__name:"goods",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,V=L(),T=de().state,D=T.langs,n=be.priceEncode,x=Se.isAction,W=L(!1);let f=null,p=[];const i=L({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:D.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",order:"",width:"150px",minWidth:"150px"},{title:"暗码",slot:"short_name",index:"short_name",order:"",textAlign:"center",width:"80px"},{title:"款式编码",slot:"i_id",index:"i_id",order:"",textAlign:"center",width:"80px"},{title:"商品名称",index:"name",order:"",width:"80px"},{title:"颜色及规格",index:"properties_value",order:""},{title:"供应链价(元)",slot:"supply_price",index:"supply_price",order:"",textAlign:"center",width:"100px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px"},{title:"重量",slot:"weight",index:"weight",order:"",textAlign:"center",width:"60px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"折扣",slot:"ratio",index:"ratio",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"标签",slot:"labels",index:"labels",order:"",textAlign:"center",width:"80px"},{title:"分类",slot:"category",index:"category",order:"",textAlign:"center",width:"80px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"采购员",slot:"owner",index:"owner",order:"",textAlign:"center",width:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作",slot:"action",textAlign:"center",width:"60px",minWidth:"60px"},{title:"时间",slot:"utime",index:"utime",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作员",slot:"operator_name",index:"operator_name",order:"",textAlign:"center",width:"60px",minWidth:"60px"}],list:[],cost_price:0,sale_price:0,purchase_price:0,market_price:0,num:0,print:0,total:0,is_sku:{label:"校对商品",value:"is_sku",checked:!0},remove:{show:!1,type:"",title:"",info:"",data:[]},refresh:!1}),b=L({show:!1,title:"导入"}),U=L(!1),H=L(0),N=L([]);ne(()=>y.show,_=>{W.value=_,_&&(i.value.key="",i.value.refresh=!1,j())},{deep:!0}),ne(()=>T.goods.photo.refresh,_=>{_&&(j(),i.value.refresh=_)},{deep:!0});const I=(_,d)=>{i.value.print=_,i.value.total=d},$=_=>{i.value.order=_,j()},A=()=>{const _=oe.LTrim(i.value.key.trim().toUpperCase(),"0");if(i.value.key="",y.data.status==0){if(_.length==0)return;X([{sku_id:_,num:1}])}else j(_)},j=(_="")=>{i.value.list=[],G(!1);const d=w.Loading();K.Post("erp_purchase_in/goods_list?lang="+T.lang,{token:T.token,id:y.data.id,order:i.value.order,sku_id:_},e=>{d.clear();const{code:C,msg:B,data:m}=e.data;C==0?(i.value.list=m,re(),G(!1)):w.Toast(B)})},G=_=>{const d=i.value.list;i.value.cost_price=0,i.value.sale_price=0,i.value.purchase_price=0,i.value.market_price=0,i.value.num=0;const e=d.length-1,C=e>=0?d[e].sku_id:"";let B=0,m=0;for(let l of d)l.ratio&&(B=parseInt(l.num),m=parseFloat(l.ratio),i.value.cost_price+=parseFloat(l.cost_price)*B*m,i.value.sale_price+=parseFloat(l.sale_price)*B*m,i.value.purchase_price+=parseFloat(l.purchase_price)*B*m,i.value.market_price+=parseFloat(l.market_price)*B*m,i.value.num+=B,l.is_date=C.substring(0,7)!=l.sku_id.substring(0,7));_&&(i.value.refresh=!0)},X=(_,d="")=>{for(let e of _){const C=te(e.sku_id);if(i.value.is_sku.checked&&C)return w.Toast("[ "+e.sku_id+" ]已存在",5e3,"danger");if(C)for(let B of i.value.list)B.sku_id==e.sku_id&&(B.num+=parseInt(e.num),e.num=B.num,w.Toast("[ "+e.sku_id+" ]数量 "+B.num+" "));else i.value.list.unshift({id:"s"+e.sku_id,sku_id:e.sku_id,num:e.num,loading:0})}d==="import"?pe(_):(p.push(_[0]),clearTimeout(f),f=setTimeout(()=>{pe(p),p=[]},800))},te=_=>{let d=!1;for(let e of i.value.list)e.sku_id==_&&(d=!0);return d},pe=_=>{let d=_;K.Post("erp_purchase_in/goods_add?lang="+T.lang,{token:T.token,id:y.data.id,ctime:y.data.ctime,wms_co_id:y.data.wms_co_id,data:_},e=>{const{code:C,msg:B,data:m,err:l}=e.data;if(C===0)ie(m),G(!0);else if(C===5e3){if(w.Toast(B,5e3,"danger"),m&&m.length>0&&ie(m),l&&l.length>0){const a=i.value.list;for(let P of l)for(let J in a)P==a[J].sku_id&&(a[J].loading=1)}}else B?w.Toast(B):ie(d,!0)},()=>{ie(d,!0)})},ie=(_,d=!1)=>{if(_.length==0)return;const e=i.value.list;for(let C in _){_[C].brand!=y.data.brand&&w.Toast("[ "+_[C].sku_id+" ]品牌为“"+_[C].brand+"”不等于“"+y.data.brand+"”",5e3,"danger");for(let B in e)if(e[B].sku_id==_[C].sku_id){d?e[B].loading=1:e[B]=_[C];continue}}},fe=(_,d,e)=>{const C=parseInt(_);if(C.toString()=="NaN")return w.Toast("请输入数字");for(let B of i.value.list)B.sku_id==e&&(B.num=C);K.Post("erp_purchase_in/goods_num?lang="+T.lang,{token:T.token,id:d,num:C,sku_id:e,pid:y.data.id,ctime:y.data.ctime,wms_co_id:y.data.wms_co_id},B=>{const{code:m,msg:l}=B.data;m==0?(w.Toast(l),G(!0)):w.Toast(l,5e3,"danger")})},ce=()=>{const _=i.value.list;let d=[];for(let e of _)e.id.toString().substring(0,1)!=="s"&&d.push({id:e.id,sku_id:e.sku_id,properties_value:e.properties_value,sale_price:e.sale_price,market_price:e.market_price,img:e.img});T.goods.show=!0,T.goods.photo.refresh=!1,T.goods.photo.id=y.data.id,T.goods.photo.ctime=y.data.ctime,T.goods.photo.wms_co_id=y.data.wms_co_id,T.goods.photo.list=d},ve=(_,d={})=>{if(i.value.remove.type=_,i.value.remove.data=[],_=="one")i.value.remove.show=!0,i.value.remove.title='移除" '+d.sku_id+' "',i.value.remove.info="是否移除单条数据?",i.value.remove.data=[{index:d.index,id:d.id,sku_id:d.sku_id,num:d.num}];else if(_=="part"){const e=V.value.getData();if(e.length==0)return w.Toast("请选择数据");i.value.remove.show=!0,i.value.remove.title="移除选中",i.value.remove.info="是否移除选中数据?";for(let C of e)i.value.remove.data.unshift({index:C.index,id:C.id,sku_id:C.sku_id,num:C.num})}},R=()=>{i.value.remove.show=!1;const _=i.value.remove.data,d=i.value.list;let e=[];for(let B of _){if(B.id.toString().substring(0,1)=="s"){d.splice(B.index,1),G(!0);continue}e.push({index:B.index,id:B.id,sku_id:B.sku_id,num:B.num})}if(e.length==0)return;const C=w.Loading();K.Post("erp_purchase_in/goods_remove?lang="+T.lang,{token:T.token,id:y.data.id,ctime:y.data.ctime,wms_co_id:y.data.wms_co_id,data:e},B=>{C.clear();const{code:m,msg:l}=B.data;if(m==0){if(i.value.remove.type=="all")i.value.list=[];else for(let a of e)d.splice(a.index,1);G(!0)}else w.Toast(l,5e3,"danger")})},v=()=>{b.value.show=!0,b.value.title="导入"},o=_=>{_.length<1||X(_,"import")},F=_=>{let d=[],e=0;for(let C of i.value.list)C.img&&(C.img==_&&(H.value=e),d.push({label:C.sku_id,value:C.img,other:{颜色及规格:C.properties_value,标签价:C.sale_price+"元",吊牌价:C.market_price+"W"}}),e++);U.value=!0,N.value=d},q=(_,d)=>{const e=V.value.getData();let C="";for(let B in e)C+=e[B][_]+" ";C?oe.CopyText(C):oe.CopyText(d)},Z=()=>{if(i.value.print<=0)return w.Toast("请选择!");const _=V.value.getData();let d=[];for(let e of _)d.push({sku_id:e.sku_id});if(d.length==0)return w.Toast("请选择!");T.print.sku=d,T.print.show=!0},re=()=>{he(()=>{V.value.checkboxAll(!1)})},ge=()=>{for(let _ of i.value.list)if(_.brand!=y.data.brand&&w.Toast("[ "+_.sku_id+" ]品牌为“"+_.brand+"”不等于“"+y.data.brand+"”",5e3,"danger"),_.loading==0||_.loading==1)return w.Toast("["+_.sku_id+"]未加载完成!");if(i.value.refresh){const _=w.Loading();K.Post("erp_purchase_in/goods_price?lang="+T.lang,{token:T.token,id:y.data.id,ctime:y.data.ctime},d=>{_.clear();const{code:e,msg:C}=d.data;e!==0&&w.Toast(C,5e3,"danger"),E("update:show",!1),E("submit",i.value.refresh)})}else E("update:show",!1),E("submit",i.value.refresh)};return(_,d)=>(c(),g(Q,null,[r(le,{show:W.value,"onUpdate:show":d[7]||(d[7]=e=>W.value=e),title:Y.title,width:"calc(100% - 40px)",top:"56px",bottom:"0px",overflow:"auto",bgClose:!1,onClose:d[8]||(d[8]=e=>ge())},{top:t(()=>[s("div",pt,[s("ul",mt,[s("li",null,[r(_e,{value:i.value.key,"onUpdate:value":d[0]||(d[0]=e=>i.value.key=e),onKeyup:d[1]||(d[1]=we(e=>A(),["enter"])),onIconClick:d[2]||(d[2]=e=>A()),placeholder:h(T).langs.sku_id,maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value","placeholder"])]),Y.data.status==0?(c(),g(Q,{key:0},[s("li",null,[r(Ie,{options:i.value.is_sku},null,8,["options"])]),h(x)("save")?(c(),g("li",ct,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:d[3]||(d[3]=e=>ce())},{default:t(()=>[...d[14]||(d[14]=[k("拍照",-1)])]),_:1})])):ee("",!0),h(x)("save")?(c(),g("li",vt,[r(M,{type:"danger",effect:"text",padding:"0 4px",onClick:d[4]||(d[4]=e=>ve("part"))},{default:t(()=>[...d[15]||(d[15]=[k("移除",-1)])]),_:1})])):ee("",!0),h(x)("goods_imp")?(c(),g("li",_t,"|")):ee("",!0),h(x)("goods_imp")?(c(),g("li",ft,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:d[5]||(d[5]=e=>v())},{default:t(()=>[...d[16]||(d[16]=[k("导入",-1)])]),_:1})])):ee("",!0),d[17]||(d[17]=s("li",null,"|",-1))],64)):ee("",!0),s("li",null,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:d[6]||(d[6]=e=>Z())},{default:t(()=>[k("打印标签("+u(i.value.print)+")",1)]),_:1})])]),s("div",gt,[d[18]||(d[18]=k(" 标签价: ",-1)),s("b",null,u(h(n)(i.value.sale_price)),1),d[19]||(d[19]=k(" 元   吊牌价: ",-1)),s("b",null,u(h(n)(i.value.market_price)),1),d[20]||(d[20]=k(" W   数量: ",-1)),s("b",null,u(i.value.num),1)])])]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref_key:"tableList",ref:V,columns:i.value.columns,options:i.value.list,onOrderBy:$,onPartially:I,maxLen:100},{index:t(e=>[s("div",xt,u(i.value.list.length-e.index),1)]),img:t(e=>[s("div",ht,[s("span",{onClick:C=>e.img?F(e.img):""},[r(De,{img:e.img?e.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,kt)])]),sku_id:t(e=>[s("div",{class:Ae(["copy",e.is_date?"c_danger":"c_primary"])},[k(u(e.sku_id),1),s("span",{onClick:C=>q("sku_id",e.sku_id)},"复",8,wt)],2)]),short_name:t(e=>[s("div",yt,u(e.short_name||"-"),1)]),i_id:t(e=>[s("div",bt,u(e.i_id||"-"),1)]),supply_price:t(e=>[s("div",$t,[e.supply_price>0?(c(),g(Q,{key:0},[e.ratio!="1.00"?(c(),g("span",Ct,[s("del",null,u(h(n)(e.supply_price)),1),d[21]||(d[21]=k()),s("b",null,u(h(n)(e.supply_price*e.ratio)),1)])):(c(),g("b",At,u(h(n)(e.supply_price)),1))],64)):(c(),g("span",Tt,"-"))])]),sale_price:t(e=>[s("div",St,[e.sale_price>0?(c(),g(Q,{key:0},[e.ratio!="1.00"?(c(),g("span",Ut,[s("del",null,u(h(n)(e.sale_price)),1),d[22]||(d[22]=k()),s("b",null,u(h(n)(e.sale_price*e.ratio)),1)])):(c(),g("b",Dt,u(h(n)(e.sale_price)),1))],64)):(c(),g("span",Lt,"-"))])]),market_price:t(e=>[s("div",Wt,[e.market_price>0?(c(),g(Q,{key:0},[e.ratio!="1.00"?(c(),g("span",Pt,[s("del",null,u(h(n)(e.market_price)),1),d[23]||(d[23]=k()),s("b",null,u(h(n)(e.market_price*e.ratio)),1)])):(c(),g("b",It,u(h(n)(e.market_price)),1))],64)):(c(),g("span",Bt,"-"))])]),unit:t(e=>[s("div",Yt,u(e.unit||"-"),1)]),weight:t(e=>[s("div",Ht,u(e.weight||"-"),1)]),num:t(e=>[s("div",Rt,[Y.data.status==0&&e.loading!=0?(c(),se(_e,{key:0,value:e.num,"onUpdate:value":C=>e.num=C,"onUpdate:blur":C=>fe(C,e.id,e.sku_id),inputAlign:"center"},null,8,["value","onUpdate:value","onUpdate:blur"])):(c(),g("span",Mt,[s("b",null,u(e.num||"-"),1)]))])]),ratio:t(e=>[s("div",Nt,u(e.ratio||"-"),1)]),labels:t(e=>[s("div",Ft,u(e.labels||"-"),1)]),category:t(e=>[s("div",jt,u(e.category||"-"),1)]),brand:t(e=>[e.brand!=Y.data.brand?(c(),g("div",Vt,u(e.brand||">"),1)):(c(),g("div",Et,u(e.brand||">"),1))]),owner:t(e=>[s("div",Ot,u(e.owner||"-"),1)]),view:t(e=>[s("div",Kt,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:C=>{h(T).goods.show=!0,h(T).goods.sku_id=e.sku_id}},{default:t(()=>[k(u(h(D).flow),1)]),_:1},8,["onClick"])])]),action:t(e=>[s("div",zt,[Y.data.status==0?(c(),g(Q,{key:0},[e.loading==0?(c(),se(M,{key:0,type:"warning",effect:"text",padding:"0 4px"},{default:t(()=>[...d[24]||(d[24]=[k("加载中",-1)])]),_:1})):e.loading==1?(c(),se(M,{key:1,type:"success",effect:"text",padding:"0 4px",onClick:C=>pe([{id:e.id,sku_id:e.sku_id,num:e.num}])},{default:t(()=>[...d[25]||(d[25]=[k("刷新",-1)])]),_:1},8,["onClick"])):ee("",!0),e.loading!=0?(c(),se(M,{key:2,type:"danger",effect:"text",padding:"0 4px",onClick:C=>ve("one",e)},{default:t(()=>[...d[26]||(d[26]=[k("移除",-1)])]),_:1},8,["onClick"])):ee("",!0)],64)):(c(),g(Q,{key:1},[e.status==0?(c(),g("span",Gt,"待入库")):e.status==1?(c(),g("span",qt,"完成")):ee("",!0)],64))])]),utime:t(e=>[s("div",{class:"tCenter color1",title:"创建: "+e.ctime+`
更新: `+e.utime},u(e.ctime?e.ctime.substr(11,8):"-"),9,Jt)]),operator_name:t(e=>[s("div",Qt,u(e.operator_name||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),r(le,{show:i.value.remove.show,"onUpdate:show":d[10]||(d[10]=e=>i.value.remove.show=e),title:i.value.remove.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[r(M,{effect:"dark",type:"danger",height:"40px",onClick:d[9]||(d[9]=e=>R())},{default:t(()=>[k(u(h(D).confirm),1)]),_:1})]),default:t(()=>[r(ae,{lineHeight:"60px"},{default:t(()=>[k(u(i.value.remove.info),1)]),_:1})]),_:1},8,["show","title"]),r(rt,{show:b.value.show,"onUpdate:show":d[11]||(d[11]=e=>b.value.show=e),title:b.value.title,data:{wms_co_id:y.data.wms_co_id},onSubmit:d[12]||(d[12]=e=>o(e))},null,8,["show","title","data"]),r(Ce,{show:U.value,"onUpdate:show":d[13]||(d[13]=e=>U.value=e),index:H.value,options:N.value},null,8,["show","index","options"])],64))}}),Zt=$e(Xt,[["__scopeId","data-v-6aa119f4"]]),es={class:"goods_info flex"},ts={class:"goods_info_tools flex"},ss={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},ls={class:"tCenter"},as={class:"flex_center"},os=["onClick"],is={class:"copy c_primary"},ns=["onClick"],us={class:"tCenter"},ds={class:"tRight"},rs={key:0},ps={key:1},ms={key:1},cs={class:"tRight"},vs={key:0},_s={key:1},fs={key:1},gs={class:"tCenter"},xs={class:"tCenter"},hs={class:"tCenter"},ks={class:"tCenter"},ws={key:0,class:"c_danger"},ys={key:1,class:"c_success"},bs={class:"tCenter"},$s={class:"tCenter type"},Cs={key:0,class:"type_warning"},As={key:1,class:"type_success"},Ts={key:2,class:"type_warning"},Ss={key:3,class:"type_success"},Us={key:4,class:"type_info"},Ds={key:5,class:"type_danger"},Ls={key:6,class:"type_primary"},Ws={key:7,class:"type_info"},Ps={class:"tCenter"},Is={class:"goods_info flex"},Bs={class:"goods_info_tools flex"},Ys={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},Hs={class:"tCenter"},Rs={class:"tCenter"},Ms={class:"tCenter"},Ns={class:"tCenter"},Fs={class:"tCenter"},js={key:0,class:"flex_center status0"},Vs={key:1,class:"flex_center status1"},Es={key:2,class:"flex_center status2"},Os={key:3,class:"tCenter"},Ks=ue({__name:"diff",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(Y,{emit:z}){const y=Y,E=z,V=L(),S=L(),D=de().state,n=D.langs,x=be.priceEncode,W=L(!1);let f=L([]);const p=L({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:n.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",width:"120px",minWidth:"120px"},{title:"款式编码",slot:"i_id",index:"i_id",textAlign:"center",width:"80px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px"},{title:"重量",slot:"weight",index:"weight",textAlign:"center",width:"60px"},{title:"数量",slot:"num",index:"num",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"action",index:"status",textAlign:"center",width:"60px",minWidth:"60px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"类型",slot:"type_name",textAlign:"center",width:"60px"},{title:"采购员",slot:"owner",textAlign:"center",width:"60px"},{title:"仓库",index:"warehouse"}],list:[],sale_price:0,market_price:0,num:0,out_num:0}),i=L({show:!1,key:"",order:"",columns:[{title:"单号",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:n.date,index:"date",slot:"date",width:"90px",textAlign:"center"},{title:"类型",slot:"type",width:"80px",minWidth:"80px",textAlign:"center"},{title:"仓库",index:"wms_co_name"},{title:"数量",slot:"num",textAlign:"center"},{title:"条数",slot:"total",textAlign:"center"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:"制单员",index:"creator_name",textAlign:"center"},{title:"备注",index:"remark"}],list:[],total:0,num:0}),b=L(!1),U=L(0),H=L([]);ne(()=>y.show,R=>{if(W.value=R,R){f.value=[];for(let v of y.data)K.Post("erp_purchase_in/goods_list?lang="+D.lang,{token:D.token,id:v},o=>{const{code:F,msg:q,data:Z}=o.data;if(F==0)for(let re of Z)f.value.push(re);else w.Toast(q)})}},{deep:!0});const N=R=>{p.value.order=R,$(p.value.key)},I=()=>{const R=oe.LTrim(p.value.key.trim().toUpperCase(),"0");$(R)},$=R=>{p.value.list=[],p.value.out_num=0;const v=R.split(" ");for(let o of v){const F=w.Loading();K.Post("erp_purchase_out/goods_list?lang="+D.lang,{token:D.token,id:o},q=>{F.clear();const{code:Z,msg:re,data:ge}=q.data;if(Z==0)for(let _ of ge)p.value.out_num+=_.num,A(_.sku_id)||(p.value.list.push({sku_id:_.sku_id}),j(_.sku_id));else w.Toast(re)})}},A=(R="")=>{for(let v of f.value)if(R===v.sku_id)return!0;return!1},j=R=>{K.Post("goods/direct?lang="+D.lang,{token:D.token,sku_id:R,time:24},v=>{const{code:o,msg:F,data:q}=v.data;if(o==0){if(q.list.length===0)return;for(let Z in p.value.list)p.value.list[Z].sku_id==q.list[0].sku_id&&(p.value.list[Z]=q.list[0],G())}else w.Toast(F)})},G=()=>{p.value.sale_price=0,p.value.market_price=0,p.value.num=0;for(let R of p.value.list)p.value.sale_price+=R.sale_price*R.num,p.value.market_price+=R.market_price*R.num,p.value.num+=R.num},X=()=>{const R=oe.LTrim(i.value.key.trim().toUpperCase(),"0");i.value.key="",te(R)},te=R=>{i.value.list=[];const v=w.Loading();K.Post("erp_purchase_out/list?lang="+D.lang,{token:D.token,data:{key:R},page:1,limit:30,order:""},o=>{v.clear();const{code:F,msg:q,data:Z,time:re}=o.data;F==0?(i.value.list=Z,he(()=>{S.value.checkboxAll(!1)})):w.Toast(q)})},pe=(R,v)=>{i.value.total=R,i.value.num=0;const o=S.value.getData();for(let F of o)i.value.num+=parseInt(F.num)},ie=()=>{const R=S.value.getData();if(R.length==0)return w.Toast("请选择采退单");let v=[];for(let o of R)v.push(o.id);i.value.show=!1,p.value.key=v.join(" "),I()},fe=R=>{let v=[],o=0;for(let F of p.value.list)F.img&&(F.img==R&&(U.value=o),v.push({label:F.sku_id,value:F.img,other:{颜色及规格:F.properties_value,标签价:F.sale_price+"元",吊牌价:F.market_price+"W"}}),o++);b.value=!0,H.value=v},ce=(R,v)=>{const o=V.value.getData();let F="";for(let q in o)F+=o[q][R]+" ";F?oe.CopyText(F):oe.CopyText(v)},ve=()=>{f.value=[],p.value.key="",p.value.list=[],p.value.num=0,p.value.out_num=0,p.value.sale_price=0,p.value.market_price=0,E("update:show",!1)};return(R,v)=>(c(),g(Q,null,[r(le,{show:W.value,"onUpdate:show":v[4]||(v[4]=o=>W.value=o),title:Y.title,width:"calc(100% - 40px)",maxWidth:"1366px",overflow:"auto",top:"56px",bottom:"0px",bgClose:!1,onClose:v[5]||(v[5]=o=>ve())},{top:t(()=>[s("div",es,[s("ul",ts,[s("li",null,[r(_e,{value:p.value.key,"onUpdate:value":v[0]||(v[0]=o=>p.value.key=o),onKeyup:v[1]||(v[1]=we(o=>I(),["enter"])),onIconClick:v[2]||(v[2]=o=>I()),placeholder:"采退单号,多个空格分离",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])]),s("li",null,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:v[3]||(v[3]=o=>{i.value.show=!0,te(i.value.key)})},{default:t(()=>[...v[13]||(v[13]=[k("选择采退单",-1)])]),_:1})])]),s("div",ss,[v[14]||(v[14]=k(" 入库数: ",-1)),s("b",null,u(Y.num),1),v[15]||(v[15]=k("    采退数: ",-1)),s("b",null,u(p.value.out_num),1),v[16]||(v[16]=k("    标签价: ",-1)),s("b",null,u(h(x)(p.value.sale_price)),1),v[17]||(v[17]=k(" 元   吊牌价: ",-1)),s("b",null,u(h(x)(p.value.market_price)),1),v[18]||(v[18]=k(" W   数量: ",-1)),s("b",null,u(p.value.num),1)])])]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref_key:"tableList",ref:V,columns:p.value.columns,options:p.value.list,onOrderBy:N},{index:t(o=>[s("div",ls,u(p.value.list.length-o.index),1)]),img:t(o=>[s("div",as,[s("span",{onClick:F=>o.img?fe(o.img):""},[r(De,{img:o.img?o.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,os)])]),sku_id:t(o=>[s("div",is,[k(u(o.sku_id),1),s("span",{onClick:F=>ce("sku_id",o.sku_id)},"复",8,ns)])]),i_id:t(o=>[s("div",us,u(o.i_id||"-"),1)]),sale_price:t(o=>[s("div",ds,[o.sale_price>0?(c(),g(Q,{key:0},[o.ratio!="1.00"?(c(),g("span",rs,[s("del",null,u(h(x)(o.sale_price)),1),v[19]||(v[19]=k()),s("b",null,u(h(x)(o.sale_price*o.ratio)),1)])):(c(),g("b",ps,u(h(x)(o.sale_price)),1))],64)):(c(),g("span",ms,"-"))])]),market_price:t(o=>[s("div",cs,[o.market_price>0?(c(),g(Q,{key:0},[o.ratio!="1.00"?(c(),g("span",vs,[s("del",null,u(h(x)(o.market_price)),1),v[20]||(v[20]=k()),s("b",null,u(h(x)(o.market_price*o.ratio)),1)])):(c(),g("b",_s,u(h(x)(o.market_price)),1))],64)):(c(),g("span",fs,"-"))])]),unit:t(o=>[s("div",gs,u(o.unit||"-"),1)]),weight:t(o=>[s("div",xs,u(o.weight||"-"),1)]),num:t(o=>[s("div",hs,[s("b",null,u(o.num||"-"),1)])]),action:t(o=>[s("div",ks,[o.status==0?(c(),g("span",ws,"进行中")):o.status==1?(c(),g("span",ys,"完成")):ee("",!0)])]),view:t(o=>[s("div",bs,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:F=>{h(D).goods.show=!0,h(D).goods.sku_id=o.sku_id}},{default:t(()=>[k(u(h(n).flow),1)]),_:1},8,["onClick"])])]),type_name:t(o=>[s("div",$s,[o.type=="6"?(c(),g("span",Cs,u(o.type_name||"-"),1)):o.type=="5"?(c(),g("span",As,u(o.type_name||"-"),1)):o.type=="4"?(c(),g("span",Ts,u(o.type_name||"-"),1)):o.type=="3"?(c(),g("span",Ss,u(o.type_name||"-"),1)):o.type=="2"?(c(),g("span",Us,u(o.type_name||"-"),1)):o.type=="1"?(c(),g("span",Ds,u(o.type_name||"-"),1)):o.type=="0"?(c(),g("span",Ls,u(o.type_name||"-"),1)):o.type=="-1"?(c(),g("span",Ws,u(o.type_name||"-"),1)):ee("",!0)])]),owner:t(o=>[s("div",Ps,u(o.owner||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),r(Ce,{show:b.value,"onUpdate:show":v[6]||(v[6]=o=>b.value=o),index:U.value,options:H.value},null,8,["show","index","options"]),r(le,{show:i.value.show,"onUpdate:show":v[11]||(v[11]=o=>i.value.show=o),title:"选择采退单",width:"calc(100% - 40px)",maxWidth:"1280px",overflow:"auto",top:"56px",bottom:"40px",onClose:v[12]||(v[12]=o=>i.value.show=!1)},{top:t(()=>[s("div",Is,[s("ul",Bs,[s("li",null,[r(_e,{value:i.value.key,"onUpdate:value":v[7]||(v[7]=o=>i.value.key=o),onKeyup:v[8]||(v[8]=we(o=>X(),["enter"])),onIconClick:v[9]||(v[9]=o=>X()),placeholder:"单号、商品编码、备注",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])])]),s("div",Ys,[v[21]||(v[21]=k(" 入库数: ",-1)),s("b",null,u(Y.num),1),v[22]||(v[22]=k("   采退数: ",-1)),s("b",null,u(i.value.num),1),v[23]||(v[23]=k("    差异: ",-1)),s("b",null,u(Y.num-i.value.num>0?Y.num-i.value.num:i.value.num-Y.num),1)])])]),bottom:t(()=>[r(M,{height:"40px",padding:"0 32px",onClick:v[10]||(v[10]=o=>ie())},{default:t(()=>[k(u(h(n).confirm),1)]),_:1})]),default:t(()=>[r(ae,{paddingY:"4px"},{default:t(()=>[r(ke,{ref_key:"formList",ref:S,overflow:"auto",columns:i.value.columns,options:i.value.list,onPartially:pe},{id:t(o=>[s("div",Hs,u(o.id),1)]),date:t(o=>[s("div",Rs,[r(Te,{title:"创建: "+o.ctime+`
更新: `+o.utime+`
制单: `+o.creator_name+", 审核: "+o.operator_name+`
备注: `+o.remark},{default:t(()=>[k(u(o.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(o=>[s("div",Ms,u(o.type_name),1)]),num:t(o=>[s("div",Ns,u(o.num),1)]),total:t(o=>[s("div",Fs,u(o.total),1)]),status:t(o=>[o.status=="0"?(c(),g("div",js,u(o.status_name),1)):o.status=="1"?(c(),g("div",Vs,u(o.status_name),1)):o.status=="2"?(c(),g("div",Es,u(o.status_name),1)):(c(),g("div",Os,u(o.status_name),1))]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show"])],64))}}),zs=$e(Ks,[["__scopeId","data-v-6648b7f9"]]),Gs={class:"app_action flex"},qs={class:"app_action_tools scrollbar"},Js={key:0,class:"line"},Qs={key:0,class:"line"},Xs={class:"app_action_search flex"},Zs={class:"custom_time flex_center"},el=["onClick"],tl={class:"app_ct"},sl={class:"tCenter"},ll={class:"tCenter"},al={class:"tCenter"},ol={class:"tCenter"},il={class:"tRight"},nl={class:"tRight"},ul={class:"tCenter"},dl={class:"tCenter"},rl={key:0,class:"flex_center status0"},pl={key:1,class:"flex_center status1"},ml={key:2,class:"flex_center status2"},cl={key:3,class:"tCenter"},vl={class:"tCenter"},_l={key:2,class:"c_info"},fl={class:"tCenter"},gl={class:"tCenter"},xl={class:"app_page"},hl=ue({__name:"index",setup(Y){const z=L(!1),y=L(),V=de().state,S=V.langs,T=Se.isAction,D=be.priceEncode,n=L({show:!1,key:"",placeholder:"ID、品牌、操作员、备注",time:[O.Date("Y/m/d",O.StrToTime("-1 month")),O.Date("Y/m/d")],maxDate:O.Date("Y/m/d"),customTime:{active:"",list:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"3个月",value:"month"},{label:"近1年",value:"year"}]},columns:[{label:"",value:"",slot:"customTime"},{label:S.select,value:"",slot:"time"},{label:"仓库名称",value:"",slot:"wms_co_id"},{label:"入库类型",value:"",slot:"type"},{label:"状态",value:"",slot:"status"},{label:"品牌",value:"",slot:"brand"},{label:"单号, 多条空格分离",value:"",name:"id"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label:"制单员",value:"",name:"creator_name"},{label:"操作员",value:"",name:"operator_name"},{label:"备注",value:"",name:"remark"}],type:"",wms_co_id:"",brand:"",status:""}),x=L({time:"",list:{num:0,cost_price:0,sale_price:0,purchase_price:0,market_price:0}}),W=L({columns:[{title:"单号",slot:"id",textAlign:"center",width:"100px"},{title:S.date,slot:"date",textAlign:"center",width:"90px"},{title:"类型",slot:"type",index:"type",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"入库仓库",index:"wms_co_name",width:"200px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"标签总额(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌总额(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px"},{title:"条数",slot:"total",index:"total",order:"",textAlign:"center",width:"60px"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:S.action,slot:"action",textAlign:"center",width:"40px"},{title:"商品",slot:"goods",textAlign:"center",width:"40px"},{title:S.review,slot:"print",textAlign:"center",width:"40px"},{title:"制单员",index:"creator_name",textAlign:"center",width:"100px"},{title:"操作员",index:"operator_name",textAlign:"center",width:"100px"},{title:"备注",index:"remark"}],data:[],num:0,total:0,order:""}),f=L({total:0,num:1,limit:100}),p=L({show:!1,title:"添加/编辑",data:{}}),i=L({show:!1,title:"删除",data:[]}),b=L({show:!1,title:"推送",info:"",num:0,data:[]}),U=L({show:!1,title:"撤回",info:"",data:[]}),H=L({show:!1,title:"导出",num:0,data:[]}),N=L({show:!1,title:"对比",num:0,data:[]}),I=L({show:!1,title:"商品",data:{}}),$=L({show:!1,title:"入库单",info:{},columns:[],data:[]}),A=L({partner_name:[],brand_name:[],type_name:[],status_name:[]});Be(()=>{V.token&&B()}),Ye(()=>{z&&V.isLogin&&j()});const j=()=>{n.value.show=!1,W.value.data=[];const m=w.Loading();K.Post("erp_purchase_in/list?lang="+V.lang,{token:V.token,data:G(),page:f.value.num,limit:f.value.limit,order:W.value.order},l=>{m.clear();const{code:a,msg:P,data:J,time:xe}=l.data;a==0?(x.value.time=xe,W.value.data=J,he(()=>ie())):w.Toast(P)}),f.value.total=0,x.value.list.num=0,x.value.list.cost_price=0,x.value.list.sale_price=0,x.value.list.purchase_price=0,x.value.list.market_price=0,K.Post("erp_purchase_in/total?lang="+V.lang,{token:V.token,data:G()},l=>{const{code:a,msg:P,data:J,time:xe}=l.data;a==0?(x.value.time=xe,f.value.total=J.total,x.value.list.cost_price=J.cost_price,x.value.list.sale_price=J.sale_price,x.value.list.purchase_price=J.purchase_price,x.value.list.market_price=J.market_price,x.value.list.num=J.num):w.Toast(P)})},G=()=>{const m={key:n.value.key,stime:typeof n.value.time[0]=="string"?n.value.time[0]:O.Date("Y/m/d",n.value.time[0]),etime:typeof n.value.time[1]=="string"?n.value.time[1]:O.Date("Y/m/d",n.value.time[1]),wms_co_id:n.value.wms_co_id,type:n.value.type,status:n.value.status,brand:n.value.brand};for(let l of n.value.columns)l.name&&(m[l.name]=l.value);return m},X=(m,l)=>{W.value.num=m,W.value.total=l;const a=y.value.getData();i.value.data=[],b.value.data=[],b.value.num=0,H.value.data=[],H.value.num=0,N.value.data=[],N.value.num=0;for(let P of a)P.status==0&&(i.value.data.push(P.id),b.value.data.push(P.id),b.value.num+=parseInt(P.num)),H.value.data.push(P.id),H.value.num+=parseInt(P.num),N.value.data.push(P.id),N.value.num+=parseInt(P.num)},te=m=>{W.value.order=m,j()},pe=()=>{n.value.time=[O.Date("Y/m/d",O.StrToTime("-1 month")),O.Date("Y/m/d")],n.value.customTime.active="",n.value.key="",n.value.wms_co_id="",n.value.type="",n.value.status="",n.value.brand="";for(let m of n.value.columns)m.value="";W.value.order="",f.value.num=1,j()},ie=()=>{he(()=>{y.value.checkboxAll(!1)})},fe=m=>{switch(n.value.customTime.active=m,m){case"today":n.value.time=[O.Date("Y/m/d"),O.Date("Y/m/d")];break;case"yesterday":n.value.time=[O.Date("Y/m/d",O.StrToTime("-1 day")),O.Date("Y/m/d",O.StrToTime("-1 day"))];break;case"month":n.value.time=[O.Date("Y/m/d",O.StrToTime("-3 month")),O.Date("Y/m/d")];break;case"year":n.value.time=[O.Date("Y/m/d",O.StrToTime("-1 year")),O.Date("Y/m/d")];break}},ce=(m,l={})=>{p.value.show=!0,p.value.data=l,p.value.data.tp=m,m=="add"?p.value.title=S.add:m=="edit"&&(p.value.title=S.edit+"( "+l.id+" )",p.value.data.id=l.id)},ve=m=>{m&&(p.value.show=!1,j())},R=()=>{i.value.show=!0},v=m=>{m&&(i.value.show=!1,j())},o=()=>{b.value.show=!0,b.value.info="单号:[ <b>"+b.value.data.join(",")+"</b> ]&nbsp;&nbsp;&nbsp;&nbsp;数量: <b>"+b.value.num+"</b>"},F=m=>{m&&(b.value.show=!1,j())},q=(m,l,a)=>{U.value.show=!0,U.value.data=[m],U.value.info="单号: <b>"+m+"</b>&nbsp;&nbsp;品牌: <b>"+l+"</b>&nbsp;&nbsp;数量: <b>"+a+"</b>"},Z=m=>{m&&(U.value.show=!1,j())},re=()=>{H.value.show=!0},ge=m=>{m&&(H.value.show=!1,ie())},_=()=>{N.value.show=!0,N.value.title="对比采退单( "+N.value.data.join(",")+" )"},d=m=>{I.value.show=!0,I.value.title=m.type_name+" > "+m.wms_co_name+"( "+m.id+" )",I.value.data.id=m.id,I.value.data.ctime=m.ctime,I.value.data.utime=m.utime,I.value.data.wms_co_id=m.wms_co_id,I.value.data.status=m.status,I.value.data.brand=m.brand},e=m=>{m&&(I.value.show=!1,j())},C=m=>{$.value.show=!0,$.value.info={title:"[入库] "+m.wms_co_name,id:m.id,cost_price:m.cost_price,sale_price:m.sale_price,purchase_price:m.purchase_price,market_price:m.market_price,num:m.num,ctime:m.ctime,utime:m.utime,creator_name:m.creator_name,operator_name:m.operator_name,remark:m.remark},$.value.columns=[{label:"商品编码",value:"sku_id",checked:!0,textAlign:"center"},{label:"商品名称",value:"name",checked:!0,textAlign:"center"},{label:"颜色及规格",value:"properties_value",checked:!0},{label:"成本金额(元)",value:"cost_price",checked:!1,price:!0,textAlign:"right"},{label:"标签金额(元)",value:"sale_price",checked:!0,price:!0,textAlign:"right"},{label:"采购金额(W)",value:"purchase_price",checked:!1,price:!0,textAlign:"right"},{label:"吊牌金额(W)",value:"market_price",checked:!0,price:!0,textAlign:"right"},{label:"数量",value:"num",checked:!0,textAlign:"center"},{label:"折扣",value:"ratio",checked:!0,textAlign:"center"},{label:"单位",value:"unit",checked:!0,textAlign:"center"},{label:"重量",value:"weight",checked:!0,textAlign:"center"},{label:"标签",value:"labels",checked:!1,textAlign:"center"},{label:"商品分类",value:"category",checked:!1,textAlign:"center"},{label:"品牌",value:"brand",checked:!0,textAlign:"center"},{label:"采购员",value:"owner",checked:!0,textAlign:"center"},{label:"供应商",value:"supplier_name",checked:!1,textAlign:"center"},{label:"制单员",value:"operator_name",checked:!0,textAlign:"center"},{label:"创建时间",value:"ctime",checked:!0,textAlign:"center"},{label:"更新时间",value:"ctime",checked:!1,textAlign:"center"}];const l=w.Loading();K.Post("erp_purchase_in/goods_list?lang="+V.lang,{token:V.token,id:m.id,ctime:m.ctime,utime:m.utime,wms_co_id:m.wms_co_id},a=>{l.clear();const{code:P,msg:J,data:xe}=a.data;P==0?$.value.data=xe:w.Toast(J)})},B=()=>{K.Post("erp_purchase_in/get_select?lang="+V.lang,{token:V.token},m=>{const{code:l,msg:a,data:P}=m.data;l==0?(A.value.partner_name=P.partner_name,A.value.brand_name=P.brand_name,A.value.type_name=P.type_name,A.value.status_name=P.status_name,z.value=!0):w.Toast(a)})};return(m,l)=>(c(),g(Q,null,[r(je,{time:x.value.time,onRefresh:l[0]||(l[0]=a=>j())},{default:t(()=>[l[35]||(l[35]=k(" 标签金额: ",-1)),s("b",null,u(h(D)(x.value.list.sale_price)),1),l[36]||(l[36]=k(" 元   吊牌金额: ",-1)),s("b",null,u(h(D)(x.value.list.market_price)),1),l[37]||(l[37]=k(" W   数量: ",-1)),s("b",null,u(x.value.list.num),1),l[38]||(l[38]=k("   ",-1))]),_:1},8,["time"]),s("div",Gs,[s("div",qs,[r(Me,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line1"},{action:"push",slot:"push",is_action:!0},{action:"line",slot:"line2"},{action:"export",slot:"export",is_action:!0},{action:"diff",slot:"diff",is_action:!1}]},{add:t(()=>[r(M,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:l[1]||(l[1]=a=>ce("add"))},{default:t(()=>[k(u(h(S).add),1)]),_:1})]),del:t(()=>[r(M,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:i.value.data.length==0,onClick:l[2]||(l[2]=a=>R())},{default:t(()=>[k(u(h(S).del)+"("+u(i.value.data.length)+")",1)]),_:1},8,["disabled"])]),line1:t(()=>[h(T)("save")?(c(),g("span",Js,"|")):ee("",!0)]),push:t(()=>[r(M,{effect:"plain",type:"primary",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:b.value.data.length==0,onClick:l[3]||(l[3]=a=>o())},{default:t(()=>[k(u(b.value.title)+"("+u(b.value.data.length)+")",1)]),_:1},8,["disabled"])]),line2:t(()=>[h(T)("push")?(c(),g("span",Qs,"|")):ee("",!0)]),export:t(()=>[r(M,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:H.value.data.length==0,onClick:l[4]||(l[4]=a=>re())},{default:t(()=>[k(u(h(S).export)+"("+u(H.value.num)+")",1)]),_:1},8,["disabled"])]),diff:t(()=>[r(M,{effect:"plain",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:N.value.data.length==0,onClick:l[5]||(l[5]=a=>_())},{default:t(()=>[k("对比("+u(N.value.num)+")",1)]),_:1},8,["disabled"])]),_:1})]),s("div",Xs,[r(Ne,{show:n.value.show,"onUpdate:show":l[11]||(l[11]=a=>n.value.show=a),keys:n.value.key,"onUpdate:keys":l[12]||(l[12]=a=>n.value.key=a),columns:n.value.columns,placeholder:n.value.placeholder,onKeyup:l[13]||(l[13]=we(a=>{f.value.num=1,j()},["enter"])),onSearch:l[14]||(l[14]=a=>{f.value.num=1,j()}),onReset:l[15]||(l[15]=a=>pe())},{customTime:t(a=>[s("ul",Zs,[(c(!0),g(Q,null,Re(n.value.customTime.list,P=>(c(),g("li",{key:P.value,onClick:J=>fe(P.value),class:Ae({active:n.value.customTime.active===P.value})},u(P.label),11,el))),128))])]),time:t(a=>[r(He,{value:n.value.time,"onUpdate:value":l[6]||(l[6]=P=>n.value.time=P),range:"",maxDate:n.value.maxDate,placeholder:a.label},null,8,["value","maxDate","placeholder"])]),wms_co_id:t(a=>[r(me,{value:n.value.wms_co_id,"onUpdate:value":l[7]||(l[7]=P=>n.value.wms_co_id=P),options:A.value.partner_name,placeholder:a.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),type:t(a=>[r(me,{value:n.value.type,"onUpdate:value":l[8]||(l[8]=P=>n.value.type=P),options:A.value.type_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),status:t(a=>[r(me,{value:n.value.status,"onUpdate:value":l[9]||(l[9]=P=>n.value.status=P),options:A.value.status_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),brand:t(a=>[r(me,{value:n.value.brand,"onUpdate:value":l[10]||(l[10]=P=>n.value.brand=P),options:A.value.brand_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["show","keys","columns","placeholder"])])]),s("div",tl,[r(ke,{ref_key:"tableList",ref:y,overflow:"auto",columns:W.value.columns,options:W.value.data,onOrderBy:te,onPartially:X},{id:t(a=>[s("div",sl,u(a.id),1)]),date:t(a=>[s("div",ll,[r(Te,{title:"创建: "+a.ctime+`
更新: `+a.utime+`
制单: `+a.creator_name+", 审核: "+a.operator_name+`
备注: `+a.remark},{default:t(()=>[k(u(a.ctime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(a=>[s("div",al,u(a.type_name),1)]),brand:t(a=>[s("div",ol,u(a.brand),1)]),sale_price:t(a=>[s("div",il,u(a.sale_price>0?h(D)(a.sale_price):"-"),1)]),market_price:t(a=>[s("div",nl,u(a.market_price>0?h(D)(a.market_price):"-"),1)]),num:t(a=>[s("div",ul,u(a.num),1)]),total:t(a=>[s("div",dl,u(a.total),1)]),status:t(a=>[a.status=="0"?(c(),g("div",rl,u(a.status_name),1)):a.status=="1"?(c(),g("div",pl,u(a.status_name),1)):a.status=="2"?(c(),g("div",ml,u(a.status_name),1)):(c(),g("div",cl,u(a.status_name),1))]),action:t(a=>[s("div",vl,[h(T)("save")&&a.state=="0"?(c(),se(M,{key:0,onClick:P=>ce("edit",a)},{default:t(()=>[k(u(h(S).edit),1)]),_:1},8,["onClick"])):h(T)("save")&&a.state=="1"?(c(),se(M,{key:1,type:"danger",effect:"text",onClick:P=>q(a.id,a.brand,a.num)},{default:t(()=>[...l[39]||(l[39]=[k("撤回",-1)])]),_:1},8,["onClick"])):(c(),g("span",_l,[...l[40]||(l[40]=[s("i",{class:"ui ui_safety"},null,-1)])]))])]),goods:t(a=>[s("div",fl,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:P=>d(a)},{default:t(()=>[...l[41]||(l[41]=[k("商品",-1)])]),_:1},8,["onClick"])])]),print:t(a=>[s("div",gl,[r(M,{type:"primary",effect:"text",padding:"0 4px",onClick:P=>C(a),disabled:a.num==0},{default:t(()=>[k(u(h(S).print),1)]),_:1},8,["onClick","disabled"])])]),_:1},8,["columns","options"])]),s("div",xl,[r(Fe,{total:f.value.total,"onUpdate:total":l[16]||(l[16]=a=>f.value.total=a),page:f.value.num,"onUpdate:page":[l[17]||(l[17]=a=>f.value.num=a),l[18]||(l[18]=a=>j())],limit:f.value.limit,"onUpdate:limit":[l[19]||(l[19]=a=>f.value.limit=a),l[20]||(l[20]=a=>{f.value.num=1,j()})]},null,8,["total","page","limit"])]),r(Ee,{show:p.value.show,"onUpdate:show":l[21]||(l[21]=a=>p.value.show=a),title:p.value.title,data:p.value.data,onSubmit:l[22]||(l[22]=a=>ve(a))},null,8,["show","title","data"]),r(Ke,{show:i.value.show,"onUpdate:show":l[23]||(l[23]=a=>i.value.show=a),data:i.value.data,onSubmit:l[24]||(l[24]=a=>v(a))},null,8,["show","data"]),r(Ge,{show:b.value.show,"onUpdate:show":l[25]||(l[25]=a=>b.value.show=a),title:b.value.title,info:b.value.info,data:b.value.data,onSubmit:l[26]||(l[26]=a=>F(a))},null,8,["show","title","info","data"]),r(Je,{show:U.value.show,"onUpdate:show":l[27]||(l[27]=a=>U.value.show=a),title:U.value.title,info:U.value.info,data:U.value.data,onSubmit:l[28]||(l[28]=a=>Z(a))},null,8,["show","title","info","data"]),r(Xe,{show:H.value.show,"onUpdate:show":l[29]||(l[29]=a=>H.value.show=a),data:H.value.data,num:H.value.num,onSubmit:l[30]||(l[30]=a=>ge(a))},null,8,["show","data","num"]),r(zs,{show:N.value.show,"onUpdate:show":l[31]||(l[31]=a=>N.value.show=a),title:N.value.title,data:N.value.data,num:N.value.num},null,8,["show","title","data","num"]),r(Zt,{show:I.value.show,"onUpdate:show":l[32]||(l[32]=a=>I.value.show=a),title:I.value.title,data:I.value.data,onSubmit:l[33]||(l[33]=a=>e(a))},null,8,["show","title","data"]),r(Ve,{show:$.value.show,"onUpdate:show":l[34]||(l[34]=a=>$.value.show=a),title:$.value.title,info:$.value.info,columns:$.value.columns,data:$.value.data},null,8,["show","title","info","columns","data"])],64))}}),Tl=$e(hl,[["__scopeId","data-v-e0583850"]]);export{Tl as default};
