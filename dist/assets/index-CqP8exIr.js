import{d as H,u as M,r as _,w as V,c as F,a as n,b as w,e as z,f as v,i as p,k as E,l as D,t as f,m as L,U as C,R as A,o as Y,F as X,T as i,y as Z,z as ee,n as U,D as te,s as N,E as ae,B as oe,G as le,v as se,x as ne}from"./index-CnF5AvoE.js";import{U as R}from"./utils-DiaYGV9e.js";import{w as ie,a as ue,b as de,c as re,P as me}from"./Search-CvnSry-k.js";import{w as ve}from"./index-Cz1UrKEg.js";import{w as pe}from"./Total-D1VoWU1A.js";const ce=["innerHTML"],fe=H({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(h,{emit:S}){const g=h,$=S,r=M().state,y=r.langs,a=_(!1);V(()=>g.show,o=>{a.value=o},{deep:!0});const k=()=>{const o=C.Loading();A.Post("erp_goods_log/del?lang="+r.lang,{token:r.token,data:g.data},l=>{o.clear();const{code:u,msg:c}=l.data;C.Toast(c),$("submit",u==0)})},d=()=>{$("update:show",!1)};return(o,l)=>(Y(),F(z,{show:a.value,"onUpdate:show":l[1]||(l[1]=u=>a.value=u),title:h.title||w(y).del,width:"360px",bottom:"40px",onClose:l[2]||(l[2]=u=>d())},{bottom:n(()=>[v(L,{effect:"dark",type:"danger",height:"40px",onClick:l[0]||(l[0]=u=>k())},{default:n(()=>[D(f(w(y).confirm),1)]),_:1})]),default:n(()=>[v(E,{lineHeight:"60px"},{default:n(()=>[p("span",{innerHTML:w(y).del_warn(h.data.length)},null,8,ce)]),_:1})]),_:1},8,["show","title"]))}}),we=["innerHTML"],ge=H({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(h,{emit:S}){const g=h,$=S,r=M().state,y=r.langs,a=_(!1);V(()=>g.show,o=>{a.value=o},{deep:!0});const k=()=>{const o=C.Loading();A.Post("erp_goods_log/export?lang="+r.lang,{token:r.token,data:g.data,order:g.order},l=>{o.clear();const{code:u,msg:c,data:b}=l.data;C.Toast(c),u==0&&X.Down(b.path+b.filename,b.filename),$("submit",u==0)})},d=()=>{$("update:show",!1)};return(o,l)=>(Y(),F(z,{show:a.value,"onUpdate:show":l[1]||(l[1]=u=>a.value=u),title:h.title||w(y).export,width:"360px",bottom:"40px",onClose:l[2]||(l[2]=u=>d())},{bottom:n(()=>[v(L,{height:"40px",padding:"0 32px",onClick:l[0]||(l[0]=u=>k())},{default:n(()=>[D(f(w(y).confirm),1)]),_:1})]),default:n(()=>[v(E,{lineHeight:"60px"},{default:n(()=>[p("span",{innerHTML:w(y).export_warn(h.num)},null,8,we)]),_:1})]),_:1},8,["show","title"]))}}),xe=["innerHTML"],ke={class:"app_action flex"},_e={class:"app_action_tools scrollbar"},ye={key:0,class:"line"},he={class:"app_action_search flex"},be={class:"custom_time flex_center"},Te=["onClick"],De={class:"app_ct"},Ce={class:"tCenter"},Se={class:"tCenter"},$e={class:"copy"},Ye=["onClick"],Le={class:"tCenter"},Ue={class:"app_page"},Ne=H({__name:"index",setup(h){const S=_(!1),g=_(),x=M().state,r=x.langs,y=me.isAction,a=_({show:!1,key:"",placeholder:"商品编码、内容",time:[i.Date("Y/m/d",i.StrToTime("-7 day")),i.Date("Y/m/d")],maxDate:i.Date("Y/m/d"),customTime:{active:"",list:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"3个月",value:"month"},{label:"近1年",value:"year"}]},columns:[{label:"",value:"",slot:"customTime"},{label:r.select,value:"",slot:"time"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label:"操作员",value:"",name:"operator"},{label:"内容",value:"",name:"content"}]}),k=_({time:"",list:{num:0}}),d=_({columns:[{title:"ID",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:r.date,slot:"date",width:"150px",textAlign:"center"},{title:r.goods_sku_id,slot:"sku_id",index:"sku_id",order:"",width:"150px",textAlign:"center"},{title:r.view,slot:"view",textAlign:"center",width:"40px"},{title:"操作员",slot:"operator",width:"100px",textAlign:"center"},{title:"内容",index:"content"}],data:[],num:0,total:0,order:""}),o=_({total:0,num:1,limit:100}),l=_({show:!1,title:"删除",data:[]}),u=_({show:!1,title:"导出",num:0});Z(()=>{S.value=!0}),ee(()=>{S&&x.isLogin&&c()});const c=()=>{a.value.show=!1,d.value.data=[];const s=C.Loading();A.Post("erp_goods_log/list?lang="+x.lang,{token:x.token,data:b(),page:o.value.num,limit:o.value.limit,order:d.value.order},e=>{s.clear();const{code:t,msg:m,data:T,time:B}=e.data;t==0?(k.value.time=B,d.value.data=T,P()):C.Toast(m)}),o.value.total=0,k.value.list.num=0,A.Post("erp_goods_log/total?lang="+x.lang,{token:x.token,data:b()},e=>{const{code:t,msg:m,data:T,time:B}=e.data;t==0?(k.value.time=B,o.value.total=T.total,k.value.list.num=T.total):C.Toast(m)})},b=()=>{const s={key:a.value.key,stime:typeof a.value.time[0]=="string"?a.value.time[0]:i.Date("Y/m/d",a.value.time[0]),etime:typeof a.value.time[1]=="string"?a.value.time[1]:i.Date("Y/m/d",a.value.time[1])};for(let e of a.value.columns)e.name&&(s[e.name]=e.value);return s},K=(s,e)=>{d.value.num=s,d.value.total=e},O=s=>{d.value.order=s,c()},j=()=>{a.value.time=[i.Date("Y/m/d",i.StrToTime("-1 month")),i.Date("Y/m/d")],a.value.customTime.active="",a.value.key="";for(let s of a.value.columns)s.value="";d.value.order="",o.value.num=1,c()},P=()=>{ae(()=>{d.value.num=0,g.value.checkboxAll(!1)})},q=s=>{switch(a.value.customTime.active=s,s){case"today":a.value.time=[i.Date("Y/m/d"),i.Date("Y/m/d")];break;case"yesterday":a.value.time=[i.Date("Y/m/d",i.StrToTime("-1 day")),i.Date("Y/m/d",i.StrToTime("-1 day"))];break;case"month":a.value.time=[i.Date("Y/m/d",i.StrToTime("-3 month")),i.Date("Y/m/d")];break;case"year":a.value.time=[i.Date("Y/m/d",i.StrToTime("-1 year")),i.Date("Y/m/d")];break}},G=()=>{l.value.show=!0;const s=g.value.getData();let e=[];for(let t of s)e.push(t.id);l.value.data=e},I=s=>{s&&(l.value.show=!1,c())},W=s=>{u.value.show=!0,u.value.num=s},J=s=>{s&&(u.value.show=!1,P())},Q=(s,e)=>{const t=g.value.getData();let m="";for(let T in t)m+=t[T][s]+" ";m?R.CopyText(m):R.CopyText(e)};return(s,e)=>(Y(),U(N,null,[v(pe,{time:k.value.time,onRefresh:e[0]||(e[0]=t=>c())},{default:n(()=>[p("span",{innerHTML:w(r).total_info(k.value.list.num)},null,8,xe)]),_:1},8,["time"]),p("div",ke,[p("div",_e,[v(ie,{columns:[{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0}]},{del:n(()=>[v(L,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:d.value.num==0,onClick:e[1]||(e[1]=t=>G())},{default:n(()=>[D(f(w(r).del)+"("+f(d.value.num)+")",1)]),_:1},8,["disabled"])]),line:n(()=>[w(y)("del")?(Y(),U("span",ye,"|")):oe("",!0)]),export:n(()=>[v(L,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!o.value.total,onClick:e[2]||(e[2]=t=>W(o.value.total))},{default:n(()=>[D(f(w(r).export)+"("+f(o.value.total)+")",1)]),_:1},8,["disabled"])]),_:1})]),p("div",he,[v(ue,{show:a.value.show,"onUpdate:show":e[4]||(e[4]=t=>a.value.show=t),keys:a.value.key,"onUpdate:keys":e[5]||(e[5]=t=>a.value.key=t),columns:a.value.columns,placeholder:a.value.placeholder,onKeyup:e[6]||(e[6]=te(t=>{o.value.num=1,c()},["enter"])),onSearch:e[7]||(e[7]=t=>{o.value.num=1,c()}),onReset:e[8]||(e[8]=t=>j())},{customTime:n(t=>[p("ul",be,[(Y(!0),U(N,null,se(a.value.customTime.list,m=>(Y(),U("li",{key:m.value,onClick:T=>q(m.value),class:ne({active:a.value.customTime.active===m.value})},f(m.label),11,Te))),128))])]),time:n(t=>[v(le,{value:a.value.time,"onUpdate:value":e[3]||(e[3]=m=>a.value.time=m),range:"",maxDate:a.value.maxDate,placeholder:t.label},null,8,["value","maxDate","placeholder"])]),_:1},8,["show","keys","columns","placeholder"])])]),p("div",De,[v(de,{ref_key:"tableList",ref:g,overflow:"auto",columns:d.value.columns,options:d.value.data,onOrderBy:O,onPartially:K},{id:n(t=>[p("div",Ce,f(t.id),1)]),date:n(t=>[p("div",Se,[v(ve,{title:"时间: "+t.ctime},{default:n(()=>[D(f(t.ctime),1)]),_:2},1032,["title"])])]),sku_id:n(t=>[p("div",$e,[D(f(t.sku_id),1),p("span",{onClick:m=>Q("sku_id",t.sku_id)},"复",8,Ye)])]),view:n(t=>[p("div",Le,[v(L,{type:"primary",effect:"text",padding:"0 4px",onClick:m=>{w(x).goods.show=!0,w(x).goods.sku_id=t.sku_id}},{default:n(()=>[D(f(w(r).goods_flow),1)]),_:2},1032,["onClick"])])]),operator:n(t=>[p("div",null,f(t.operator_name)+"("+f(t.operator_id)+")",1)]),_:1},8,["columns","options"])]),p("div",Ue,[v(re,{total:o.value.total,"onUpdate:total":e[9]||(e[9]=t=>o.value.total=t),page:o.value.num,"onUpdate:page":[e[10]||(e[10]=t=>o.value.num=t),e[11]||(e[11]=t=>c())],limit:o.value.limit,"onUpdate:limit":[e[12]||(e[12]=t=>o.value.limit=t),e[13]||(e[13]=t=>{o.value.num=1,c()})]},null,8,["total","page","limit"])]),v(fe,{show:l.value.show,"onUpdate:show":e[14]||(e[14]=t=>l.value.show=t),data:l.value.data,onSubmit:e[15]||(e[15]=t=>I(t))},null,8,["show","data"]),v(ge,{show:u.value.show,"onUpdate:show":e[16]||(e[16]=t=>u.value.show=t),data:b(),order:d.value.order,num:u.value.num,onSubmit:e[17]||(e[17]=t=>J(t))},null,8,["show","data","order","num"])],64))}});export{Ne as default};
