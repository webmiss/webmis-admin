import{d as ae,u as oe,r as L,w as de,c as Z,a as t,e as ee,f as p,h as We,i as l,j as ce,k as te,l as g,t as i,b as k,m as H,U as y,R as E,o as v,G as xe,F as ye,n as f,s as G,E as he,D as ke,M as le,N as Pe,O as Ie,A as Ae,B as se,L as $e,x as Te,v as be,K as Be,_ as Ce,I as Se,T as V,y as Ye,z as He,H as Re}from"./index--Aaw8Kh1.js";import{c as pe,P as Ue,w as Me,a as Ne,b as Fe}from"./Search-DMryvUDg.js";import{w as je}from"./Total-C1JsSOot.js";import{P as Ve}from"./PrintGoods-H0ebf_0s.js";import{w as De}from"./index-9lX5YKhj.js";import{w as Le}from"./index-CONZkG9F.js";import"./index-QqPnWr-n.js";const Ee=ae({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1),u=L({tp:"",id:"",type:"",wms_co_id:"",brand:"",remark:""}),h=L({type_name:[],partner_name:[],brand_name:[]});de(()=>$.show,A=>{U.value=A,A&&(u.value.tp=$.data.tp||"",u.value.id=$.data.id||"",u.value.remark=$.data.remark||"",W())},{deep:!0});const W=()=>{E.Post("erp_purchase_out/get_select?lang="+S.lang,{token:S.token},A=>{const{code:b,msg:B,data:R}=A.data;b==0?(h.value.type_name=R.type_name,h.value.partner_name=R.partner_name,h.value.brand_name=R.brand_name,$.data.tp=="edit"&&xe(()=>{u.value.type=[parseInt($.data.type)],u.value.wms_co_id=[parseInt($.data.wms_co_id)],u.value.brand=[$.data.brand]})):y.Toast(B)})},_=A=>!A.wms_co_id||A.wms_co_id.length==0?y.Toast("请选择退货仓库"):!A.type||A.type.length==0?y.Toast("请选择退货类型"):!A.brand||A.brand.length==0?y.Toast("请选择品牌"):A,m=()=>{const A=_(u.value);if(!A)return;const b=y.Loading();E.Post("erp_purchase_out/save?lang="+S.lang,{token:S.token,data:A},B=>{b.clear();const{code:R,msg:P}=B.data;y.Toast(P),F("submit",R==0)})},d=()=>{F("update:show",!1)};return(A,b)=>(v(),Z(ee,{show:U.value,"onUpdate:show":b[5]||(b[5]=B=>U.value=B),title:I.title,width:"620px",bottom:"40px",onClose:b[6]||(b[6]=B=>d())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:b[4]||(b[4]=B=>m())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(te,null,{default:t(()=>[p(We,null,{default:t(()=>[l("tr",null,[b[7]||(b[7]=l("td",{class:"label"},[l("span",{class:"red_dot"},"退货仓库")],-1)),l("td",null,[p(pe,{value:u.value.wms_co_id,"onUpdate:value":b[0]||(b[0]=B=>u.value.wms_co_id=B),options:h.value.partner_name,disabled:u.value.tp=="edit"},null,8,["value","options","disabled"])])]),l("tr",null,[b[8]||(b[8]=l("td",{class:"label"},[l("span",{class:"red_dot"},"退货类型")],-1)),l("td",null,[p(pe,{value:u.value.type,"onUpdate:value":b[1]||(b[1]=B=>u.value.type=B),options:h.value.type_name},null,8,["value","options"])])]),l("tr",null,[b[9]||(b[9]=l("td",{class:"label"},[l("span",{class:"red_dot"},"品牌")],-1)),l("td",null,[p(pe,{value:u.value.brand,"onUpdate:value":b[2]||(b[2]=B=>u.value.brand=B),options:h.value.brand_name},null,8,["value","options"])])]),l("tr",null,[b[10]||(b[10]=l("td",{class:"label"},"备注",-1)),l("td",null,[p(ce,{value:u.value.remark,"onUpdate:value":b[3]||(b[3]=B=>u.value.remark=B),type:"textarea",height:"160px"},null,8,["value"])])])]),_:1})]),_:1})]),_:1},8,["show","title"]))}}),Oe=["innerHTML"],Ke=ae({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);de(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/del?lang="+S.lang,{token:S.token,data:$.data},_=>{W.clear();const{code:m,msg:d}=_.data;y.Toast(d),F("submit",m==0)})},h=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title||k(D).del,width:"360px",bottom:"40px",onClose:_[2]||(_[2]=m=>h())},{bottom:t(()=>[p(H,{effect:"dark",type:"danger",height:"40px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[l("span",{innerHTML:k(D).del_warn(I.data.length)},null,8,Oe)]),_:1})]),_:1},8,["show","title"]))}}),ze=["innerHTML"],Ge=ae({__name:"push",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);de(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/push?lang="+S.lang,{token:S.token,data:$.data},_=>{W.clear();const{code:m,msg:d}=_.data;y.Toast(d),F("submit",m==0)})},h=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title,width:"480px",bottom:"40px",onClose:_[2]||(_[2]=m=>h())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(De,null,{default:t(()=>_[3]||(_[3]=[g("提醒: 确认货品已还采购员")])),_:1}),p(te,{lineHeight:"60px"},{default:t(()=>[l("div",{class:"tCenter",innerHTML:I.info,style:{"word-wrap":"break-word"}},null,8,ze)]),_:1})]),_:1},8,["show","title"]))}}),qe=["innerHTML"],Je=ae({__name:"revoke",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);de(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/revoke?lang="+S.lang,{token:S.token,data:$.data},_=>{W.clear();const{code:m,msg:d}=_.data;y.Toast(d),F("submit",m==0)})},h=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title,width:"480px",bottom:"40px",onClose:_[2]||(_[2]=m=>h())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(De,null,{default:t(()=>_[3]||(_[3]=[g("提醒: 将撤回以下单据")])),_:1}),p(te,{lineHeight:"60px",class:"tCenter"},{default:t(()=>[l("div",{class:"tCenter",innerHTML:I.info,style:{"word-wrap":"break-word"}},null,8,qe)]),_:1})]),_:1},8,["show","title"]))}}),Qe=["innerHTML"],Xe=ae({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);de(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/export?lang="+S.lang,{token:S.token,data:$.data,order:$.order},_=>{W.clear();const{code:m,msg:d,data:A}=_.data;y.Toast(d),m==0&&ye.Down(A.path+A.filename,A.filename),F("submit",m==0)})},h=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title||k(D).export,width:"360px",bottom:"40px",onClose:_[2]||(_[2]=m=>h())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[l("span",{innerHTML:k(D).export_warn(I.num)},null,8,Qe)]),_:1})]),_:1},8,["show","title"]))}}),Ze={class:"goods_info flex"},et={class:"goods_info_tools flex"},tt={class:"goods_info_total"},st={class:"tCenter"},lt={class:"tCenter"},at={class:"flex_center"},ot={class:"flex_center"},nt={class:"flex_center"},it={key:0,class:"c_success"},ut={key:1,class:"c_info"},dt={key:2,class:"c_info"},rt=ae({__name:"import",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1),u=L({key:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"40px",textAlign:"center"},{title:"商品编码",index:"sku_id"},{title:"数量",slot:"num",textAlign:"center",width:"80px",minWidth:"80px"},{title:"操作",slot:"action",textAlign:"center",width:"80px",minWidth:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"status",textAlign:"center",width:"80px"}],list:[],num:0});L({show:!1,title:"新增商品",cost_price:"0.00",supply_price:"0.00",sale_price:"0.00",purchase_price:"0.00",supplier_price:"0.00",market_price:"0.00",weight:"0.00",unit:"个",sku_id:"",labels:"",name:"",category:"",properties_value:"",brand:"",short_name:"",i_id:"",owner:"",supplier_name:""});const h=L({show:!1,type:"",title:"移除",info:"",index:0});de(()=>$.show,P=>{U.value=P},{deep:!0});const W=()=>{const P=u.value.key.trim().toUpperCase();if(P.length==0)return;const C=P.split(" ");for(let T of C){if(T=le.LTrim(T,"0"),m(T)){y.Toast("[ "+T+" ]已存在!");continue}u.value.list.unshift({sku_id:T,num:1})}u.value.key="",d()},_=()=>{ye.Select({mimeType:[]},P=>{ye.FileToBase64(P,C=>{const T=Pe(C,{type:"binary"}),j=T.SheetNames[0],q=Ie.sheet_to_json(T.Sheets[j],{raw:!1});if(q.length>3e3)return y.Toast("不能超过3000条");let K="";for(let Q of q){if(!Q.商品编码||!Q.数量){y.Toast("必须存在“商品编码”、“数量”");continue}if(K=le.LTrim(le.Trim(Q.商品编码).toUpperCase(),"0"),m(K)){y.Toast("[ "+K+" ]已存在!");continue}u.value.list.push({sku_id:K,num:Q.数量})}d()},"blob")})},m=P=>{for(let C of u.value.list)if(P==C.sku_id)return!0;return!1},d=()=>{const P=u.value.list;u.value.num=0;for(let C of P)u.value.num+=parseInt(C.num)},A=(P,C=0)=>{if(u.value.list.length==0)return y.Toast("无商品资料!");h.value.show=!0,h.value.type=P,P=="all"?(h.value.title="清空",h.value.info="移除全部资料"):(P="one")&&(h.value.title="移除",h.value.info=u.value.list[C].sku_id,h.value.index=C)},b=()=>{h.value.show=!1,h.value.type=="all"?u.value.list=[]:h.value.type=="one"&&u.value.list.splice(h.value.index,1),d()},B=()=>{if(u.value.list.length<1)return y.Toast("暂无导入数据!");const P=y.Loading();E.Post("erp_purchase_out/goods_safety?lang="+S.lang,{token:S.token,wms_co_id:$.data.wms_co_id,data:u.value.list},C=>{P.clear();const{code:T,msg:j,data:q}=C.data;T===0?(F("submit",u.value.list),u.value.num=0,u.value.list=[],R()):T===5e3?(y.Toast(j),u.value.list=q||[]):y.Toast(j)})},R=()=>{F("update:show",!1)};return(P,C)=>(v(),f(G,null,[p(ee,{show:U.value,"onUpdate:show":C[5]||(C[5]=T=>U.value=T),title:I.title,width:"720px",top:"56px",bottom:"40px",overflow:"hidden auto",onClose:C[6]||(C[6]=T=>R())},{top:t(()=>[l("div",Ze,[l("ul",et,[l("li",null,[p(ce,{value:u.value.key,"onUpdate:value":C[0]||(C[0]=T=>u.value.key=T),onKeyup:C[1]||(C[1]=ke(T=>W(),["enter"])),onTextClick:C[2]||(C[2]=T=>_()),text:"选择文件",textColor:"#0064C8",placeholder:"商品编码，多条空格分隔",width:"320px",padding:"0 40px 0 10px"},null,8,["value"])]),l("li",null,[p(H,{type:"danger",effect:"text",padding:"0 4px",onClick:C[3]||(C[3]=T=>A("all"))},{default:t(()=>C[9]||(C[9]=[g("清空")])),_:1})])]),l("div",tt,[C[10]||(C[10]=g(" 数量: ")),l("b",null,i(u.value.num),1)])])]),bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:C[4]||(C[4]=T=>B())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref:"tableList",columns:u.value.columns,options:u.value.list,isCheckbox:!1},{index:t(T=>[l("div",st,i(T.index+1),1)]),num:t(T=>[l("div",lt,i(T.num),1)]),action:t(T=>[l("div",at,[p(H,{type:"danger",effect:"text",padding:"0 4px",onClick:j=>A("one",T.index)},{default:t(()=>[g(i(k(D).remove),1)]),_:2},1032,["onClick"])])]),view:t(T=>[l("div",ot,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:j=>{k(S).goods.show=!0,k(S).goods.sku_id=T.sku_id}},{default:t(()=>[g(i(k(D).goods_flow),1)]),_:2},1032,["onClick"])])]),status:t(T=>[l("div",nt,[T.status===!0?(v(),f("span",it,"可用")):T.status===!1?(v(),f("span",ut,i(T.status_name),1)):(v(),f("span",dt,"-"))])]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),p(ee,{show:h.value.show,"onUpdate:show":C[8]||(C[8]=T=>h.value.show=T),title:h.value.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[p(H,{effect:"dark",type:"danger",height:"40px",onClick:C[7]||(C[7]=T=>b())},{default:t(()=>[g(i(k(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[g(i(h.value.info),1)]),_:1})]),_:1},8,["show","title"])],64))}}),pt={class:"goods_info flex"},mt={class:"goods_info_tools flex"},vt={key:0},ct={key:1},_t={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 630px)"}},ft={class:"tCenter"},gt={class:"flex_center"},xt=["onClick"],ht=["onClick"],kt={class:"tCenter"},wt={class:"tCenter"},yt={class:"tRight"},bt={key:0},$t={key:1},Ct={key:1},At={class:"tRight"},Tt={key:0},St={key:1},Ut={key:1},Dt={class:"tRight"},Lt={key:0},Wt={key:1},Pt={key:1},It={class:"tCenter"},Bt={class:"tCenter"},Yt={class:"tCenter"},Ht={key:1},Rt={class:"tCenter"},Mt={class:"tCenter"},Nt={class:"tCenter"},Ft={key:0,class:"flex_center status2"},jt={key:1,class:"tCenter"},Vt={class:"tCenter"},Et={class:"tCenter"},Ot={class:"flex_center"},Kt={key:0,class:"c_danger"},zt={key:1,class:"c_success"},Gt=["title"],qt={class:"tCenter color1"},Jt=ae({__name:"goods",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,N=L(),D=oe().state,U=D.langs,u=$e.priceEncode,h=Ue.isAction,W=L(!1);let _=null,m=[];const d=L({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:U.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",order:"",width:"150px",minWidth:"150px"},{title:"暗码",slot:"short_name",index:"short_name",order:"",textAlign:"center",width:"80px"},{title:"款式编码",slot:"i_id",index:"i_id",order:"",textAlign:"center",width:"80px"},{title:"商品名称",index:"name",order:"",width:"80px"},{title:"颜色及规格",index:"properties_value",order:""},{title:"供应链价(元)",slot:"supply_price",index:"supply_price",order:"",textAlign:"center",width:"100px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px",minWidth:"60px"},{title:"重量",slot:"weight",index:"weight",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"折扣",slot:"ratio",index:"ratio",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"标签",slot:"labels",index:"labels",order:"",textAlign:"center",width:"80px"},{title:"分类",slot:"category",index:"category",order:"",textAlign:"center",width:"80px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"采购员",slot:"owner",index:"owner",order:"",textAlign:"center",width:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作",slot:"action",textAlign:"center",width:"60px",minWidth:"60px"},{title:"时间",slot:"utime",index:"utime",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作员",slot:"operator_name",index:"operator_name",order:"",textAlign:"center",width:"60px",minWidth:"60px"}],list:[],cost_price:0,sale_price:0,purchase_price:0,market_price:0,num:0,print:0,total:0,is_sku:{label:"校对商品",value:"is_sku",checked:!0},remove:{show:!1,type:"",title:"",info:"",data:[]},refresh:!1}),A=L({show:!1,title:"导入"}),b=L({show:!1,title:"拆分",info:{}}),B=L(!1),R=L(0),P=L([]);de(()=>$.show,x=>{W.value=x,x&&(d.value.key="",d.value.refresh=!1,q())},{deep:!0});const C=(x,r)=>{d.value.print=x,d.value.total=r},T=x=>{d.value.order=x,q()},j=()=>{const x=le.LTrim(d.value.key.trim().toUpperCase(),"0");if(d.value.key="",$.data.status==0){if(x.length==0)return;Q([{sku_id:x,num:1}])}else q(x)},q=(x="")=>{d.value.list=[],K(!1);const r=y.Loading();E.Post("erp_purchase_out/goods_list?lang="+D.lang,{token:D.token,id:$.data.id,order:d.value.order,sku_id:x},e=>{r.clear();const{code:n,msg:s,data:a}=e.data;n==0?(d.value.list=a,ue(),K(!1)):y.Toast(s)})},K=x=>{const r=d.value.list;d.value.cost_price=0,d.value.sale_price=0,d.value.purchase_price=0,d.value.market_price=0,d.value.num=0;const e=r.length-1,n=e>=0?r[e].sku_id:"";let s=0,a=0;b.value.info={};for(let w of r)w.ratio&&(s=parseInt(w.num),a=parseFloat(w.ratio),d.value.cost_price+=parseFloat(w.cost_price)*s*a,d.value.sale_price+=parseFloat(w.sale_price)*s*a,d.value.purchase_price+=parseFloat(w.purchase_price)*s*a,d.value.market_price+=parseFloat(w.market_price)*s*a,d.value.num+=s,w.is_date=w.labels!="缅甸"&&n.substring(0,7)!=w.sku_id.substring(0,7),b.value.info[w.brand]=b.value.info[w.brand]?b.value.info[w.brand]+1:s);x&&(d.value.refresh=!0)},Q=(x,r="")=>{for(let e of x){const n=_e(e.sku_id);if(d.value.is_sku.checked&&n)return y.Toast("[ "+e.sku_id+" ]已存在",5e3,"danger");if(n)for(let s of d.value.list)s.sku_id==e.sku_id&&(s.num+=parseInt(e.num),e.num=s.num,y.Toast("[ "+e.sku_id+" ]数量 "+s.num+" "));else d.value.list.unshift({id:"s"+e.sku_id,sku_id:e.sku_id,num:e.num,loading:0})}r==="import"?ne(x):(m.push(x[0]),clearTimeout(_),_=setTimeout(()=>{ne(m),m=[]},1e3))},_e=x=>{let r=!1;for(let e of d.value.list)e.sku_id==x&&(r=!0);return r},ne=x=>{E.Post("erp_purchase_out/goods_add?lang="+D.lang,{token:D.token,id:$.data.id,ctime:$.data.ctime,wms_co_id:$.data.wms_co_id,data:x},r=>{const{code:e,msg:n,data:s}=r.data;e==0?(re(s),K(!0)):(y.Toast(n,5e3,"danger"),re(s))},()=>{re(x,!0)})},re=(x,r=!1)=>{if(x.length==0)return;const e=d.value.list;for(let n in x){x[n].brand!=$.data.brand&&y.Toast("[ "+x[n].sku_id+" ]品牌为“"+x[n].brand+"”不等于“"+$.data.brand+"”",5e3,"danger");for(let s in e)if(e[s].sku_id==x[n].sku_id){r?e[s].loading=1:e[s]=x[n];continue}}},me=(x,r,e)=>{const n=parseInt(x);if(n.toString()=="NaN")return y.Toast("请输入数字");for(let s of d.value.list)s.sku_id==e&&(s.num=n);E.Post("erp_purchase_out/goods_num?lang="+D.lang,{token:D.token,id:r,num:n,sku_id:e,pid:$.data.id,ctime:$.data.ctime,wms_co_id:$.data.wms_co_id},s=>{const{code:a,msg:w}=s.data;a==0?(y.Toast(w),K(!0)):y.Toast(w,5e3,"danger")})},ve=(x,r={})=>{if(d.value.remove.type=x,d.value.remove.data=[],x=="one")d.value.remove.show=!0,d.value.remove.title='移除" '+r.sku_id+' "',d.value.remove.info="是否移除单条数据?",d.value.remove.data=[{index:r.index,id:r.id,sku_id:r.sku_id,num:r.num}];else if(x=="part"){const e=N.value.getData();if(e.length==0)return y.Toast("请选择数据");d.value.remove.show=!0,d.value.remove.title="移除选中",d.value.remove.info="是否移除选中数据?";for(let n of e)d.value.remove.data.unshift({index:n.index,id:n.id,sku_id:n.sku_id,num:n.num})}},Y=()=>{d.value.remove.show=!1;const x=d.value.remove.data,r=d.value.list;let e=[];for(let s of x){if(s.id.toString().substring(0,1)=="s"){r.splice(s.index,1),K(!0);continue}e.push({index:s.index,id:s.id,sku_id:s.sku_id,num:s.num})}if(e.length==0)return;const n=y.Loading();E.Post("erp_purchase_out/goods_remove?lang="+D.lang,{token:D.token,id:$.data.id,ctime:$.data.ctime,wms_co_id:$.data.wms_co_id,data:e},s=>{n.clear();const{code:a,msg:w}=s.data;if(a==0){if(d.value.remove.type=="all")d.value.list=[];else for(let J of e)r.splice(J.index,1);K(!0)}else y.Toast(w,5e3,"danger")})},c=()=>{A.value.show=!0,A.value.title="导入"},o=x=>{x.length<1||Q(x,"import")},M=()=>{b.value.show=!0,b.value.title="按品牌拆分"},z=()=>{b.value.show=!1;const x=y.Loading();E.Post("erp_purchase_out/explode?lang="+D.lang,{token:D.token,id:$.data.id},r=>{x.clear();const{code:e,msg:n}=r.data;y.Toast(n),e==0&&(d.value.refresh=!0,we())})},X=x=>{let r=[],e=0;for(let n of d.value.list)n.img&&(n.img==x&&(R.value=e),r.push({label:n.sku_id,value:n.img,other:{颜色及规格:n.properties_value,标签价:n.sale_price+"元",吊牌价:n.market_price+"W"}}),e++);B.value=!0,P.value=r},ie=(x,r)=>{const e=N.value.getData();let n="";for(let s in e)n+=e[s][x]+" ";n?le.CopyText(n):le.CopyText(r)},fe=()=>{if(d.value.print<=0)return y.Toast("请选择!");const x=N.value.getData();let r=[];for(let e of x)r.push({sku_id:e.sku_id});if(r.length==0)return y.Toast("请选择!");D.print.sku=r,D.print.show=!0},ue=()=>{xe(()=>{N.value.checkboxAll(!1)})},we=()=>{for(let x of d.value.list)if(x.brand!=$.data.brand&&y.Toast("[ "+x.sku_id+" ]品牌为“"+x.brand+"”不等于“"+$.data.brand+"”",5e3,"danger"),x.loading==0||x.loading==1)return y.Toast("["+x.sku_id+"]未加载完成!");if(d.value.refresh){const x=y.Loading();E.Post("erp_purchase_out/goods_price?lang="+D.lang,{token:D.token,id:$.data.id,ctime:$.data.ctime},r=>{x.clear();const{code:e,msg:n}=r.data;e!==0&&y.Toast(n,5e3,"danger"),F("update:show",!1),F("submit",d.value.refresh)})}else F("update:show",!1),F("submit",d.value.refresh)};return(x,r)=>(v(),f(G,null,[p(ee,{show:W.value,"onUpdate:show":r[7]||(r[7]=e=>W.value=e),title:I.title,width:"calc(100% - 40px)",top:"56px",bottom:I.data.status==0?"40px":"0px",overflow:"auto",bgClose:!1,onClose:r[8]||(r[8]=e=>we())},{top:t(()=>[l("div",pt,[l("ul",mt,[l("li",null,[p(ce,{value:d.value.key,"onUpdate:value":r[0]||(r[0]=e=>d.value.key=e),onKeyup:r[1]||(r[1]=ke(e=>j(),["enter"])),onIconClick:r[2]||(r[2]=e=>j()),placeholder:k(D).langs.sku_id,maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value","placeholder"])]),I.data.status==0?(v(),f(G,{key:0},[l("li",null,[p(Be,{options:d.value.is_sku},null,8,["options"])]),k(h)("save")?(v(),f("li",vt,[p(H,{type:"danger",effect:"text",padding:"0 4px",onClick:r[3]||(r[3]=e=>ve("part"))},{default:t(()=>r[16]||(r[16]=[g("移除")])),_:1})])):se("",!0),r[18]||(r[18]=l("li",null,"|",-1)),k(h)("goods_imp")?(v(),f("li",ct,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:r[4]||(r[4]=e=>c())},{default:t(()=>r[17]||(r[17]=[g("导入")])),_:1})])):se("",!0),r[19]||(r[19]=l("li",null,"|",-1))],64)):se("",!0),l("li",null,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:r[5]||(r[5]=e=>fe())},{default:t(()=>[g("打印标签("+i(d.value.print)+")",1)]),_:1})])]),l("div",_t,[r[20]||(r[20]=g(" 标签价: ")),l("b",null,i(k(u)(d.value.sale_price)),1),r[21]||(r[21]=g(" 元   吊牌价: ")),l("b",null,i(k(u)(d.value.market_price)),1),r[22]||(r[22]=g(" W   数量: ")),l("b",null,i(d.value.num),1)])])]),bottom:t(()=>[I.data.status==0?(v(),Z(H,{key:0,type:"primary",height:"40px",padding:"0 32px",onClick:r[6]||(r[6]=e=>M())},{default:t(()=>[r[29]||(r[29]=g(" 按品牌拆分( ")),(v(!0),f(G,null,be(b.value.info,(e,n)=>(v(),f("span",null,[g(i(n)+": ",1),l("b",null,i(e),1)]))),256)),r[30]||(r[30]=g(" ) "))]),_:1})):se("",!0)]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref_key:"tableList",ref:N,columns:d.value.columns,options:d.value.list,onOrderBy:T,onPartially:C,maxLen:100},{index:t(e=>[l("div",ft,i(d.value.list.length-e.index),1)]),img:t(e=>[l("div",gt,[l("span",{onClick:n=>e.img?X(e.img):""},[p(Le,{img:e.img?e.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,xt)])]),sku_id:t(e=>[l("div",{class:Te(["copy",e.is_date?"c_danger":"c_primary"])},[g(i(e.sku_id),1),l("span",{onClick:n=>ie("sku_id",e.sku_id)},"复",8,ht)],2)]),short_name:t(e=>[l("div",kt,i(e.short_name||"-"),1)]),i_id:t(e=>[l("div",wt,i(e.i_id||"-"),1)]),supply_price:t(e=>[l("div",yt,[e.supply_price>0?(v(),f(G,{key:0},[e.ratio!="1.00"?(v(),f("span",bt,[l("del",null,i(k(u)(e.supply_price)),1),r[23]||(r[23]=g()),l("b",null,i(k(u)(e.supply_price*e.ratio)),1)])):(v(),f("b",$t,i(k(u)(e.supply_price)),1))],64)):(v(),f("span",Ct,"-"))])]),sale_price:t(e=>[l("div",At,[e.sale_price>0?(v(),f(G,{key:0},[e.ratio!="1.00"?(v(),f("span",Tt,[l("del",null,i(k(u)(e.sale_price)),1),r[24]||(r[24]=g()),l("b",null,i(k(u)(e.sale_price*e.ratio)),1)])):(v(),f("b",St,i(k(u)(e.sale_price)),1))],64)):(v(),f("span",Ut,"-"))])]),market_price:t(e=>[l("div",Dt,[e.market_price>0?(v(),f(G,{key:0},[e.ratio!="1.00"?(v(),f("span",Lt,[l("del",null,i(k(u)(e.market_price)),1),r[25]||(r[25]=g()),l("b",null,i(k(u)(e.market_price*e.ratio)),1)])):(v(),f("b",Wt,i(k(u)(e.market_price)),1))],64)):(v(),f("span",Pt,"-"))])]),unit:t(e=>[l("div",It,i(e.unit||"-"),1)]),weight:t(e=>[l("div",Bt,i(e.weight||"-"),1)]),num:t(e=>[l("div",Yt,[I.data.status==0&&e.loading!=0?(v(),Z(ce,{key:0,value:e.num,"onUpdate:value":n=>e.num=n,"onUpdate:blur":n=>me(n,e.id,e.sku_id),inputAlign:"center"},null,8,["value","onUpdate:value","onUpdate:blur"])):(v(),f("span",Ht,[l("b",null,i(e.num||"-"),1)]))])]),ratio:t(e=>[l("div",Rt,i(e.ratio||"-"),1)]),labels:t(e=>[l("div",Mt,i(e.labels||"-"),1)]),category:t(e=>[l("div",Nt,i(e.category||"-"),1)]),brand:t(e=>[e.brand!=I.data.brand?(v(),f("div",Ft,i(e.brand||">"),1)):(v(),f("div",jt,i(e.brand||">"),1))]),owner:t(e=>[l("div",Vt,i(e.owner||"-"),1)]),view:t(e=>[l("div",Et,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:n=>{k(D).goods.show=!0,k(D).goods.sku_id=e.sku_id}},{default:t(()=>[g(i(k(U).goods_flow),1)]),_:2},1032,["onClick"])])]),action:t(e=>[l("div",Ot,[I.data.status==0?(v(),f(G,{key:0},[e.loading==0?(v(),Z(H,{key:0,type:"warning",effect:"text",padding:"0 4px"},{default:t(()=>r[26]||(r[26]=[g("加载中")])),_:1})):e.loading==1?(v(),Z(H,{key:1,type:"success",effect:"text",padding:"0 4px",onClick:n=>ne([{id:e.id,sku_id:e.sku_id,num:e.num}])},{default:t(()=>r[27]||(r[27]=[g("刷新")])),_:2},1032,["onClick"])):se("",!0),e.loading!=0?(v(),Z(H,{key:2,type:"danger",effect:"text",padding:"0 4px",onClick:n=>ve("one",e)},{default:t(()=>r[28]||(r[28]=[g("移除")])),_:2},1032,["onClick"])):se("",!0)],64)):(v(),f(G,{key:1},[e.status==0?(v(),f("span",Kt,"待退货")):e.status==1?(v(),f("span",zt,"完成")):se("",!0)],64))])]),utime:t(e=>[l("div",{class:"tCenter color1",title:"创建: "+e.ctime+`
更新: `+e.utime},i(e.ctime?e.ctime.substr(11,8):"-"),9,Gt)]),operator_name:t(e=>[l("div",qt,i(e.operator_name||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title","bottom"]),p(ee,{show:d.value.remove.show,"onUpdate:show":r[10]||(r[10]=e=>d.value.remove.show=e),title:d.value.remove.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[p(H,{effect:"dark",type:"danger",height:"40px",padding:"0 32px",onClick:r[9]||(r[9]=e=>Y())},{default:t(()=>[g(i(k(U).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[g(i(d.value.remove.info),1)]),_:1})]),_:1},8,["show","title"]),p(ee,{show:b.value.show,"onUpdate:show":r[12]||(r[12]=e=>b.value.show=e),title:b.value.title,width:"480px",bottom:"40px",isClose:!0},{bottom:t(()=>[p(H,{type:"primary",height:"40px",padding:"0 32px",onClick:r[11]||(r[11]=e=>z())},{default:t(()=>[g(i(k(U).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[(v(!0),f(G,null,be(b.value.info,(e,n)=>(v(),f("span",null,[g(i(n)+": ",1),l("b",null,i(e),1)]))),256))]),_:1})]),_:1},8,["show","title"]),p(rt,{show:A.value.show,"onUpdate:show":r[13]||(r[13]=e=>A.value.show=e),title:A.value.title,data:{wms_co_id:$.data.wms_co_id},onSubmit:r[14]||(r[14]=e=>o(e))},null,8,["show","title","data"]),p(Ae,{show:B.value,"onUpdate:show":r[15]||(r[15]=e=>B.value=e),index:R.value,options:P.value},null,8,["show","index","options"])],64))}}),Qt=Ce(Jt,[["__scopeId","data-v-03b8045b"]]),Xt={class:"goods_info flex"},Zt={class:"goods_info_tools flex"},es={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},ts={class:"tCenter"},ss={class:"flex_center"},ls=["onClick"],as={class:"copy c_primary"},os=["onClick"],ns={class:"tCenter"},is={class:"tRight"},us={key:0},ds={key:1},rs={key:1},ps={class:"tRight"},ms={key:0},vs={key:1},cs={key:1},_s={class:"tCenter"},fs={class:"tCenter"},gs={class:"tCenter"},xs={class:"tCenter"},hs={class:"tCenter"},ks={key:0,class:"c_danger"},ws={key:1,class:"c_success"},ys={class:"tCenter type"},bs={key:0,class:"type_warning"},$s={key:1,class:"type_success"},Cs={key:2,class:"type_warning"},As={key:3,class:"type_success"},Ts={key:4,class:"type_info"},Ss={key:5,class:"type_danger"},Us={key:6,class:"type_primary"},Ds={key:7,class:"type_info"},Ls={class:"tCenter"},Ws={class:"goods_info flex"},Ps={class:"goods_info_tools flex"},Is={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},Bs={class:"tCenter"},Ys={class:"tCenter"},Hs={class:"tCenter"},Rs={class:"tCenter"},Ms={class:"tCenter"},Ns={key:0,class:"flex_center status0"},Fs={key:1,class:"flex_center status1"},js={key:2,class:"flex_center status2"},Vs={key:3,class:"tCenter"},Es=ae({__name:"diff",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,N=L(),S=L(),U=oe().state,u=U.langs,h=$e.priceEncode,W=L(!1);let _=L([]);const m=L({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:u.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",width:"120px",minWidth:"120px"},{title:"款式编码",slot:"i_id",index:"i_id",textAlign:"center",width:"80px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px"},{title:"重量",slot:"weight",index:"weight",textAlign:"center",width:"60px"},{title:"数量",slot:"num",index:"num",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"action",index:"status",textAlign:"center",width:"60px",minWidth:"60px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"类型",slot:"type_name",textAlign:"center",width:"60px"},{title:"采购员",slot:"owner",textAlign:"center",width:"60px"},{title:"仓库",index:"warehouse"}],list:[],sale_price:0,market_price:0,num:0,out_num:0}),d=L({show:!1,key:"",order:"",columns:[{title:"单号",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:u.date,index:"date",slot:"date",width:"90px",textAlign:"center"},{title:"类型",slot:"type",width:"80px",minWidth:"80px",textAlign:"center"},{title:"仓库",index:"wms_co_name"},{title:"数量",slot:"num",textAlign:"center"},{title:"条数",slot:"total",textAlign:"center"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:"制单员",index:"creator_name",textAlign:"center"},{title:"备注",index:"remark"}],list:[],total:0,num:0}),A=L(!1),b=L(0),B=L([]);de(()=>$.show,Y=>{if(W.value=Y,Y){_.value=[];for(let c of $.data)E.Post("erp_purchase_out/goods_list?lang="+U.lang,{token:U.token,id:c},o=>{const{code:M,msg:z,data:X}=o.data;if(M==0)for(let ie of X)_.value.push(ie);else y.Toast(z)})}},{deep:!0});const R=Y=>{m.value.order=Y,C(m.value.key)},P=()=>{const Y=le.LTrim(m.value.key.trim().toUpperCase(),"0");C(Y)},C=Y=>{m.value.list=[],m.value.out_num=0;const c=Y.split(" ");for(let o of c){const M=y.Loading();E.Post("erp_purchase_in/goods_list?lang="+U.lang,{token:U.token,id:o},z=>{M.clear();const{code:X,msg:ie,data:fe}=z.data;if(X==0)for(let ue of fe)m.value.out_num+=ue.num,T(ue.sku_id)||(m.value.list.push({sku_id:ue.sku_id}),j(ue.sku_id));else y.Toast(ie)})}},T=(Y="")=>{for(let c of _.value)if(Y===c.sku_id)return!0;return!1},j=Y=>{E.Post("goods/direct?lang="+U.lang,{token:U.token,sku_id:Y,time:24},c=>{const{code:o,msg:M,data:z}=c.data;if(o==0){if(z.list.length===0)return;for(let X in m.value.list)m.value.list[X].sku_id==z.list[0].sku_id&&(m.value.list[X]=z.list[0],q())}else y.Toast(M)})},q=()=>{m.value.sale_price=0,m.value.market_price=0,m.value.num=0;for(let Y of m.value.list)m.value.sale_price+=Y.sale_price*Y.num,m.value.market_price+=Y.market_price*Y.num,m.value.num+=Y.num},K=()=>{const Y=le.LTrim(d.value.key.trim().toUpperCase(),"0");d.value.key="",Q(Y)},Q=Y=>{d.value.list=[];const c=y.Loading();E.Post("erp_purchase_in/list?lang="+U.lang,{token:U.token,data:{key:Y},page:1,limit:30,order:""},o=>{c.clear();const{code:M,msg:z,data:X,time:ie}=o.data;M==0?(d.value.list=X,xe(()=>{S.value.checkboxAll(!1)})):y.Toast(z)})},_e=(Y,c)=>{d.value.total=Y,d.value.num=0;const o=S.value.getData();for(let M of o)d.value.num+=parseInt(M.num)},ne=()=>{const Y=S.value.getData();if(Y.length==0)return y.Toast("请选择入库单");let c=[];for(let o of Y)c.push(o.id);d.value.show=!1,m.value.key=c.join(" "),P()},re=Y=>{let c=[],o=0;for(let M of m.value.list)M.img&&(M.img==Y&&(b.value=o),c.push({label:M.sku_id,value:M.img,other:{颜色及规格:M.properties_value,标签价:M.sale_price+"元",吊牌价:M.market_price+"W"}}),o++);A.value=!0,B.value=c},me=(Y,c)=>{const o=N.value.getData();let M="";for(let z in o)M+=o[z][Y]+" ";M?le.CopyText(M):le.CopyText(c)},ve=()=>{_.value=[],m.value.key="",m.value.list=[],m.value.num=0,m.value.out_num=0,m.value.sale_price=0,m.value.market_price=0,F("update:show",!1)};return(Y,c)=>(v(),f(G,null,[p(ee,{show:W.value,"onUpdate:show":c[4]||(c[4]=o=>W.value=o),title:I.title,width:"calc(100% - 40px)",maxWidth:"1366px",overflow:"auto",top:"56px",bottom:"0px",bgClose:!1,onClose:c[5]||(c[5]=o=>ve())},{top:t(()=>[l("div",Xt,[l("ul",Zt,[l("li",null,[p(ce,{value:m.value.key,"onUpdate:value":c[0]||(c[0]=o=>m.value.key=o),onKeyup:c[1]||(c[1]=ke(o=>P(),["enter"])),onIconClick:c[2]||(c[2]=o=>P()),placeholder:"入库单号,多个空格分离",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])]),l("li",null,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:c[3]||(c[3]=o=>{d.value.show=!0,Q(d.value.key)})},{default:t(()=>c[13]||(c[13]=[g("选择入库单")])),_:1})])]),l("div",es,[c[14]||(c[14]=g(" 入库数: ")),l("b",null,i(m.value.out_num),1),c[15]||(c[15]=g("    采退数: ")),l("b",null,i(I.num),1),c[16]||(c[16]=g("    标签价: ")),l("b",null,i(k(h)(m.value.sale_price)),1),c[17]||(c[17]=g(" 元   吊牌价: ")),l("b",null,i(k(h)(m.value.market_price)),1),c[18]||(c[18]=g(" W   数量: ")),l("b",null,i(m.value.num),1)])])]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref_key:"tableList",ref:N,columns:m.value.columns,options:m.value.list,onOrderBy:R},{index:t(o=>[l("div",ts,i(m.value.list.length-o.index),1)]),img:t(o=>[l("div",ss,[l("span",{onClick:M=>o.img?re(o.img):""},[p(Le,{img:o.img?o.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,ls)])]),sku_id:t(o=>[l("div",as,[g(i(o.sku_id),1),l("span",{onClick:M=>me("sku_id",o.sku_id)},"复",8,os)])]),i_id:t(o=>[l("div",ns,i(o.i_id||"-"),1)]),sale_price:t(o=>[l("div",is,[o.sale_price>0?(v(),f(G,{key:0},[o.ratio!="1.00"?(v(),f("span",us,[l("del",null,i(k(h)(o.sale_price)),1),c[19]||(c[19]=g()),l("b",null,i(k(h)(o.sale_price*o.ratio)),1)])):(v(),f("b",ds,i(k(h)(o.sale_price)),1))],64)):(v(),f("span",rs,"-"))])]),market_price:t(o=>[l("div",ps,[o.market_price>0?(v(),f(G,{key:0},[o.ratio!="1.00"?(v(),f("span",ms,[l("del",null,i(k(h)(o.market_price)),1),c[20]||(c[20]=g()),l("b",null,i(k(h)(o.market_price*o.ratio)),1)])):(v(),f("b",vs,i(k(h)(o.market_price)),1))],64)):(v(),f("span",cs,"-"))])]),unit:t(o=>[l("div",_s,i(o.unit||"-"),1)]),weight:t(o=>[l("div",fs,i(o.weight||"-"),1)]),num:t(o=>[l("div",gs,[l("b",null,i(o.num||"-"),1)])]),view:t(o=>[l("div",xs,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:M=>{k(U).goods.show=!0,k(U).goods.sku_id=o.sku_id}},{default:t(()=>[g(i(k(u).goods_flow),1)]),_:2},1032,["onClick"])])]),action:t(o=>[l("div",hs,[o.status==0?(v(),f("span",ks,"进行中")):o.status==1?(v(),f("span",ws,"完成")):se("",!0)])]),type_name:t(o=>[l("div",ys,[o.type=="6"?(v(),f("span",bs,i(o.type_name||"-"),1)):o.type=="5"?(v(),f("span",$s,i(o.type_name||"-"),1)):o.type=="4"?(v(),f("span",Cs,i(o.type_name||"-"),1)):o.type=="3"?(v(),f("span",As,i(o.type_name||"-"),1)):o.type=="2"?(v(),f("span",Ts,i(o.type_name||"-"),1)):o.type=="1"?(v(),f("span",Ss,i(o.type_name||"-"),1)):o.type=="0"?(v(),f("span",Us,i(o.type_name||"-"),1)):o.type=="-1"?(v(),f("span",Ds,i(o.type_name||"-"),1)):se("",!0)])]),owner:t(o=>[l("div",Ls,i(o.owner||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),p(Ae,{show:A.value,"onUpdate:show":c[6]||(c[6]=o=>A.value=o),index:b.value,options:B.value},null,8,["show","index","options"]),p(ee,{show:d.value.show,"onUpdate:show":c[11]||(c[11]=o=>d.value.show=o),title:"选择入库单",width:"calc(100% - 40px)",maxWidth:"1280px",overflow:"auto",top:"56px",bottom:"40px",onClose:c[12]||(c[12]=o=>d.value.show=!1)},{top:t(()=>[l("div",Ws,[l("ul",Ps,[l("li",null,[p(ce,{value:d.value.key,"onUpdate:value":c[7]||(c[7]=o=>d.value.key=o),onKeyup:c[8]||(c[8]=ke(o=>K(),["enter"])),onIconClick:c[9]||(c[9]=o=>K()),placeholder:"单号、商品编码、备注",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])])]),l("div",Is,[c[21]||(c[21]=g(" 入库数: ")),l("b",null,i(d.value.num),1),c[22]||(c[22]=g("   采退数: ")),l("b",null,i(I.num),1),c[23]||(c[23]=g("    差异: ")),l("b",null,i(d.value.num-I.num>0?d.value.num-I.num:I.num-d.value.num),1)])])]),bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:c[10]||(c[10]=o=>ne())},{default:t(()=>[g(i(k(u).confirm),1)]),_:1})]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref_key:"formList",ref:S,overflow:"auto",columns:d.value.columns,options:d.value.list,onPartially:_e},{id:t(o=>[l("div",Bs,i(o.id),1)]),date:t(o=>[l("div",Ys,[p(Se,{title:"创建: "+o.ctime+`
更新: `+o.utime+`
制单: `+o.creator_name+", 审核: "+o.operator_name+`
备注: `+o.remark},{default:t(()=>[g(i(o.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(o=>[l("div",Hs,i(o.type_name),1)]),num:t(o=>[l("div",Rs,i(o.num),1)]),total:t(o=>[l("div",Ms,i(o.total),1)]),status:t(o=>[o.status=="0"?(v(),f("div",Ns,i(o.status_name),1)):o.status=="1"?(v(),f("div",Fs,i(o.status_name),1)):o.status=="2"?(v(),f("div",js,i(o.status_name),1)):(v(),f("div",Vs,i(o.status_name),1))]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show"])],64))}}),Os=Ce(Es,[["__scopeId","data-v-67b115dd"]]),Ks={class:"app_action flex"},zs={class:"app_action_tools scrollbar"},Gs={key:0,class:"line"},qs={key:0,class:"line"},Js={class:"app_action_search flex"},Qs={class:"custom_time flex_center"},Xs=["onClick"],Zs={class:"app_ct"},el={class:"tCenter"},tl={class:"tCenter"},sl={class:"tCenter"},ll={class:"tCenter"},al={class:"tRight"},ol={class:"tRight"},nl={class:"tCenter"},il={class:"tCenter"},ul={key:0,class:"flex_center status0"},dl={key:1,class:"flex_center status1"},rl={key:2,class:"flex_center status2"},pl={key:3,class:"tCenter"},ml={class:"tCenter"},vl={key:2,class:"c_info"},cl={class:"tCenter"},_l={class:"tCenter"},fl={class:"app_page"},gl=ae({__name:"index",setup(I){const O=L(!1),$=L(),N=oe().state,S=N.langs,D=Ue.isAction,U=$e.priceEncode,u=L({show:!1,key:"",placeholder:"ID、品牌、操作员、备注",time:[V.Date("Y/m/d",V.StrToTime("-1 month")),V.Date("Y/m/d")],maxDate:V.Date("Y/m/d"),customTime:{active:"",list:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"3个月",value:"month"},{label:"近1年",value:"year"}]},columns:[{label:"",value:"",slot:"customTime"},{label:S.select,value:"",slot:"time"},{label:"仓库名称",value:"",slot:"wms_co_id"},{label:"退货类型",value:"",slot:"type"},{label:"状态",value:"",slot:"status"},{label:"品牌",value:"",slot:"brand"},{label:"单号, 多条空格分离",value:"",name:"id"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label:"制单员",value:"",name:"creator_name"},{label:"操作员",value:"",name:"operator_name"},{label:"备注",value:"",name:"remark"}],type:"",wms_co_id:"",brand:"",status:""}),h=L({time:"",list:{num:0,cost_price:0,sale_price:0,purchase_price:0,market_price:0}}),W=L({columns:[{title:"单号",slot:"id",textAlign:"center",width:"100px"},{title:S.date,slot:"date",textAlign:"center",width:"90px"},{title:"类型",slot:"type",index:"type",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"退货仓库",index:"wms_co_name",width:"200px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"标签总额(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌总额(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px"},{title:"条数",slot:"total",index:"total",order:"",textAlign:"center",width:"60px"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:S.action,slot:"action",textAlign:"center",width:"40px"},{title:"商品",slot:"goods",textAlign:"center",width:"40px"},{title:S.review,slot:"print",textAlign:"center",width:"40px"},{title:"制单员",index:"creator_name",textAlign:"center",width:"100px"},{title:"操作员",index:"operator_name",textAlign:"center",width:"100px"},{title:"备注",index:"remark"}],data:[],num:0,total:0,order:""}),_=L({total:0,num:1,limit:100}),m=L({show:!1,title:"添加/编辑",data:{}}),d=L({show:!1,title:"删除",data:[]}),A=L({show:!1,title:"推送",info:"",num:0,data:[]}),b=L({show:!1,title:"撤回",info:"",data:[]}),B=L({show:!1,title:"导出",num:0,data:[]}),R=L({show:!1,title:"对比",num:0,data:[]}),P=L({show:!1,title:"商品",data:{}}),C=L({show:!1,title:"入库单",info:{},columns:[],data:[]}),T=L({partner_name:[],brand_name:[],type_name:[],status_name:[]});Ye(()=>{N.token&&e()}),He(()=>{O&&N.isLogin&&j()});const j=()=>{u.value.show=!1,W.value.data=[];const n=y.Loading();E.Post("erp_purchase_out/list?lang="+N.lang,{token:N.token,data:q(),page:_.value.num,limit:_.value.limit,order:W.value.order},s=>{n.clear();const{code:a,msg:w,data:J,time:ge}=s.data;a==0?(h.value.time=ge,W.value.data=J,xe(()=>ne())):y.Toast(w)}),_.value.total=0,h.value.list.num=0,h.value.list.cost_price=0,h.value.list.sale_price=0,h.value.list.purchase_price=0,h.value.list.market_price=0,E.Post("erp_purchase_out/total?lang="+N.lang,{token:N.token,data:q()},s=>{const{code:a,msg:w,data:J,time:ge}=s.data;a==0?(h.value.time=ge,_.value.total=J.total,h.value.list.cost_price=J.cost_price,h.value.list.sale_price=J.sale_price,h.value.list.purchase_price=J.purchase_price,h.value.list.market_price=J.market_price,h.value.list.num=J.num):y.Toast(w)})},q=()=>{const n={key:u.value.key,stime:typeof u.value.time[0]=="string"?u.value.time[0]:V.Date("Y/m/d",u.value.time[0]),etime:typeof u.value.time[1]=="string"?u.value.time[1]:V.Date("Y/m/d",u.value.time[1]),wms_co_id:u.value.wms_co_id,type:u.value.type,status:u.value.status,brand:u.value.brand};for(let s of u.value.columns)s.name&&(n[s.name]=s.value);return n},K=(n,s)=>{W.value.num=n,W.value.total=s;const a=$.value.getData();d.value.data=[],A.value.data=[],A.value.num=0,B.value.data=[],B.value.num=0,R.value.data=[],R.value.num=0;for(let w of a)w.status==0&&(d.value.data.push(w.id),A.value.data.push(w.id),A.value.num+=parseInt(w.num)),B.value.data.push(w.id),B.value.num+=parseInt(w.num),R.value.data.push(w.id),R.value.num+=parseInt(w.num)},Q=n=>{W.value.order=n,j()},_e=()=>{u.value.time=[V.Date("Y/m/d",V.StrToTime("-1 month")),V.Date("Y/m/d")],u.value.customTime.active="",u.value.key="",u.value.wms_co_id="",u.value.type="",u.value.status="",u.value.brand="";for(let n of u.value.columns)n.value="";W.value.order="",_.value.num=1,j()},ne=()=>{xe(()=>{$.value.checkboxAll(!1)})},re=n=>{switch(u.value.customTime.active=n,n){case"today":u.value.time=[V.Date("Y/m/d"),V.Date("Y/m/d")];break;case"yesterday":u.value.time=[V.Date("Y/m/d",V.StrToTime("-1 day")),V.Date("Y/m/d",V.StrToTime("-1 day"))];break;case"month":u.value.time=[V.Date("Y/m/d",V.StrToTime("-3 month")),V.Date("Y/m/d")];break;case"year":u.value.time=[V.Date("Y/m/d",V.StrToTime("-1 year")),V.Date("Y/m/d")];break}},me=(n,s={})=>{m.value.show=!0,m.value.data=s,m.value.data.tp=n,n=="add"?m.value.title=S.add:n=="edit"&&(m.value.title=S.edit+"( "+s.id+" )",m.value.data.id=s.id)},ve=n=>{n&&(m.value.show=!1,j())},Y=()=>{d.value.show=!0},c=n=>{n&&(d.value.show=!1,j())},o=()=>{A.value.show=!0,A.value.info="单号:[ <b>"+A.value.data.join(",")+"</b> ]&nbsp;&nbsp;&nbsp;&nbsp;数量: <b>"+A.value.num+"</b>"},M=n=>{n&&(A.value.show=!1,j())},z=(n,s)=>{b.value.show=!0,b.value.data=[n],b.value.info="单号: <b>"+n+"</b>&nbsp;&nbsp;&nbsp;&nbsp;数量: <b>"+s+"</b>"},X=n=>{n&&(b.value.show=!1,j())},ie=()=>{B.value.show=!0},fe=n=>{n&&(B.value.show=!1,ne())},ue=()=>{R.value.show=!0,R.value.title="对比入库单( "+R.value.data.join(",")+" )"},we=n=>{P.value.show=!0,P.value.title=n.wms_co_name+"( "+n.id+" )",P.value.data.id=n.id,P.value.data.ctime=n.ctime,P.value.data.utime=n.utime,P.value.data.wms_co_id=n.wms_co_id,P.value.data.status=n.status,P.value.data.brand=n.brand},x=n=>{n&&(P.value.show=!1,j())},r=n=>{C.value.show=!0,C.value.info={title:"[采退] "+n.wms_co_name,id:n.id,cost_price:n.cost_price,sale_price:n.sale_price,purchase_price:n.purchase_price,market_price:n.market_price,num:n.num,ctime:n.ctime,utime:n.utime,creator_name:n.creator_name,operator_name:n.operator_name,remark:n.remark},C.value.columns=[{label:"商品编码",value:"sku_id",checked:!0,textAlign:"center"},{label:"商品名称",value:"name",checked:!0,textAlign:"center"},{label:"颜色及规格",value:"properties_value",checked:!0},{label:"成本金额(元)",value:"cost_price",checked:!1,price:!0,textAlign:"right"},{label:"标签金额(元)",value:"sale_price",checked:!0,price:!0,textAlign:"right"},{label:"采购金额(W)",value:"purchase_price",checked:!1,price:!0,textAlign:"right"},{label:"吊牌金额(W)",value:"market_price",checked:!0,price:!0,textAlign:"right"},{label:"数量",value:"num",checked:!0,textAlign:"center"},{label:"折扣",value:"ratio",checked:!0,textAlign:"center"},{label:"单位",value:"unit",checked:!0,textAlign:"center"},{label:"重量",value:"weight",checked:!0,textAlign:"center"},{label:"标签",value:"labels",checked:!1,textAlign:"center"},{label:"商品分类",value:"category",checked:!1,textAlign:"center"},{label:"品牌",value:"brand",checked:!0,textAlign:"center"},{label:"采购员",value:"owner",checked:!0,textAlign:"center"},{label:"供应商",value:"supplier_name",checked:!1,textAlign:"center"},{label:"制单员",value:"operator_name",checked:!0,textAlign:"center"},{label:"创建时间",value:"ctime",checked:!0,textAlign:"center"},{label:"更新时间",value:"ctime",checked:!1,textAlign:"center"}];const s=y.Loading();E.Post("erp_purchase_out/goods_list?lang="+N.lang,{token:N.token,id:n.id,ctime:n.ctime,utime:n.utime,wms_co_id:n.wms_co_id},a=>{s.clear();const{code:w,msg:J,data:ge}=a.data;w==0?C.value.data=ge:y.Toast(J)})},e=()=>{E.Post("erp_purchase_out/get_select?lang="+N.lang,{token:N.token},n=>{const{code:s,msg:a,data:w}=n.data;s==0?(T.value.partner_name=w.partner_name,T.value.brand_name=w.brand_name,T.value.type_name=w.type_name,T.value.status_name=w.status_name,O.value=!0):y.Toast(a)})};return(n,s)=>(v(),f(G,null,[p(je,{time:h.value.time,onRefresh:s[0]||(s[0]=a=>j())},{default:t(()=>[s[35]||(s[35]=g(" 标签金额: ")),l("b",null,i(k(U)(h.value.list.sale_price)),1),s[36]||(s[36]=g(" 元   吊牌金额: ")),l("b",null,i(k(U)(h.value.list.market_price)),1),s[37]||(s[37]=g(" W   数量: ")),l("b",null,i(h.value.list.num),1),s[38]||(s[38]=g("   "))]),_:1},8,["time"]),l("div",Ks,[l("div",zs,[p(Me,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line1"},{action:"push",slot:"push",is_action:!0},{action:"line",slot:"line2"},{action:"export",slot:"export",is_action:!0},{action:"diff",slot:"diff",is_action:!1}]},{add:t(()=>[p(H,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:s[1]||(s[1]=a=>me("add"))},{default:t(()=>[g(i(k(S).add),1)]),_:1})]),del:t(()=>[p(H,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:d.value.data.length==0,onClick:s[2]||(s[2]=a=>Y())},{default:t(()=>[g(i(k(S).del)+"("+i(d.value.data.length)+")",1)]),_:1},8,["disabled"])]),line1:t(()=>[k(D)("save")?(v(),f("span",Gs,"|")):se("",!0)]),push:t(()=>[p(H,{effect:"plain",type:"primary",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:A.value.data.length==0,onClick:s[3]||(s[3]=a=>o())},{default:t(()=>[g("推送("+i(A.value.data.length)+")",1)]),_:1},8,["disabled"])]),line2:t(()=>[k(D)("push")?(v(),f("span",qs,"|")):se("",!0)]),export:t(()=>[p(H,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:B.value.data.length==0,onClick:s[4]||(s[4]=a=>ie())},{default:t(()=>[g(i(k(S).export)+"("+i(B.value.num)+")",1)]),_:1},8,["disabled"])]),diff:t(()=>[p(H,{effect:"plain",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:R.value.data.length==0,onClick:s[5]||(s[5]=a=>ue())},{default:t(()=>[g("对比("+i(R.value.num)+")",1)]),_:1},8,["disabled"])]),_:1})]),l("div",Js,[p(Ne,{show:u.value.show,"onUpdate:show":s[11]||(s[11]=a=>u.value.show=a),keys:u.value.key,"onUpdate:keys":s[12]||(s[12]=a=>u.value.key=a),columns:u.value.columns,placeholder:u.value.placeholder,onKeyup:s[13]||(s[13]=ke(a=>{_.value.num=1,j()},["enter"])),onSearch:s[14]||(s[14]=a=>{_.value.num=1,j()}),onReset:s[15]||(s[15]=a=>_e())},{customTime:t(a=>[l("ul",Qs,[(v(!0),f(G,null,be(u.value.customTime.list,w=>(v(),f("li",{key:w.value,onClick:J=>re(w.value),class:Te({active:u.value.customTime.active===w.value})},i(w.label),11,Xs))),128))])]),time:t(a=>[p(Re,{value:u.value.time,"onUpdate:value":s[6]||(s[6]=w=>u.value.time=w),range:"",maxDate:u.value.maxDate,placeholder:a.label},null,8,["value","maxDate","placeholder"])]),wms_co_id:t(a=>[p(pe,{value:u.value.wms_co_id,"onUpdate:value":s[7]||(s[7]=w=>u.value.wms_co_id=w),options:T.value.partner_name,placeholder:a.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),type:t(a=>[p(pe,{value:u.value.type,"onUpdate:value":s[8]||(s[8]=w=>u.value.type=w),options:T.value.type_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),status:t(a=>[p(pe,{value:u.value.status,"onUpdate:value":s[9]||(s[9]=w=>u.value.status=w),options:T.value.status_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),brand:t(a=>[p(pe,{value:u.value.brand,"onUpdate:value":s[10]||(s[10]=w=>u.value.brand=w),options:T.value.brand_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["show","keys","columns","placeholder"])])]),l("div",Zs,[p(he,{ref_key:"tableList",ref:$,overflow:"auto",columns:W.value.columns,options:W.value.data,onOrderBy:Q,onPartially:K},{id:t(a=>[l("div",el,i(a.id),1)]),date:t(a=>[l("div",tl,[p(Se,{title:"创建: "+a.ctime+`
更新: `+a.utime+`
制单: `+a.creator_name+", 审核: "+a.operator_name+`
备注: `+a.remark},{default:t(()=>[g(i(a.ctime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(a=>[l("div",sl,i(a.type_name),1)]),brand:t(a=>[l("div",ll,i(a.brand),1)]),sale_price:t(a=>[l("div",al,i(a.sale_price>0?k(U)(a.sale_price):"-"),1)]),market_price:t(a=>[l("div",ol,i(a.market_price>0?k(U)(a.market_price):"-"),1)]),num:t(a=>[l("div",nl,i(a.num),1)]),total:t(a=>[l("div",il,i(a.total),1)]),status:t(a=>[a.status=="0"?(v(),f("div",ul,i(a.status_name),1)):a.status=="1"?(v(),f("div",dl,i(a.status_name),1)):a.status=="2"?(v(),f("div",rl,i(a.status_name),1)):(v(),f("div",pl,i(a.status_name),1))]),action:t(a=>[l("div",ml,[k(D)("save")&&a.state=="0"?(v(),Z(H,{key:0,onClick:w=>me("edit",a)},{default:t(()=>[g(i(k(S).edit),1)]),_:2},1032,["onClick"])):k(D)("save")&&a.state=="1"?(v(),Z(H,{key:1,type:"danger",effect:"text",onClick:w=>z(a.id,a.num)},{default:t(()=>s[39]||(s[39]=[g("撤回")])),_:2},1032,["onClick"])):(v(),f("span",vl,s[40]||(s[40]=[l("i",{class:"ui ui_safety"},null,-1)])))])]),goods:t(a=>[l("div",cl,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:w=>we(a)},{default:t(()=>s[41]||(s[41]=[g("商品")])),_:2},1032,["onClick"])])]),print:t(a=>[l("div",_l,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:w=>r(a),disabled:a.num==0},{default:t(()=>[g(i(k(S).print),1)]),_:2},1032,["onClick","disabled"])])]),_:1},8,["columns","options"])]),l("div",fl,[p(Fe,{total:_.value.total,"onUpdate:total":s[16]||(s[16]=a=>_.value.total=a),page:_.value.num,"onUpdate:page":[s[17]||(s[17]=a=>_.value.num=a),s[18]||(s[18]=a=>j())],limit:_.value.limit,"onUpdate:limit":[s[19]||(s[19]=a=>_.value.limit=a),s[20]||(s[20]=a=>{_.value.num=1,j()})]},null,8,["total","page","limit"])]),p(Ee,{show:m.value.show,"onUpdate:show":s[21]||(s[21]=a=>m.value.show=a),title:m.value.title,data:m.value.data,onSubmit:s[22]||(s[22]=a=>ve(a))},null,8,["show","title","data"]),p(Ke,{show:d.value.show,"onUpdate:show":s[23]||(s[23]=a=>d.value.show=a),data:d.value.data,onSubmit:s[24]||(s[24]=a=>c(a))},null,8,["show","data"]),p(Ge,{show:A.value.show,"onUpdate:show":s[25]||(s[25]=a=>A.value.show=a),title:A.value.title,info:A.value.info,data:A.value.data,onSubmit:s[26]||(s[26]=a=>M(a))},null,8,["show","title","info","data"]),p(Je,{show:b.value.show,"onUpdate:show":s[27]||(s[27]=a=>b.value.show=a),title:b.value.title,info:b.value.info,data:b.value.data,onSubmit:s[28]||(s[28]=a=>X(a))},null,8,["show","title","info","data"]),p(Xe,{show:B.value.show,"onUpdate:show":s[29]||(s[29]=a=>B.value.show=a),data:B.value.data,num:B.value.num,onSubmit:s[30]||(s[30]=a=>fe(a))},null,8,["show","data","num"]),p(Os,{show:R.value.show,"onUpdate:show":s[31]||(s[31]=a=>R.value.show=a),title:R.value.title,data:R.value.data,num:R.value.num},null,8,["show","title","data","num"]),p(Qt,{show:P.value.show,"onUpdate:show":s[32]||(s[32]=a=>P.value.show=a),title:P.value.title,data:P.value.data,onSubmit:s[33]||(s[33]=a=>x(a))},null,8,["show","title","data"]),p(Ve,{show:C.value.show,"onUpdate:show":s[34]||(s[34]=a=>C.value.show=a),title:C.value.title,info:C.value.info,columns:C.value.columns,data:C.value.data},null,8,["show","title","info","columns","data"])],64))}}),Cl=Ce(gl,[["__scopeId","data-v-fb0a078d"]]);export{Cl as default};
