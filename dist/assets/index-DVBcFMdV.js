import{d as j,u as R,r as y,w as q,c as V,a as l,e as G,f as r,h as re,n as N,B as z,i as s,j as I,k as Q,l as S,t as p,b as x,m as A,U as h,R as P,o as Y,G as Z,F as me,T as f,y as ve,z as ce,D as pe,E as we,s as J,K as _e,H as ge,v as fe,x as M,I as ke,Q as X}from"./index-CkPR886e.js";import{c as E,w as xe,a as ye,b as be,P as he}from"./Search-Cqah4TYq.js";import{w as Te}from"./Total-CTn3KGGG.js";const Ce={key:0},De=j({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(D,{emit:L}){const k=D,U=L,i=R().state,T=i.langs,a=y(!1),v=y({type:"",ids:[],wms_co_id:"",sku_id:"",num:"0",remark:""}),_=y({partner_name:[]});q(()=>k.show,w=>{a.value=w,w&&(v.value.type=k.data.type||"",v.value.ids=k.data.ids||[],v.value.sku_id=k.data.sku_id||"",v.value.num=k.data.num,m())},{deep:!0});const m=()=>{P.Post("erp_goods_stock/get_select?lang="+i.lang,{token:i.token},w=>{const{code:u,msg:c,data:B}=w.data;u==0?(_.value.partner_name=B.partner_name,Z(()=>{v.value.wms_co_id=k.data.wms_co_id||[]})):h.Toast(c)})},o=w=>w.type=="add"&&w.wms_co_id.length==0?h.Toast("请选择分仓"):w.sku_id?isNaN(w.num)||w.num<0?h.Toast("请输入库存"):w:h.Toast("请输入商品编码"),g=()=>{const w=o(v.value);if(!w)return;const u=h.Loading();P.Post("erp_goods_stock/save?lang="+i.lang,{token:i.token,data:w},c=>{u.clear();const{code:B,msg:F}=c.data;h.Toast(F),U("submit",B==0)})},C=()=>{U("update:show",!1)};return(w,u)=>(Y(),V(G,{show:a.value,"onUpdate:show":u[5]||(u[5]=c=>a.value=c),title:D.title,width:"640px",bottom:"40px",onClose:u[6]||(u[6]=c=>C())},{bottom:l(()=>[r(A,{height:"40px",padding:"0 32px",onClick:u[4]||(u[4]=c=>g())},{default:l(()=>[S(p(x(T).confirm),1)]),_:1})]),default:l(()=>[r(Q,null,{default:l(()=>[r(re,null,{default:l(()=>[v.value.type=="add"?(Y(),N("tr",Ce,[u[7]||(u[7]=s("td",{class:"label"},"分仓",-1)),s("td",null,[r(E,{value:v.value.wms_co_id,"onUpdate:value":u[0]||(u[0]=c=>v.value.wms_co_id=c),options:_.value.partner_name},null,8,["value","options"])])])):z("",!0),s("tr",null,[u[8]||(u[8]=s("td",{class:"label"},"商品编码",-1)),s("td",null,[r(I,{value:v.value.sku_id,"onUpdate:value":u[1]||(u[1]=c=>v.value.sku_id=c),placeholder:"商品编码, 多条空格分离",type:"textarea",height:"160px",disabled:v.value.type!="add"},null,8,["value","disabled"])])]),s("tr",null,[u[9]||(u[9]=s("td",{class:"label"},"库存",-1)),s("td",null,[r(I,{value:v.value.num,"onUpdate:value":u[2]||(u[2]=c=>v.value.num=c),placeholder:"库存数量"},null,8,["value"])])]),s("tr",null,[u[10]||(u[10]=s("td",{class:"label"},"备注",-1)),s("td",null,[r(I,{value:v.value.remark,"onUpdate:value":u[3]||(u[3]=c=>v.value.remark=c),placeholder:"日志备注"},null,8,["value"])])])]),_:1})]),_:1})]),_:1},8,["show","title"]))}}),Se=["innerHTML"],$e=j({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(D,{emit:L}){const k=D,U=L,i=R().state,T=i.langs,a=y(!1);q(()=>k.show,m=>{a.value=m},{deep:!0});const v=()=>{const m=h.Loading();P.Post("erp_goods_stock/del?lang="+i.lang,{token:i.token,data:k.data},o=>{m.clear();const{code:g,msg:C}=o.data;h.Toast(C),U("submit",g==0)})},_=()=>{U("update:show",!1)};return(m,o)=>(Y(),V(G,{show:a.value,"onUpdate:show":o[1]||(o[1]=g=>a.value=g),title:D.title||x(T).del,width:"360px",bottom:"40px",onClose:o[2]||(o[2]=g=>_())},{bottom:l(()=>[r(A,{effect:"dark",type:"danger",height:"40px",onClick:o[0]||(o[0]=g=>v())},{default:l(()=>[S(p(x(T).confirm),1)]),_:1})]),default:l(()=>[r(Q,{lineHeight:"60px"},{default:l(()=>[s("span",{innerHTML:x(T).del_warn(D.data.length)},null,8,Se)]),_:1})]),_:1},8,["show","title"]))}}),Ue=["innerHTML"],Ae=j({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(D,{emit:L}){const k=D,U=L,i=R().state,T=i.langs,a=y(!1);q(()=>k.show,m=>{a.value=m},{deep:!0});const v=()=>{const m=h.Loading();P.Post("erp_goods_stock/export?lang="+i.lang,{token:i.token,data:k.data,order:k.order},o=>{m.clear();const{code:g,msg:C,data:w}=o.data;h.Toast(C),g==0&&me.Down(w.path+w.filename,w.filename),U("submit",g==0)})},_=()=>{U("update:show",!1)};return(m,o)=>(Y(),V(G,{show:a.value,"onUpdate:show":o[1]||(o[1]=g=>a.value=g),title:D.title||x(T).export,width:"360px",bottom:"40px",onClose:o[2]||(o[2]=g=>_())},{bottom:l(()=>[r(A,{height:"40px",padding:"0 32px",onClick:o[0]||(o[0]=g=>v())},{default:l(()=>[S(p(x(T).confirm),1)]),_:1})]),default:l(()=>[r(Q,{lineHeight:"60px"},{default:l(()=>[s("span",{innerHTML:x(T).export_warn(D.num)},null,8,Ue)]),_:1})]),_:1},8,["show","title"]))}}),Ye=["innerHTML"],Le={class:"app_action flex"},Be={class:"app_action_tools scrollbar"},Pe={key:0,class:"line"},He={class:"app_action_search flex"},Me={class:"custom_time flex_center"},Ne=["onClick"],Ie={class:"flex"},je={class:"app_ct"},Re={class:"tCenter"},Ve={class:"tCenter"},Fe={class:"tCenter"},Ke={class:"copy"},Oe=["onClick"],ze={class:"tCenter"},Ee={class:"tCenter"},qe={class:"tCenter"},Ge={class:"tCenter"},Qe={class:"app_page"},Ze=j({__name:"index",setup(D){const L=y(!1),k=y(),b=R().state,i=b.langs,T=he.isAction,a=y({show:!1,key:"",placeholder:"商品编码",time:[f.Date("Y/m/d",f.StrToTime("-1 year")),f.Date("Y/m/d")],maxDate:f.Date("Y/m/d"),customTime:{active:"",list:[{label:"近7天",value:"week"},{label:"近30天",value:"month"},{label:"近1年",value:"year"},{label:"近2年",value:"twoYear"}]},columns:[{label:"",value:"",slot:"customTime"},{label:i.select,value:"",slot:"time"},{label:"分类",value:"",slot:"category"},{label:"分仓",value:"",slot:"wms_co_id"},{label:"客服仓",value:"",slot:"service"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label1:i.goods_stock_num1,label2:i.goods_stock_num2,value:"",slot:"num"},{label:"采购员",value:"",name:"owner"}],wms_co_id:"",num1:"",num2:"",category:"",owner:""}),v=y({time:"",list:{stock:0}}),_=y({columns:[{title:"ID",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:i.date,index:"date",slot:"date",width:"90px",textAlign:"center"},{title:"商品分类",index:"category",order:"",slot:"category",width:"120px",textAlign:"center"},{title:i.goods_sku_id,index:"sku_id",order:"",slot:"sku_id",width:"150px",textAlign:"center"},{title:"库存",index:"num",slot:"num",order:"",textAlign:"center",width:"60px"},{title:"入库",slot:"in",width:"80px",textAlign:"center"},{title:"调拨",slot:"allocate",width:"80px",textAlign:"center"},{title:"发货",slot:"order",width:"80px",textAlign:"center"},{title:"售后",slot:"refund",width:"80px",textAlign:"center"},{title:"采退",slot:"out",width:"80px",textAlign:"center"},{title:i.action,slot:"action",textAlign:"center",width:"40px"},{title:i.view,slot:"view",textAlign:"center",width:"40px"},{title:"仓库ID",slot:"wms_co_id",width:"100px",textAlign:"center"},{title:"仓库名称",index:"wms_co_name"},{title:"采购员",index:"owner",order:""}],data:[],num:0,total:0,order:""}),m=y({total:0,num:1,limit:100}),o=y({show:!1,title:"添加/编辑",data:{}}),g=y({show:!1,title:"删除",data:[]}),C=y({show:!1,title:"导出",num:0}),w=y({label:"全部客服仓",value:"is_sku",checked:!1}),u=y({category:[],partner_name:[]});ve(()=>{b.token&&de()}),ce(()=>{L&&b.isLogin&&c()});const c=()=>{a.value.show=!1,_.value.data=[];const n=h.Loading();P.Post("erp_goods_stock/list?lang="+b.lang,{token:b.token,data:B(),page:m.value.num,limit:m.value.limit,order:_.value.order},t=>{n.clear();const{code:e,msg:d,data:$,time:H}=t.data;e==0?(v.value.time=H,_.value.data=$,W()):h.Toast(d)}),m.value.total=0,v.value.list.stock=0,P.Post("erp_goods_stock/total?lang="+b.lang,{token:b.token,data:B()},t=>{const{code:e,msg:d,data:$,time:H}=t.data;e==0?(v.value.time=H,m.value.total=$.total,v.value.list.stock=$.stock):h.Toast(d)})},B=()=>{const n={key:a.value.key,stime:typeof a.value.time[0]=="string"?a.value.time[0]:f.Date("Y/m/d",a.value.time[0]),etime:typeof a.value.time[1]=="string"?a.value.time[1]:f.Date("Y/m/d",a.value.time[1]),wms_co_id:a.value.wms_co_id,num1:a.value.num1,num2:a.value.num2,category:a.value.category,owner:a.value.owner,is_service:w.value.checked};for(let t of a.value.columns)t.name&&(n[t.name]=t.value);return n},F=(n,t)=>{_.value.num=n,_.value.total=t},ee=n=>{_.value.order=n,c()},te=()=>{a.value.time=[f.Date("Y/m/d",f.StrToTime("-1 year")),f.Date("Y/m/d")],a.value.customTime.active="",a.value.key="",a.value.wms_co_id="",a.value.num1="",a.value.num2="",a.value.category="",a.value.owner="";for(let n of a.value.columns)n.value="";_.value.order="",m.value.num=1,c()},W=()=>{Z(()=>{_.value.num=0,k.value.checkboxAll(!1)})},ae=n=>{switch(a.value.customTime.active=n,n){case"week":a.value.time=[f.Date("Y/m/d",f.StrToTime("-6 day")),f.Date("Y/m/d")];break;case"month":a.value.time=[f.Date("Y/m/d",f.StrToTime("-1 month")),f.Date("Y/m/d")];break;case"year":a.value.time=[f.Date("Y/m/d",f.StrToTime("-1 year")),f.Date("Y/m/d")];break;case"twoYear":a.value.time=[f.Date("Y/m/d",f.StrToTime("-2 year")),f.Date("Y/m/d")];break}},K=(n,t={})=>{if(o.value.show=!0,o.value.data={type:n},n=="add")o.value.title=i.add,o.value.data.wms_co_id="",o.value.data.sku_id="",o.value.data.num="";else if(n=="edit")o.value.title=i.edit+"( "+t.sku_id+" )",o.value.data.ids=[t.id],o.value.data.wms_co_id=[parseInt(t.wms_co_id)],o.value.data.sku_id=t.sku_id,o.value.data.num=t.num;else if(n=="edits"){const e=k.value.getData();let d=[],$=[],H=[];for(let O of e)d.push(O.id),$.push(O.sku_id),H.push(parseInt(O.wms_co_id));o.value.title=i.edits,o.value.data.ids=d,o.value.data.wms_co_id=H,o.value.data.sku_id=$.join(" "),o.value.data.num=""}},le=n=>{n&&(o.value.show=!1,c())},oe=()=>{g.value.show=!0;const n=k.value.getData();let t=[];for(let e of n)t.push(e.id);g.value.data=t},se=n=>{n&&(g.value.show=!1,c())},ne=n=>{C.value.show=!0,C.value.num=n},ie=n=>{n&&(C.value.show=!1,W())},ue=(n,t)=>{const e=k.value.getData();let d="";for(let $ in e)d+=e[$][n]+" ";d?X.CopyText(d):X.CopyText(t)},de=()=>{P.Post("erp_goods_stock/get_select?lang="+b.lang,{token:b.token},n=>{const{code:t,msg:e,data:d}=n.data;t==0?(u.value.category=d.category,u.value.partner_name=d.partner_name,L.value=!0):h.Toast(e)})};return(n,t)=>(Y(),N(J,null,[r(Te,{time:v.value.time,onRefresh:t[0]||(t[0]=e=>c())},{default:l(()=>[s("span",{innerHTML:x(i).goods_stock_total(v.value.list.stock)},null,8,Ye)]),_:1},8,["time"]),s("div",Le,[s("div",Be,[r(xe,{columns:[{action:"save",slot:"add",is_action:!0},{action:"save",slot:"edit",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0}]},{add:l(()=>[r(A,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:t[1]||(t[1]=e=>K("add"))},{default:l(()=>[S(p(x(i).add),1)]),_:1})]),edit:l(()=>[r(A,{effect:"plain",type:"primary",icon:"ui ui_edit",padding:"0 16px 0 8px",disabled:_.value.num==0,onClick:t[2]||(t[2]=e=>K("edits"))},{default:l(()=>[S(p(x(i).edit),1)]),_:1},8,["disabled"])]),del:l(()=>[r(A,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:_.value.num==0,onClick:t[3]||(t[3]=e=>oe())},{default:l(()=>[S(p(x(i).del)+"("+p(_.value.num)+")",1)]),_:1},8,["disabled"])]),line:l(()=>[x(T)("save")?(Y(),N("span",Pe,"|")):z("",!0)]),export:l(()=>[r(A,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!m.value.total,onClick:t[4]||(t[4]=e=>ne(m.value.total))},{default:l(()=>[S(p(x(i).export)+"("+p(m.value.total)+")",1)]),_:1},8,["disabled"])]),_:1})]),s("div",He,[r(ye,{show:a.value.show,"onUpdate:show":t[10]||(t[10]=e=>a.value.show=e),keys:a.value.key,"onUpdate:keys":t[11]||(t[11]=e=>a.value.key=e),columns:a.value.columns,placeholder:a.value.placeholder,onKeyup:t[12]||(t[12]=pe(e=>{m.value.num=1,c()},["enter"])),onSearch:t[13]||(t[13]=e=>{m.value.num=1,c()}),onReset:t[14]||(t[14]=e=>te())},{customTime:l(e=>[s("ul",Me,[(Y(!0),N(J,null,fe(a.value.customTime.list,d=>(Y(),N("li",{key:d.value,onClick:$=>ae(d.value),class:M({active:a.value.customTime.active===d.value})},p(d.label),11,Ne))),128))])]),time:l(e=>[r(ge,{value:a.value.time,"onUpdate:value":t[5]||(t[5]=d=>a.value.time=d),range:"",maxDate:a.value.maxDate,placeholder:e.label},null,8,["value","maxDate","placeholder"])]),category:l(e=>[r(E,{value:a.value.category,"onUpdate:value":t[6]||(t[6]=d=>a.value.category=d),options:u.value.category,placeholder:e.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),wms_co_id:l(e=>[r(E,{value:a.value.wms_co_id,"onUpdate:value":t[7]||(t[7]=d=>a.value.wms_co_id=d),options:u.value.partner_name,placeholder:e.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),service:l(()=>[r(_e,{options:w.value},null,8,["options"])]),num:l(e=>[s("div",Ie,[r(I,{value:a.value.num1,"onUpdate:value":t[8]||(t[8]=d=>a.value.num1=d),width:"49%",placeholder:e.label1},null,8,["value","placeholder"]),r(I,{value:a.value.num2,"onUpdate:value":t[9]||(t[9]=d=>a.value.num2=d),width:"49%",placeholder:e.label2},null,8,["value","placeholder"])])]),_:1},8,["show","keys","columns","placeholder"])])]),s("div",je,[r(we,{ref_key:"tableList",ref:k,overflow:"auto",columns:_.value.columns,options:_.value.data,onOrderBy:ee,onPartially:F},{id:l(e=>[s("div",Re,p(e.id),1)]),date:l(e=>[s("div",Ve,[r(ke,{title:"创建: "+e.ctime+`
更新: `+e.utime},{default:l(()=>[S(p(e.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),category:l(e=>[s("div",Fe,p(e.category||"-"),1)]),sku_id:l(e=>[s("div",Ke,[S(p(e.sku_id),1),s("span",{onClick:d=>ue("sku_id",e.sku_id)},"复",8,Oe)])]),num:l(e=>[s("div",ze,p(e.num),1)]),in:l(e=>[s("div",{class:M(["tCenter",e.in=="进行中"?"c_danger":"c_success"])},p(e.in),3)]),allocate:l(e=>[s("div",{class:M(["tCenter",e.allocate=="调拨中"?"c_danger":"c_success"])},p(e.allocate),3)]),order:l(e=>[s("div",{class:M(["tCenter",e.order=="进行中"?"c_danger":"c_success"])},p(e.order),3)]),refund:l(e=>[s("div",{class:M(["tCenter",e.refund=="进行中"?"c_danger":"c_success"])},p(e.refund),3)]),out:l(e=>[s("div",{class:M(["tCenter",e.out=="进行中"?"c_danger":"c_success"])},p(e.out),3)]),action:l(e=>[s("div",Ee,[x(T)("edit")?(Y(),V(A,{key:0,onClick:d=>K("edit",e)},{default:l(()=>[S(p(x(i).edit),1)]),_:2},1032,["onClick"])):z("",!0)])]),view:l(e=>[s("div",qe,[r(A,{type:"primary",effect:"text",padding:"0 4px",onClick:d=>{x(b).goods.show=!0,x(b).goods.sku_id=e.sku_id}},{default:l(()=>[S(p(x(i).goods_flow),1)]),_:2},1032,["onClick"])])]),wms_co_id:l(e=>[s("div",Ge,p(e.wms_co_id),1)]),_:1},8,["columns","options"])]),s("div",Qe,[r(be,{total:m.value.total,"onUpdate:total":t[15]||(t[15]=e=>m.value.total=e),page:m.value.num,"onUpdate:page":[t[16]||(t[16]=e=>m.value.num=e),t[17]||(t[17]=e=>c())],limit:m.value.limit,"onUpdate:limit":[t[18]||(t[18]=e=>m.value.limit=e),t[19]||(t[19]=e=>{m.value.num=1,c()})]},null,8,["total","page","limit"])]),r(De,{show:o.value.show,"onUpdate:show":t[20]||(t[20]=e=>o.value.show=e),title:o.value.title,data:o.value.data,onSubmit:t[21]||(t[21]=e=>le(e))},null,8,["show","title","data"]),r($e,{show:g.value.show,"onUpdate:show":t[22]||(t[22]=e=>g.value.show=e),data:g.value.data,onSubmit:t[23]||(t[23]=e=>se(e))},null,8,["show","data"]),r(Ae,{show:C.value.show,"onUpdate:show":t[24]||(t[24]=e=>C.value.show=e),data:B(),order:_.value.order,num:C.value.num,onSubmit:t[25]||(t[25]=e=>ie(e))},null,8,["show","data","order","num"])],64))}});export{Ze as default};
