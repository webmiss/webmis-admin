import{d as O,u as R,r as b,w as F,c as V,a as l,e as K,f as d,h as ce,n as I,B as W,i,j,k as z,l as $,t as w,b as x,m as A,U as h,R as B,o as P,G as Z,F as ee,T as _,y as we,z as fe,D as ge,E as _e,s as Q,K as xe,H as ke,v as be,x as N,I as ye,M as X}from"./index-BbMabsSy.js";import{c as J,w as he,a as Te,b as Ce,P as De}from"./Search-x-OIRsik.js";import{w as Se}from"./Total-DlGa2cZp.js";const $e={key:0},Ue=O({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(T,{emit:L}){const f=T,U=L,u=R().state,y=u.langs,a=b(!1),v=b({type:"",ids:[],wms_co_id:"",sku_id:"",num:"0",remark:""}),g=b({partner_name:[]});F(()=>f.show,s=>{a.value=s,s&&(v.value.type=f.data.type||"",v.value.ids=f.data.ids||[],v.value.sku_id=f.data.sku_id||"",v.value.num=f.data.num,r())},{deep:!0});const r=()=>{B.Post("erp_goods_stock/get_select?lang="+u.lang,{token:u.token},s=>{const{code:p,msg:k,data:S}=s.data;p==0?(g.value.partner_name=S.partner_name,Z(()=>{v.value.wms_co_id=f.data.wms_co_id||[]})):h.Toast(k)})},o=s=>s.type=="add"&&s.wms_co_id.length==0?h.Toast("请选择分仓"):s.sku_id?isNaN(s.num)||s.num<0?h.Toast("请输入库存"):s:h.Toast("请输入商品编码"),c=()=>{const s=o(v.value);if(!s)return;const p=h.Loading();B.Post("erp_goods_stock/save?lang="+u.lang,{token:u.token,data:s},k=>{p.clear();const{code:S,msg:H}=k.data;h.Toast(H),U("submit",S==0)})},D=()=>{U("update:show",!1)};return(s,p)=>(P(),V(K,{show:a.value,"onUpdate:show":p[5]||(p[5]=k=>a.value=k),title:T.title,width:"640px",bottom:"40px",onClose:p[6]||(p[6]=k=>D())},{bottom:l(()=>[d(A,{height:"40px",padding:"0 32px",onClick:p[4]||(p[4]=k=>c())},{default:l(()=>[$(w(x(y).confirm),1)]),_:1})]),default:l(()=>[d(z,null,{default:l(()=>[d(ce,null,{default:l(()=>[v.value.type=="add"?(P(),I("tr",$e,[p[7]||(p[7]=i("td",{class:"label"},"分仓",-1)),i("td",null,[d(J,{value:v.value.wms_co_id,"onUpdate:value":p[0]||(p[0]=k=>v.value.wms_co_id=k),options:g.value.partner_name},null,8,["value","options"])])])):W("",!0),i("tr",null,[p[8]||(p[8]=i("td",{class:"label"},"商品编码",-1)),i("td",null,[d(j,{value:v.value.sku_id,"onUpdate:value":p[1]||(p[1]=k=>v.value.sku_id=k),placeholder:"商品编码, 多条空格分离",type:"textarea",height:"160px",disabled:v.value.type!="add"},null,8,["value","disabled"])])]),i("tr",null,[p[9]||(p[9]=i("td",{class:"label"},"库存",-1)),i("td",null,[d(j,{value:v.value.num,"onUpdate:value":p[2]||(p[2]=k=>v.value.num=k),placeholder:"库存数量"},null,8,["value"])])]),i("tr",null,[p[10]||(p[10]=i("td",{class:"label"},"备注",-1)),i("td",null,[d(j,{value:v.value.remark,"onUpdate:value":p[3]||(p[3]=k=>v.value.remark=k),placeholder:"日志备注"},null,8,["value"])])])]),_:1})]),_:1})]),_:1},8,["show","title"]))}}),Ae=["innerHTML"],Le=O({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(T,{emit:L}){const f=T,U=L,u=R().state,y=u.langs,a=b(!1);F(()=>f.show,r=>{a.value=r},{deep:!0});const v=()=>{const r=h.Loading();B.Post("erp_goods_stock/del?lang="+u.lang,{token:u.token,data:f.data},o=>{r.clear();const{code:c,msg:D}=o.data;h.Toast(D),U("submit",c==0)})},g=()=>{U("update:show",!1)};return(r,o)=>(P(),V(K,{show:a.value,"onUpdate:show":o[1]||(o[1]=c=>a.value=c),title:T.title||x(y).del,width:"360px",bottom:"40px",onClose:o[2]||(o[2]=c=>g())},{bottom:l(()=>[d(A,{effect:"dark",type:"danger",height:"40px",onClick:o[0]||(o[0]=c=>v())},{default:l(()=>[$(w(x(y).confirm),1)]),_:1})]),default:l(()=>[d(z,{lineHeight:"60px"},{default:l(()=>[i("span",{innerHTML:x(y).del_warn(T.data.length)},null,8,Ae)]),_:1})]),_:1},8,["show","title"]))}}),Ye=["innerHTML"],Pe=O({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(T,{emit:L}){const f=T,U=L,u=R().state,y=u.langs,a=b(!1);F(()=>f.show,r=>{a.value=r},{deep:!0});const v=()=>{const r=h.Loading();B.Post("erp_goods_stock/export?lang="+u.lang,{token:u.token,data:f.data,order:f.order},o=>{r.clear();const{code:c,msg:D,data:s}=o.data;h.Toast(D),c==0&&ee.Down(s.path+s.filename,s.filename),U("submit",c==0)})},g=()=>{U("update:show",!1)};return(r,o)=>(P(),V(K,{show:a.value,"onUpdate:show":o[1]||(o[1]=c=>a.value=c),title:T.title||x(y).export,width:"360px",bottom:"40px",onClose:o[2]||(o[2]=c=>g())},{bottom:l(()=>[d(A,{height:"40px",padding:"0 32px",onClick:o[0]||(o[0]=c=>v())},{default:l(()=>[$(w(x(y).confirm),1)]),_:1})]),default:l(()=>[d(z,{lineHeight:"60px"},{default:l(()=>[i("span",{innerHTML:x(y).export_warn(T.num)},null,8,Ye)]),_:1})]),_:1},8,["show","title"]))}}),Be=["innerHTML"],He=O({__name:"export_part",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(T,{emit:L}){const f=T,U=L,u=R().state,y=u.langs,a=b(!1);F(()=>f.show,r=>{a.value=r},{deep:!0});const v=()=>{const r=h.Loading();B.Post("erp_goods_stock/export?lang="+u.lang,{token:u.token,data:f.data,order:f.order},o=>{r.clear();const{code:c,msg:D,data:s}=o.data;h.Toast(D),c==0&&ee.Down(s.path+s.filename,s.filename),U("submit",c==0)})},g=()=>{U("update:show",!1)};return(r,o)=>(P(),V(K,{show:a.value,"onUpdate:show":o[1]||(o[1]=c=>a.value=c),title:T.title||x(y).export,width:"360px",bottom:"40px",onClose:o[2]||(o[2]=c=>g())},{bottom:l(()=>[d(A,{height:"40px",padding:"0 32px",onClick:o[0]||(o[0]=c=>v())},{default:l(()=>[$(w(x(y).confirm),1)]),_:1})]),default:l(()=>[d(z,{lineHeight:"60px"},{default:l(()=>[i("span",{innerHTML:x(y).export_warn(T.num)},null,8,Be)]),_:1})]),_:1},8,["show","title"]))}}),Me=["innerHTML"],Ne={class:"app_action flex"},Ie={class:"app_action_tools scrollbar"},je={key:0,class:"line"},Oe={class:"app_action_search flex"},Re={class:"custom_time flex_center"},Ve=["onClick"],Fe={class:"flex"},Ke={class:"app_ct"},ze={class:"tCenter"},Ee={class:"tCenter"},qe={class:"tCenter"},Ge={class:"copy"},We=["onClick"],Je={class:"tCenter"},Qe={class:"tCenter"},Xe={class:"tCenter"},Ze={class:"tCenter"},et={class:"app_page"},ot=O({__name:"index",setup(T){const L=b(!1),f=b(),C=R().state,u=C.langs,y=De.isAction,a=b({show:!1,key:"",placeholder:"商品编码",time:[_.Date("Y/m/d",_.StrToTime("-1 year")),_.Date("Y/m/d")],maxDate:_.Date("Y/m/d"),customTime:{active:"",list:[{label:"近7天",value:"week"},{label:"近30天",value:"month"},{label:"近1年",value:"year"},{label:"近2年",value:"twoYear"}]},columns:[{label:"",value:"",slot:"customTime"},{label:u.select,value:"",slot:"time"},{label:"分类",value:"",slot:"category"},{label:"分仓",value:"",slot:"wms_co_id"},{label:"客服仓",value:"",slot:"service"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label1:u.goods_stock_num1,label2:u.goods_stock_num2,value:"",slot:"num"},{label:"采购员",value:"",name:"owner"}],wms_co_id:"",num1:"",num2:"",category:"",owner:""}),v=b({time:"",list:{stock:0}}),g=b({columns:[{title:"ID",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:u.date,index:"date",slot:"date",width:"90px",textAlign:"center"},{title:"商品分类",index:"category",order:"",slot:"category",width:"120px",textAlign:"center"},{title:u.goods_sku_id,index:"sku_id",order:"",slot:"sku_id",width:"150px",textAlign:"center"},{title:"库存",index:"num",slot:"num",order:"",textAlign:"center",width:"60px"},{title:"入库",slot:"in",width:"80px",textAlign:"center"},{title:"调拨",slot:"allocate",width:"80px",textAlign:"center"},{title:"发货",slot:"order",width:"80px",textAlign:"center"},{title:"售后",slot:"refund",width:"80px",textAlign:"center"},{title:"采退",slot:"out",width:"80px",textAlign:"center"},{title:u.action,slot:"action",textAlign:"center",width:"40px"},{title:u.view,slot:"view",textAlign:"center",width:"40px"},{title:"仓库ID",slot:"wms_co_id",width:"100px",textAlign:"center"},{title:"仓库名称",index:"wms_co_name"},{title:"采购员",index:"owner",order:""}],data:[],num:0,total:0,order:""}),r=b({total:0,num:1,limit:100}),o=b({show:!1,title:"添加/编辑",data:{}}),c=b({show:!1,title:"删除",data:[]}),D=b({show:!1,title:"导出",num:0}),s=b({show:!1,title:"导出选择",num:0,data:[],ids:[]}),p=b({label:"全部客服仓",value:"is_sku",checked:!1}),k=b({category:[],partner_name:[]});we(()=>{C.token&&pe()}),fe(()=>{L&&C.isLogin&&S()});const S=()=>{a.value.show=!1,g.value.data=[];const n=h.Loading();B.Post("erp_goods_stock/list?lang="+C.lang,{token:C.token,data:H(),page:r.value.num,limit:r.value.limit,order:g.value.order},t=>{n.clear();const{code:e,msg:m,data:Y,time:M}=t.data;e==0?(v.value.time=M,g.value.data=Y,E()):h.Toast(m)}),r.value.total=0,v.value.list.stock=0,B.Post("erp_goods_stock/total?lang="+C.lang,{token:C.token,data:H()},t=>{const{code:e,msg:m,data:Y,time:M}=t.data;e==0?(v.value.time=M,r.value.total=Y.total,v.value.list.stock=Y.stock):h.Toast(m)})},H=()=>{const n={key:a.value.key,stime:typeof a.value.time[0]=="string"?a.value.time[0]:_.Date("Y/m/d",a.value.time[0]),etime:typeof a.value.time[1]=="string"?a.value.time[1]:_.Date("Y/m/d",a.value.time[1]),wms_co_id:a.value.wms_co_id,num1:a.value.num1,num2:a.value.num2,category:a.value.category,owner:a.value.owner,is_service:p.value.checked};for(let t of a.value.columns)t.name&&(n[t.name]=t.value);return n},te=(n,t)=>{g.value.num=n,g.value.total=t,s.value.ids=[],s.value.num=n;const e=f.value.getData();for(let m of e)s.value.ids.push(m.id)},ae=n=>{g.value.order=n,S()},le=()=>{a.value.time=[_.Date("Y/m/d",_.StrToTime("-1 year")),_.Date("Y/m/d")],a.value.customTime.active="",a.value.key="",a.value.wms_co_id="",a.value.num1="",a.value.num2="",a.value.category="",a.value.owner="";for(let n of a.value.columns)n.value="";g.value.order="",r.value.num=1,S()},E=()=>{Z(()=>{g.value.num=0,f.value.checkboxAll(!1)})},oe=n=>{switch(a.value.customTime.active=n,n){case"week":a.value.time=[_.Date("Y/m/d",_.StrToTime("-6 day")),_.Date("Y/m/d")];break;case"month":a.value.time=[_.Date("Y/m/d",_.StrToTime("-1 month")),_.Date("Y/m/d")];break;case"year":a.value.time=[_.Date("Y/m/d",_.StrToTime("-1 year")),_.Date("Y/m/d")];break;case"twoYear":a.value.time=[_.Date("Y/m/d",_.StrToTime("-2 year")),_.Date("Y/m/d")];break}},q=(n,t={})=>{if(o.value.show=!0,o.value.data={type:n},n=="add")o.value.title=u.add,o.value.data.wms_co_id="",o.value.data.sku_id="",o.value.data.num="";else if(n=="edit")o.value.title=u.edit+"( "+t.sku_id+" )",o.value.data.ids=[t.id],o.value.data.wms_co_id=[parseInt(t.wms_co_id)],o.value.data.sku_id=t.sku_id,o.value.data.num=t.num;else if(n=="edits"){const e=f.value.getData();let m=[],Y=[],M=[];for(let G of e)m.push(G.id),Y.push(G.sku_id),M.push(parseInt(G.wms_co_id));o.value.title=u.edits,o.value.data.ids=m,o.value.data.wms_co_id=M,o.value.data.sku_id=Y.join(" "),o.value.data.num=""}},se=n=>{n&&(o.value.show=!1,S())},ne=()=>{c.value.show=!0;const n=f.value.getData();let t=[];for(let e of n)t.push(e.id);c.value.data=t},ie=n=>{n&&(c.value.show=!1,S())},ue=n=>{D.value.show=!0,D.value.num=n},de=n=>{n&&(D.value.show=!1,E())},re=()=>{s.value.show=!0,s.value.data=H(),s.value.data.ids=s.value.ids},me=n=>{n&&(s.value.show=!1,E())},ve=(n,t)=>{const e=f.value.getData();let m="";for(let Y in e)m+=e[Y][n]+" ";m?X.CopyText(m):X.CopyText(t)},pe=()=>{B.Post("erp_goods_stock/get_select?lang="+C.lang,{token:C.token},n=>{const{code:t,msg:e,data:m}=n.data;t==0?(k.value.category=m.category,k.value.partner_name=m.partner_name,L.value=!0):h.Toast(e)})};return(n,t)=>(P(),I(Q,null,[d(Se,{time:v.value.time,onRefresh:t[0]||(t[0]=e=>S())},{default:l(()=>[i("span",{innerHTML:x(u).goods_stock_total(v.value.list.stock)},null,8,Me)]),_:1},8,["time"]),i("div",Ne,[i("div",Ie,[d(he,{columns:[{action:"save",slot:"add",is_action:!0},{action:"save",slot:"edit",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0},{action:"export",slot:"export_part",is_action:!0}]},{add:l(()=>[d(A,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:t[1]||(t[1]=e=>q("add"))},{default:l(()=>[$(w(x(u).add),1)]),_:1})]),edit:l(()=>[d(A,{effect:"plain",type:"primary",icon:"ui ui_edit",padding:"0 16px 0 8px",disabled:g.value.num==0,onClick:t[2]||(t[2]=e=>q("edits"))},{default:l(()=>[$(w(x(u).edit),1)]),_:1},8,["disabled"])]),del:l(()=>[d(A,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:g.value.num==0,onClick:t[3]||(t[3]=e=>ne())},{default:l(()=>[$(w(x(u).del)+"("+w(g.value.num)+")",1)]),_:1},8,["disabled"])]),line:l(()=>[x(y)("save")?(P(),I("span",je,"|")):W("",!0)]),export:l(()=>[d(A,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!r.value.total,onClick:t[4]||(t[4]=e=>ue(r.value.total))},{default:l(()=>[$(w(x(u).export)+"("+w(r.value.total)+")",1)]),_:1},8,["disabled"])]),export_part:l(()=>[d(A,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:s.value.num==0,onClick:t[5]||(t[5]=e=>re())},{default:l(()=>[$("导出选择("+w(s.value.num)+")",1)]),_:1},8,["disabled"])]),_:1})]),i("div",Oe,[d(Te,{show:a.value.show,"onUpdate:show":t[11]||(t[11]=e=>a.value.show=e),keys:a.value.key,"onUpdate:keys":t[12]||(t[12]=e=>a.value.key=e),columns:a.value.columns,placeholder:a.value.placeholder,onKeyup:t[13]||(t[13]=ge(e=>{r.value.num=1,S()},["enter"])),onSearch:t[14]||(t[14]=e=>{r.value.num=1,S()}),onReset:t[15]||(t[15]=e=>le())},{customTime:l(e=>[i("ul",Re,[(P(!0),I(Q,null,be(a.value.customTime.list,m=>(P(),I("li",{key:m.value,onClick:Y=>oe(m.value),class:N({active:a.value.customTime.active===m.value})},w(m.label),11,Ve))),128))])]),time:l(e=>[d(ke,{value:a.value.time,"onUpdate:value":t[6]||(t[6]=m=>a.value.time=m),range:"",maxDate:a.value.maxDate,placeholder:e.label},null,8,["value","maxDate","placeholder"])]),category:l(e=>[d(J,{value:a.value.category,"onUpdate:value":t[7]||(t[7]=m=>a.value.category=m),options:k.value.category,placeholder:e.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),wms_co_id:l(e=>[d(J,{value:a.value.wms_co_id,"onUpdate:value":t[8]||(t[8]=m=>a.value.wms_co_id=m),options:k.value.partner_name,placeholder:e.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),service:l(()=>[d(xe,{options:p.value},null,8,["options"])]),num:l(e=>[i("div",Fe,[d(j,{value:a.value.num1,"onUpdate:value":t[9]||(t[9]=m=>a.value.num1=m),width:"49%",placeholder:e.label1},null,8,["value","placeholder"]),d(j,{value:a.value.num2,"onUpdate:value":t[10]||(t[10]=m=>a.value.num2=m),width:"49%",placeholder:e.label2},null,8,["value","placeholder"])])]),_:1},8,["show","keys","columns","placeholder"])])]),i("div",Ke,[d(_e,{ref_key:"tableList",ref:f,overflow:"auto",columns:g.value.columns,options:g.value.data,onOrderBy:ae,onPartially:te},{id:l(e=>[i("div",ze,w(e.id),1)]),date:l(e=>[i("div",Ee,[d(ye,{title:"创建: "+e.ctime+`
更新: `+e.utime},{default:l(()=>[$(w(e.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),category:l(e=>[i("div",qe,w(e.category||"-"),1)]),sku_id:l(e=>[i("div",Ge,[$(w(e.sku_id),1),i("span",{onClick:m=>ve("sku_id",e.sku_id)},"复",8,We)])]),num:l(e=>[i("div",Je,w(e.num),1)]),in:l(e=>[i("div",{class:N(["tCenter",e.in=="进行中"?"c_danger":"c_success"])},w(e.in),3)]),allocate:l(e=>[i("div",{class:N(["tCenter",e.allocate=="调拨中"?"c_danger":"c_success"])},w(e.allocate),3)]),order:l(e=>[i("div",{class:N(["tCenter",e.order=="进行中"?"c_danger":"c_success"])},w(e.order),3)]),refund:l(e=>[i("div",{class:N(["tCenter",e.refund=="进行中"?"c_danger":"c_success"])},w(e.refund),3)]),out:l(e=>[i("div",{class:N(["tCenter",e.out=="进行中"?"c_danger":"c_success"])},w(e.out),3)]),action:l(e=>[i("div",Qe,[x(y)("save")?(P(),V(A,{key:0,onClick:m=>q("edit",e)},{default:l(()=>[$(w(x(u).edit),1)]),_:2},1032,["onClick"])):W("",!0)])]),view:l(e=>[i("div",Xe,[d(A,{type:"primary",effect:"text",padding:"0 4px",onClick:m=>{x(C).goods.show=!0,x(C).goods.sku_id=e.sku_id}},{default:l(()=>[$(w(x(u).flow),1)]),_:2},1032,["onClick"])])]),wms_co_id:l(e=>[i("div",Ze,w(e.wms_co_id),1)]),_:1},8,["columns","options"])]),i("div",et,[d(Ce,{total:r.value.total,"onUpdate:total":t[16]||(t[16]=e=>r.value.total=e),page:r.value.num,"onUpdate:page":[t[17]||(t[17]=e=>r.value.num=e),t[18]||(t[18]=e=>S())],limit:r.value.limit,"onUpdate:limit":[t[19]||(t[19]=e=>r.value.limit=e),t[20]||(t[20]=e=>{r.value.num=1,S()})]},null,8,["total","page","limit"])]),d(Ue,{show:o.value.show,"onUpdate:show":t[21]||(t[21]=e=>o.value.show=e),title:o.value.title,data:o.value.data,onSubmit:t[22]||(t[22]=e=>se(e))},null,8,["show","title","data"]),d(Le,{show:c.value.show,"onUpdate:show":t[23]||(t[23]=e=>c.value.show=e),data:c.value.data,onSubmit:t[24]||(t[24]=e=>ie(e))},null,8,["show","data"]),d(Pe,{show:D.value.show,"onUpdate:show":t[25]||(t[25]=e=>D.value.show=e),data:H(),order:g.value.order,num:D.value.num,onSubmit:t[26]||(t[26]=e=>de(e))},null,8,["show","data","order","num"]),d(He,{show:s.value.show,"onUpdate:show":t[27]||(t[27]=e=>s.value.show=e),data:s.value.data,num:s.value.num,onSubmit:t[28]||(t[28]=e=>me(e))},null,8,["show","data","num"])],64))}});export{ot as default};
