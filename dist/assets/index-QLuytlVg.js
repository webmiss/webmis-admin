import{d as I,u as N,r as x,w as O,c as R,a as o,e as V,f as d,h as X,i as p,t as k,b,j as z,k as K,l as L,m as D,U as $,R as B,o as A,_ as Y,F as Z,y as tt,z as et,n as E,C as at,s as st,D as ot}from"./index-DI8kgclA.js";import{w as lt,a as nt,b as it,c as ut,d as dt,e as rt,P as mt}from"./index-C3we3Lg-.js";import{w as pt}from"./index-C1vxZM1c.js";import{w as vt}from"./Total-BDYrfxeP.js";import{w as ft}from"./index-U_mQ8lNR.js";const wt={class:"label"},ct={colspan:"3"},gt={class:"label"},xt={class:"label"},bt={colspan:"3"},kt=I({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(y,{emit:T}){const v=y,S=T,l=N().state,w=l.langs,r=x(!1),_=x("base"),f=x([{label:w.info,value:"base",slot:"base"},{label:w.sys_role_perm,value:"perm",slot:"perm"}]),a=x({id:0,status:!0,name:"",remark:"",perm:""}),s=x({perm:[]});O(()=>v.show,g=>{r.value=g,g&&(a.value.id=v.data.id||0,a.value.name=v.data.name||"",a.value.status=typeof v.data.status<"u"?v.data.status:!0,a.value.remark=v.data.remark||"",a.value.perm=v.data.perm||"",m())},{deep:!0});const m=()=>{B.Post("sys_role/get_perm?lang="+l.lang,{token:l.token,perm:a.value.perm},g=>{const{code:n,data:i}=g.data;n==0&&(s.value.perm=i)})},h=g=>{let n={},i=[];for(let C of g)i=C.split(":"),n[i[0]]?n[i[0]]+=parseInt(i[1]):n[i[0]]=parseInt(i[1]);let P="";for(let C in n)P+=C+":"+n[C].toString()+" ";a.value.perm=P.trim()},c=g=>g.name.length<2||g.name.length>16?$.Toast(w.sys_role_verify_name):g,H=()=>{const g=c(a.value);if(!g)return;const n=$.Loading();B.Post("sys_role/save?lang="+l.lang,{token:l.token,data:g},i=>{n.clear();const{code:P,msg:C,data:q}=i.data;$.Toast(C),S("submit",P==0)})},W=()=>{S("update:show",!1)};return(g,n)=>(A(),R(V,{show:r.value,"onUpdate:show":n[5]||(n[5]=i=>r.value=i),title:y.title,width:"640px",bottom:"40px",overflow:_.value=="perm"?"hidden auto":"hidden",onClose:n[6]||(n[6]=i=>W())},{bottom:o(()=>[d(D,{height:"40px",padding:"0 32px",onClick:n[4]||(n[4]=i=>H())},{default:o(()=>[L(k(b(w).confirm),1)]),_:1})]),default:o(()=>[d(K,{paddingY:"0"},{default:o(()=>[d(lt,{value:_.value,"onUpdate:value":n[3]||(n[3]=i=>_.value=i),columns:f.value},{base:o(()=>[d(X,null,{default:o(()=>[p("tr",null,[p("td",wt,k(b(w).status),1),p("td",ct,[d(nt,{value:a.value.status,"onUpdate:value":n[0]||(n[0]=i=>a.value.status=i)},null,8,["value"])])]),p("tr",null,[p("td",gt,k(b(w).name),1),p("td",null,[d(z,{value:a.value.name,"onUpdate:value":n[1]||(n[1]=i=>a.value.name=i),maxlength:"16"},null,8,["value"])])]),p("tr",null,[p("td",xt,k(b(w).remark),1),p("td",bt,[d(z,{value:a.value.remark,"onUpdate:value":n[2]||(n[2]=i=>a.value.remark=i),type:"textarea",height:"80px",maxlength:"32"},null,8,["value"])])])]),_:1})]),perm:o(()=>[d(ft,{"onUpdate:value":h,options:s.value.perm},null,8,["options"])]),_:1},8,["value","columns"])]),_:1})]),_:1},8,["show","title","overflow"]))}}),ht=Y(kt,[["__scopeId","data-v-db1a9419"]]),yt=["innerHTML"],_t=I({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(y,{emit:T}){const v=y,S=T,l=N().state,w=l.langs,r=x(!1);O(()=>v.show,a=>{r.value=a},{deep:!0});const _=()=>{const a=$.Loading();B.Post("sys_role/del?lang="+l.lang,{token:l.token,data:v.data},s=>{a.clear();const{code:m,msg:h}=s.data;$.Toast(h),S("submit",m==0)})},f=()=>{S("update:show",!1)};return(a,s)=>(A(),R(V,{show:r.value,"onUpdate:show":s[1]||(s[1]=m=>r.value=m),title:y.title||b(w).del,width:"360px",bottom:"40px",onClose:s[2]||(s[2]=m=>f())},{bottom:o(()=>[d(D,{effect:"dark",type:"danger",height:"40px",onClick:s[0]||(s[0]=m=>_())},{default:o(()=>[L(k(b(w).confirm),1)]),_:1})]),default:o(()=>[d(K,{lineHeight:"60px"},{default:o(()=>[p("span",{innerHTML:b(w).del_warn(y.data.length)},null,8,yt)]),_:1})]),_:1},8,["show","title"]))}}),$t=["innerHTML"],St=I({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(y,{emit:T}){const v=y,S=T,l=N().state,w=l.langs,r=x(!1);O(()=>v.show,a=>{r.value=a},{deep:!0});const _=()=>{const a=$.Loading();B.Post("sys_role/export?lang="+l.lang,{token:l.token,data:v.data,order:v.order},s=>{a.clear();const{code:m,msg:h,data:c}=s.data;$.Toast(h),m==0&&Z.Down(c.path+c.filename,c.filename),S("submit",m==0)})},f=()=>{S("update:show",!1)};return(a,s)=>(A(),R(V,{show:r.value,"onUpdate:show":s[1]||(s[1]=m=>r.value=m),title:y.title||b(w).export,width:"360px",bottom:"40px",onClose:s[2]||(s[2]=m=>f())},{bottom:o(()=>[d(D,{height:"40px",padding:"0 32px",onClick:s[0]||(s[0]=m=>_())},{default:o(()=>[L(k(b(w).confirm),1)]),_:1})]),default:o(()=>[d(K,{lineHeight:"60px"},{default:o(()=>[p("span",{innerHTML:b(w).export_warn(y.num)},null,8,$t)]),_:1})]),_:1},8,["show","title"]))}}),Tt=["innerHTML"],Ut={class:"app_action flex"},Ct={class:"app_action_tools scrollbar"},Lt={class:"app_action_search flex"},Pt={class:"app_ct"},Dt={class:"tCenter"},At={class:"tCenter"},Bt={key:1},Ht={class:"tCenter"},Mt={class:"app_page"},It=I({__name:"index",setup(y){const T=x(!1),v=x(),U=N().state,l=U.langs,w=mt.isAction,r=x({show:!1,key:"",placeholder:"名称、备注",columns:[{label:l.name,value:"",name:"name"},{label:l.remark,value:"",name:"remark"}]}),_=x({time:"",list:{}}),f=x({columns:[{title:"ID",index:"id",slot:"id",order:"",width:"80px",minWidth:"60px",textAlign:"center"},{title:l.name,index:"name",order:"",width:"120px",minWidth:"80px"},{title:l.sys_role_perm,slot:"perm",width:"90px",textAlign:"center"},{title:l.date,index:"date",slot:"date",width:"120px",minWidth:"110px",textAlign:"center"},{title:l.remark,index:"remark"}],data:[],num:0,total:0,order:""}),a=x({total:0,num:1,limit:100}),s=x({show:!1,type:"",title:"添加/编辑",data:{}}),m=x({show:!1,title:"删除",data:[]}),h=x({show:!1,title:"导出",num:0});tt(()=>{T.value=!0}),et(()=>{T&&c()});const c=()=>{r.value.show=!1,f.value.data=[];const u=$.Loading();B.Post("sys_role/list?lang="+U.lang,{token:U.token,data:H(),page:a.value.num,limit:a.value.limit,order:f.value.order},t=>{u.clear();const{code:e,msg:M,time:j,data:F}=t.data;e===0?(_.value.time=j,f.value.data=F,i()):$.Toast(M)}),a.value.total=0,B.Post("sys_role/total?lang="+U.lang,{token:U.token,data:H()},t=>{const{code:e,msg:M,time:j,data:F}=t.data;e==0?(_.value.time=j,a.value.total=F.total):$.Toast(M)})},H=()=>{const u={key:r.value.key};for(let t of r.value.columns)t.name&&(u[t.name]=t.value);return u},W=(u,t)=>{f.value.num=u,f.value.total=t},g=u=>{f.value.order=u,c()},n=()=>{r.value.key="";for(let u of r.value.columns)u.value="";f.value.order="",a.value.num=1,c()},i=()=>{ot(()=>{v.value.checkboxAll(!1)})},P=(u,t)=>{s.value.show=!0,s.value.type=u,u=="add"?(s.value.title=l.add,s.value.data={}):u=="edit"&&(s.value.title=l.edit+"( "+t.name+" )",s.value.data=t)},C=u=>{u&&(s.value.show=!1,c())},q=()=>{m.value.show=!0;const u=v.value.getData();let t=[];for(let e of u)t.push(e.id);m.value.data=t},G=u=>{u&&(m.value.show=!1,c())},J=u=>{h.value.show=!0,h.value.num=u},Q=u=>{u&&(h.value.show=!1,i())};return(u,t)=>(A(),E(st,null,[d(vt,{time:_.value.time,onRefresh:t[0]||(t[0]=e=>c())},{default:o(()=>[p("span",{innerHTML:b(l).sys_role_total(a.value.total)},null,8,Tt)]),_:1},8,["time"]),p("div",Ut,[p("div",Ct,[d(it,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0}]},{add:o(()=>[d(D,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:t[1]||(t[1]=e=>P("add"))},{default:o(()=>[L(k(b(l).add),1)]),_:1})]),del:o(()=>[d(D,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:f.value.num==0,onClick:t[2]||(t[2]=e=>q())},{default:o(()=>[L(k(b(l).del)+"("+k(f.value.num)+")",1)]),_:1},8,["disabled"])]),line:o(()=>t[20]||(t[20]=[p("span",{class:"line"},"|",-1)])),export:o(()=>[d(D,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!a.value.total,onClick:t[3]||(t[3]=e=>J(a.value.total))},{default:o(()=>[L(k(b(l).export)+"("+k(a.value.total)+")",1)]),_:1},8,["disabled"])]),_:1})]),p("div",Lt,[d(ut,{show:r.value.show,"onUpdate:show":t[4]||(t[4]=e=>r.value.show=e),keys:r.value.key,"onUpdate:keys":t[5]||(t[5]=e=>r.value.key=e),columns:r.value.columns,onKeyup:t[6]||(t[6]=at(e=>c(),["enter"])),onSearch:t[7]||(t[7]=e=>c()),onReset:t[8]||(t[8]=e=>n())},null,8,["show","keys","columns"])])]),p("div",Pt,[d(dt,{ref_key:"tableList",ref:v,overflow:"auto",columns:f.value.columns,options:f.value.data,onOrderBy:g,onPartially:W},{id:o(e=>[p("div",Dt,k(e.id),1)]),perm:o(e=>[p("div",At,[b(w)("save")?(A(),R(D,{key:0,onClick:M=>P("edit",e)},{default:o(()=>[L(k(b(l).edit),1)]),_:2},1032,["onClick"])):(A(),E("span",Bt,"-"))])]),date:o(e=>[p("div",Ht,[d(pt,{title:"创建: "+e.ctime+`
更新: `+e.utime},{default:o(()=>[L(k(e.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),_:1},8,["columns","options"])]),p("div",Mt,[d(rt,{total:a.value.total,"onUpdate:total":t[9]||(t[9]=e=>a.value.total=e),page:a.value.num,"onUpdate:page":[t[10]||(t[10]=e=>a.value.num=e),t[11]||(t[11]=e=>c())],limit:a.value.limit,"onUpdate:limit":[t[12]||(t[12]=e=>a.value.limit=e),t[13]||(t[13]=e=>{a.value.num=1,c()})]},null,8,["total","page","limit"])]),d(ht,{show:s.value.show,"onUpdate:show":t[14]||(t[14]=e=>s.value.show=e),title:s.value.title,data:s.value.data,onSubmit:t[15]||(t[15]=e=>C(e))},null,8,["show","title","data"]),d(_t,{show:m.value.show,"onUpdate:show":t[16]||(t[16]=e=>m.value.show=e),data:m.value.data,onSubmit:t[17]||(t[17]=e=>G(e))},null,8,["show","data"]),d(St,{show:h.value.show,"onUpdate:show":t[18]||(t[18]=e=>h.value.show=e),data:H(),order:f.value.order,num:h.value.num,onSubmit:t[19]||(t[19]=e=>Q(e))},null,8,["show","data","order","num"])],64))}}),Ot=Y(It,[["__scopeId","data-v-7f7befd8"]]);export{Ot as default};
