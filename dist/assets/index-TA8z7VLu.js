import{d as ae,u as oe,r as L,w as re,c as Z,a as t,e as ee,f as p,h as Pe,i as s,K as me,j as _e,k as te,l as g,t as i,b as w,m as H,U as y,R as E,o as v,G as xe,F as ye,n as f,s as q,E as he,D as ke,N as se,O as Ie,P as Be,A as Te,B as le,M as $e,x as Se,v as be,L as Ye,_ as Ce,I as Ue,T as V,y as He,z as Re,H as Me}from"./index-De4U6Qew.js";import{P as De,w as Ne,a as Fe,b as je}from"./Search-BRk08DvK.js";import{w as Ve}from"./Total-DFmTiaob.js";import{P as Ee}from"./PrintGoods-mR7h0T7F.js";import{w as Le}from"./index-DtELT80z.js";import{w as We}from"./index-DCH2wagm.js";import"./index-BSUatmH-.js";const Oe=ae({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1),u=L({tp:"",id:"",type:"",wms_co_id:"",brand:"",remark:""}),k=L({type_name:[],partner_name:[],brand_name:[]});re(()=>$.show,A=>{U.value=A,A&&(u.value.tp=$.data.tp||"",u.value.id=$.data.id||"",u.value.remark=$.data.remark||"",W())},{deep:!0});const W=()=>{E.Post("erp_purchase_out/get_select?lang="+S.lang,{token:S.token},A=>{const{code:b,msg:B,data:R}=A.data;b==0?(k.value.type_name=R.type_name,k.value.partner_name=R.partner_name,k.value.brand_name=R.brand_name,$.data.tp=="edit"&&xe(()=>{u.value.type=[parseInt($.data.type)],u.value.wms_co_id=[parseInt($.data.wms_co_id)],u.value.brand=[$.data.brand]})):y.Toast(B)})},_=A=>!A.wms_co_id||A.wms_co_id.length==0?y.Toast("请选择退货仓库"):!A.type||A.type.length==0?y.Toast("请选择退货类型"):!A.brand||A.brand.length==0?y.Toast("请选择品牌"):A,m=()=>{const A=_(u.value);if(!A)return;const b=y.Loading();E.Post("erp_purchase_out/save?lang="+S.lang,{token:S.token,data:A},B=>{b.clear();const{code:R,msg:P}=B.data;y.Toast(P),F("submit",R==0)})},d=()=>{F("update:show",!1)};return(A,b)=>(v(),Z(ee,{show:U.value,"onUpdate:show":b[5]||(b[5]=B=>U.value=B),title:I.title,width:"620px",bottom:"40px",onClose:b[6]||(b[6]=B=>d())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:b[4]||(b[4]=B=>m())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(te,null,{default:t(()=>[p(Pe,null,{default:t(()=>[s("tr",null,[b[7]||(b[7]=s("td",{class:"label"},[s("span",{class:"red_dot"},"退货仓库")],-1)),s("td",null,[p(me,{value:u.value.wms_co_id,"onUpdate:value":b[0]||(b[0]=B=>u.value.wms_co_id=B),options:k.value.partner_name,disabled:u.value.tp=="edit"},null,8,["value","options","disabled"])])]),s("tr",null,[b[8]||(b[8]=s("td",{class:"label"},[s("span",{class:"red_dot"},"退货类型")],-1)),s("td",null,[p(me,{value:u.value.type,"onUpdate:value":b[1]||(b[1]=B=>u.value.type=B),options:k.value.type_name},null,8,["value","options"])])]),s("tr",null,[b[9]||(b[9]=s("td",{class:"label"},[s("span",{class:"red_dot"},"品牌")],-1)),s("td",null,[p(me,{value:u.value.brand,"onUpdate:value":b[2]||(b[2]=B=>u.value.brand=B),options:k.value.brand_name},null,8,["value","options"])])]),s("tr",null,[b[10]||(b[10]=s("td",{class:"label"},"备注",-1)),s("td",null,[p(_e,{value:u.value.remark,"onUpdate:value":b[3]||(b[3]=B=>u.value.remark=B),type:"textarea",height:"160px"},null,8,["value"])])])]),_:1})]),_:1})]),_:1},8,["show","title"]))}}),Ke=["innerHTML"],ze=ae({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);re(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/del?lang="+S.lang,{token:S.token,data:$.data},_=>{W.clear();const{code:m,msg:d}=_.data;y.Toast(d),F("submit",m==0)})},k=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title||w(D).del,width:"360px",bottom:"40px",onClose:_[2]||(_[2]=m=>k())},{bottom:t(()=>[p(H,{effect:"dark",type:"danger",height:"40px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[s("span",{innerHTML:w(D).del_warn(I.data.length)},null,8,Ke)]),_:1})]),_:1},8,["show","title"]))}}),Ge=["innerHTML"],qe=ae({__name:"push",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);re(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/push?lang="+S.lang,{token:S.token,data:$.data},_=>{W.clear();const{code:m,msg:d}=_.data;y.Toast(d),F("submit",m==0)})},k=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title,width:"480px",bottom:"40px",onClose:_[2]||(_[2]=m=>k())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(Le,null,{default:t(()=>[..._[3]||(_[3]=[g("提醒: 确认货品已还采购员",-1)])]),_:1}),p(te,{lineHeight:"60px"},{default:t(()=>[s("div",{class:"tCenter",innerHTML:I.info,style:{"word-wrap":"break-word"}},null,8,Ge)]),_:1})]),_:1},8,["show","title"]))}}),Je=["innerHTML"],Qe=ae({__name:"revoke",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},info:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);re(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/revoke?lang="+S.lang,{token:S.token,data:$.data},_=>{W.clear();const{code:m,msg:d}=_.data;y.Toast(d),F("submit",m==0)})},k=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title,width:"480px",bottom:"40px",onClose:_[2]||(_[2]=m=>k())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(Le,null,{default:t(()=>[..._[3]||(_[3]=[g("提醒: 将撤回以下单据",-1)])]),_:1}),p(te,{lineHeight:"60px",class:"tCenter"},{default:t(()=>[s("div",{class:"tCenter",innerHTML:I.info,style:{"word-wrap":"break-word"}},null,8,Je)]),_:1})]),_:1},8,["show","title"]))}}),Xe=["innerHTML"],Ze=ae({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1);re(()=>$.show,W=>{U.value=W},{deep:!0});const u=()=>{const W=y.Loading();E.Post("erp_purchase_out/export?lang="+S.lang,{token:S.token,data:$.data,order:$.order},_=>{W.clear();const{code:m,msg:d,data:A}=_.data;y.Toast(d),m==0&&ye.Down(A.path+A.filename,A.filename),F("submit",m==0)})},k=()=>{F("update:show",!1)};return(W,_)=>(v(),Z(ee,{show:U.value,"onUpdate:show":_[1]||(_[1]=m=>U.value=m),title:I.title||w(D).export,width:"360px",bottom:"40px",onClose:_[2]||(_[2]=m=>k())},{bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:_[0]||(_[0]=m=>u())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[s("span",{innerHTML:w(D).export_warn(I.num)},null,8,Xe)]),_:1})]),_:1},8,["show","title"]))}}),et={class:"goods_info flex"},tt={class:"goods_info_tools flex"},lt={class:"goods_info_total"},st={class:"tCenter"},at={class:"tCenter"},ot={class:"flex_center"},nt={class:"flex_center"},it={class:"flex_center"},ut={key:0,class:"c_success"},dt={key:1,class:"c_info"},rt={key:2,class:"c_info"},pt=ae({__name:"import",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,S=oe().state,D=S.langs,U=L(!1),u=L({key:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"40px",textAlign:"center"},{title:"商品编码",index:"sku_id"},{title:"数量",slot:"num",textAlign:"center",width:"80px",minWidth:"80px"},{title:"操作",slot:"action",textAlign:"center",width:"80px",minWidth:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"status",textAlign:"center",width:"80px"}],list:[],num:0});L({show:!1,title:"新增商品",cost_price:"0.00",supply_price:"0.00",sale_price:"0.00",purchase_price:"0.00",supplier_price:"0.00",market_price:"0.00",weight:"0.00",unit:"个",sku_id:"",labels:"",name:"",category:"",properties_value:"",brand:"",short_name:"",i_id:"",owner:"",supplier_name:""});const k=L({show:!1,type:"",title:"移除",info:"",index:0});re(()=>$.show,P=>{U.value=P},{deep:!0});const W=()=>{const P=u.value.key.trim().toUpperCase();if(P.length==0)return;const C=P.split(" ");for(let T of C){if(T=se.LTrim(T,"0"),m(T)){y.Toast("[ "+T+" ]已存在!");continue}u.value.list.unshift({sku_id:T,num:1})}u.value.key="",d()},_=()=>{ye.Select({mimeType:[]},P=>{ye.FileToBase64(P,C=>{const T=Ie(C,{type:"binary"}),j=T.SheetNames[0],J=Be.sheet_to_json(T.Sheets[j],{raw:!1});if(J.length>3e3)return y.Toast("不能超过3000条");let z="";for(let Q of J){if(!Q.商品编码||!Q.数量){y.Toast("必须存在“商品编码”、“数量”");continue}if(z=se.LTrim(se.Trim(Q.商品编码).toUpperCase(),"0"),m(z)){y.Toast("[ "+z+" ]已存在!");continue}u.value.list.push({sku_id:z,num:Q.数量})}d()},"blob")})},m=P=>{for(let C of u.value.list)if(P==C.sku_id)return!0;return!1},d=()=>{const P=u.value.list;u.value.num=0;for(let C of P)u.value.num+=parseInt(C.num)},A=(P,C=0)=>{if(u.value.list.length==0)return y.Toast("无商品资料!");k.value.show=!0,k.value.type=P,P=="all"?(k.value.title="清空",k.value.info="移除全部资料"):(P="one")&&(k.value.title="移除",k.value.info=u.value.list[C].sku_id,k.value.index=C)},b=()=>{k.value.show=!1,k.value.type=="all"?u.value.list=[]:k.value.type=="one"&&u.value.list.splice(k.value.index,1),d()},B=()=>{if(u.value.list.length<1)return y.Toast("暂无导入数据!");const P=y.Loading();E.Post("erp_purchase_out/goods_safety?lang="+S.lang,{token:S.token,wms_co_id:$.data.wms_co_id,data:u.value.list},C=>{P.clear();const{code:T,msg:j,data:J}=C.data;T===0?(F("submit",u.value.list),u.value.num=0,u.value.list=[],R()):T===5e3?(y.Toast(j),u.value.list=J||[]):y.Toast(j)})},R=()=>{F("update:show",!1)};return(P,C)=>(v(),f(q,null,[p(ee,{show:U.value,"onUpdate:show":C[5]||(C[5]=T=>U.value=T),title:I.title,width:"720px",top:"56px",bottom:"40px",overflow:"hidden auto",onClose:C[6]||(C[6]=T=>R())},{top:t(()=>[s("div",et,[s("ul",tt,[s("li",null,[p(_e,{value:u.value.key,"onUpdate:value":C[0]||(C[0]=T=>u.value.key=T),onKeyup:C[1]||(C[1]=ke(T=>W(),["enter"])),onTextClick:C[2]||(C[2]=T=>_()),text:"选择文件",textColor:"#0064C8",placeholder:"商品编码，多条空格分隔",width:"320px",padding:"0 40px 0 10px"},null,8,["value"])]),s("li",null,[p(H,{type:"danger",effect:"text",padding:"0 4px",onClick:C[3]||(C[3]=T=>A("all"))},{default:t(()=>[...C[9]||(C[9]=[g("清空",-1)])]),_:1})])]),s("div",lt,[C[10]||(C[10]=g(" 数量: ",-1)),s("b",null,i(u.value.num),1)])])]),bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:C[4]||(C[4]=T=>B())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref:"tableList",columns:u.value.columns,options:u.value.list,isCheckbox:!1},{index:t(T=>[s("div",st,i(T.index+1),1)]),num:t(T=>[s("div",at,i(T.num),1)]),action:t(T=>[s("div",ot,[p(H,{type:"danger",effect:"text",padding:"0 4px",onClick:j=>A("one",T.index)},{default:t(()=>[g(i(w(D).remove),1)]),_:1},8,["onClick"])])]),view:t(T=>[s("div",nt,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:j=>{w(S).goods.show=!0,w(S).goods.sku_id=T.sku_id}},{default:t(()=>[g(i(w(D).flow),1)]),_:1},8,["onClick"])])]),status:t(T=>[s("div",it,[T.status===!0?(v(),f("span",ut,"可用")):T.status===!1?(v(),f("span",dt,i(T.status_name),1)):(v(),f("span",rt,"-"))])]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),p(ee,{show:k.value.show,"onUpdate:show":C[8]||(C[8]=T=>k.value.show=T),title:k.value.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[p(H,{effect:"dark",type:"danger",height:"40px",onClick:C[7]||(C[7]=T=>b())},{default:t(()=>[g(i(w(D).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[g(i(k.value.info),1)]),_:1})]),_:1},8,["show","title"])],64))}}),mt={class:"goods_info flex"},vt={class:"goods_info_tools flex"},ct={key:0},_t={key:1},ft={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 630px)"}},gt={class:"tCenter"},xt={class:"flex_center"},ht=["onClick"],kt=["onClick"],wt={class:"tCenter"},yt={class:"tCenter"},bt={class:"tRight"},$t={key:0},Ct={key:1},At={key:1},Tt={class:"tRight"},St={key:0},Ut={key:1},Dt={key:1},Lt={class:"tRight"},Wt={key:0},Pt={key:1},It={key:1},Bt={class:"tCenter"},Yt={class:"tCenter"},Ht={class:"tCenter"},Rt={key:1},Mt={class:"tCenter"},Nt={class:"tCenter"},Ft={class:"tCenter"},jt={key:0,class:"flex_center status2"},Vt={key:1,class:"tCenter"},Et={class:"tCenter"},Ot={class:"tCenter"},Kt={class:"flex_center"},zt={key:0,class:"c_danger"},Gt={key:1,class:"c_success"},qt=["title"],Jt={class:"tCenter color1"},Qt=ae({__name:"goods",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,N=L(),D=oe().state,U=D.langs,u=$e.priceEncode,k=De.isAction,W=L(!1);let _=null,m=[];const d=L({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:U.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",order:"",width:"150px",minWidth:"150px"},{title:"暗码",slot:"short_name",index:"short_name",order:"",textAlign:"center",width:"80px"},{title:"款式编码",slot:"i_id",index:"i_id",order:"",textAlign:"center",width:"80px"},{title:"商品名称",index:"name",order:"",width:"80px"},{title:"颜色及规格",index:"properties_value",order:""},{title:"供应链价(元)",slot:"supply_price",index:"supply_price",order:"",textAlign:"center",width:"100px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px",minWidth:"60px"},{title:"重量",slot:"weight",index:"weight",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"折扣",slot:"ratio",index:"ratio",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"标签",slot:"labels",index:"labels",order:"",textAlign:"center",width:"80px"},{title:"分类",slot:"category",index:"category",order:"",textAlign:"center",width:"80px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"采购员",slot:"owner",index:"owner",order:"",textAlign:"center",width:"80px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作",slot:"action",textAlign:"center",width:"60px",minWidth:"60px"},{title:"时间",slot:"utime",index:"utime",order:"",textAlign:"center",width:"60px",minWidth:"60px"},{title:"操作员",slot:"operator_name",index:"operator_name",order:"",textAlign:"center",width:"60px",minWidth:"60px"}],list:[],cost_price:0,sale_price:0,purchase_price:0,market_price:0,num:0,print:0,total:0,is_sku:{label:"校对商品",value:"is_sku",checked:!0},remove:{show:!1,type:"",title:"",info:"",data:[]},refresh:!1}),A=L({show:!1,title:"导入"}),b=L({show:!1,title:"拆分",info:{}}),B=L(!1),R=L(0),P=L([]);re(()=>$.show,x=>{W.value=x,x&&(d.value.key="",d.value.refresh=!1,J())},{deep:!0});const C=(x,r)=>{d.value.print=x,d.value.total=r},T=x=>{d.value.order=x,J()},j=()=>{const x=se.LTrim(d.value.key.trim().toUpperCase(),"0");if(d.value.key="",$.data.status==0){if(x.length==0)return;Q([{sku_id:x,num:1}])}else J(x)},J=(x="")=>{d.value.list=[],z(!1);const r=y.Loading();E.Post("erp_purchase_out/goods_list?lang="+D.lang,{token:D.token,id:$.data.id,order:d.value.order,sku_id:x},e=>{r.clear();const{code:n,msg:l,data:a}=e.data;n==0?(d.value.list=a,de(),z(!1)):y.Toast(l)})},z=x=>{const r=d.value.list;d.value.cost_price=0,d.value.sale_price=0,d.value.purchase_price=0,d.value.market_price=0,d.value.num=0;const e=r.length-1,n=e>=0?r[e].sku_id:"";let l=0,a=0;b.value.info={};for(let h of r)h.ratio&&(l=parseInt(h.num),a=parseFloat(h.ratio),d.value.cost_price+=parseFloat(h.cost_price)*l*a,d.value.sale_price+=parseFloat(h.sale_price)*l*a,d.value.purchase_price+=parseFloat(h.purchase_price)*l*a,d.value.market_price+=parseFloat(h.market_price)*l*a,d.value.num+=l,h.is_date=h.labels!="缅甸"&&n.substring(0,7)!=h.sku_id.substring(0,7),b.value.info[h.brand]=b.value.info[h.brand]?b.value.info[h.brand]+1:l);x&&(d.value.refresh=!0)},Q=(x,r="")=>{for(let e of x){const n=fe(e.sku_id);if(d.value.is_sku.checked&&n)return y.Toast("[ "+e.sku_id+" ]已存在",5e3,"danger");if(n)for(let l of d.value.list)l.sku_id==e.sku_id&&(l.num+=parseInt(e.num),e.num=l.num,y.Toast("[ "+e.sku_id+" ]数量 "+l.num+" "));else d.value.list.unshift({id:"s"+e.sku_id,sku_id:e.sku_id,num:e.num,loading:0})}r==="import"?ne(x):(m.push(x[0]),clearTimeout(_),_=setTimeout(()=>{ne(m),m=[]},800))},fe=x=>{let r=!1;for(let e of d.value.list)e.sku_id==x&&(r=!0);return r},ne=x=>{let r=x;E.Post("erp_purchase_out/goods_add?lang="+D.lang,{token:D.token,id:$.data.id,ctime:$.data.ctime,wms_co_id:$.data.wms_co_id,data:x},e=>{const{code:n,msg:l,data:a,err:h}=e.data;if(n===0)ie(a),z(!0);else if(n===5e3){if(y.Toast(l,5e3,"danger"),a&&a.length>0&&ie(a),h&&h.length>0){const K=d.value.list;for(let pe of h)for(let Ae in K)pe==K[Ae].sku_id&&(K[Ae].loading=1)}}else l?y.Toast(l):ie(r,!0)},()=>{ie(r,!0)})},ie=(x,r=!1)=>{if(x.length==0)return;const e=d.value.list;for(let n in x){x[n].brand!=$.data.brand&&y.Toast("[ "+x[n].sku_id+" ]品牌为“"+x[n].brand+"”不等于“"+$.data.brand+"”",5e3,"danger");for(let l in e)if(e[l].sku_id==x[n].sku_id){r?e[l].loading=1:e[l]=x[n];continue}}},ve=(x,r,e)=>{const n=parseInt(x);if(n.toString()=="NaN")return y.Toast("请输入数字");for(let l of d.value.list)l.sku_id==e&&(l.num=n);E.Post("erp_purchase_out/goods_num?lang="+D.lang,{token:D.token,id:r,num:n,sku_id:e,pid:$.data.id,ctime:$.data.ctime,wms_co_id:$.data.wms_co_id},l=>{const{code:a,msg:h}=l.data;a==0?(y.Toast(h),z(!0)):y.Toast(h,5e3,"danger")})},ce=(x,r={})=>{if(d.value.remove.type=x,d.value.remove.data=[],x=="one")d.value.remove.show=!0,d.value.remove.title='移除" '+r.sku_id+' "',d.value.remove.info="是否移除单条数据?",d.value.remove.data=[{index:r.index,id:r.id,sku_id:r.sku_id,num:r.num}];else if(x=="part"){const e=N.value.getData();if(e.length==0)return y.Toast("请选择数据");d.value.remove.show=!0,d.value.remove.title="移除选中",d.value.remove.info="是否移除选中数据?";for(let n of e)d.value.remove.data.unshift({index:n.index,id:n.id,sku_id:n.sku_id,num:n.num})}},Y=()=>{d.value.remove.show=!1;const x=d.value.remove.data,r=d.value.list;let e=[];for(let l of x){if(l.id.toString().substring(0,1)=="s"){r.splice(l.index,1),z(!0);continue}e.push({index:l.index,id:l.id,sku_id:l.sku_id,num:l.num})}if(e.length==0)return;const n=y.Loading();E.Post("erp_purchase_out/goods_remove?lang="+D.lang,{token:D.token,id:$.data.id,ctime:$.data.ctime,wms_co_id:$.data.wms_co_id,data:e},l=>{n.clear();const{code:a,msg:h}=l.data;if(a==0){if(d.value.remove.type=="all")d.value.list=[];else for(let K of e)r.splice(K.index,1);z(!0)}else y.Toast(h,5e3,"danger")})},c=()=>{A.value.show=!0,A.value.title="导入"},o=x=>{x.length<1||Q(x,"import")},M=()=>{b.value.show=!0,b.value.title="按品牌拆分"},G=()=>{b.value.show=!1;const x=y.Loading();E.Post("erp_purchase_out/explode?lang="+D.lang,{token:D.token,id:$.data.id},r=>{x.clear();const{code:e,msg:n}=r.data;y.Toast(n),e==0&&(d.value.refresh=!0,we())})},X=x=>{let r=[],e=0;for(let n of d.value.list)n.img&&(n.img==x&&(R.value=e),r.push({label:n.sku_id,value:n.img,other:{颜色及规格:n.properties_value,标签价:n.sale_price+"元",吊牌价:n.market_price+"W"}}),e++);B.value=!0,P.value=r},ue=(x,r)=>{const e=N.value.getData();let n="";for(let l in e)n+=e[l][x]+" ";n?se.CopyText(n):se.CopyText(r)},ge=()=>{if(d.value.print<=0)return y.Toast("请选择!");const x=N.value.getData();let r=[];for(let e of x)r.push({sku_id:e.sku_id});if(r.length==0)return y.Toast("请选择!");D.print.sku=r,D.print.show=!0},de=()=>{xe(()=>{N.value.checkboxAll(!1)})},we=()=>{for(let x of d.value.list)if(x.brand!=$.data.brand&&y.Toast("[ "+x.sku_id+" ]品牌为“"+x.brand+"”不等于“"+$.data.brand+"”",5e3,"danger"),x.loading==0||x.loading==1)return y.Toast("["+x.sku_id+"]未加载完成!");if(d.value.refresh){const x=y.Loading();E.Post("erp_purchase_out/goods_price?lang="+D.lang,{token:D.token,id:$.data.id,ctime:$.data.ctime},r=>{x.clear();const{code:e,msg:n}=r.data;e!==0&&y.Toast(n,5e3,"danger"),F("update:show",!1),F("submit",d.value.refresh)})}else F("update:show",!1),F("submit",d.value.refresh)};return(x,r)=>(v(),f(q,null,[p(ee,{show:W.value,"onUpdate:show":r[7]||(r[7]=e=>W.value=e),title:I.title,width:"calc(100% - 40px)",top:"56px",bottom:I.data.status==0?"40px":"0px",overflow:"auto",bgClose:!1,onClose:r[8]||(r[8]=e=>we())},{top:t(()=>[s("div",mt,[s("ul",vt,[s("li",null,[p(_e,{value:d.value.key,"onUpdate:value":r[0]||(r[0]=e=>d.value.key=e),onKeyup:r[1]||(r[1]=ke(e=>j(),["enter"])),onIconClick:r[2]||(r[2]=e=>j()),placeholder:w(D).langs.sku_id,maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value","placeholder"])]),I.data.status==0?(v(),f(q,{key:0},[s("li",null,[p(Ye,{options:d.value.is_sku},null,8,["options"])]),w(k)("save")?(v(),f("li",ct,[p(H,{type:"danger",effect:"text",padding:"0 4px",onClick:r[3]||(r[3]=e=>ce("part"))},{default:t(()=>[...r[16]||(r[16]=[g("移除",-1)])]),_:1})])):le("",!0),r[18]||(r[18]=s("li",null,"|",-1)),w(k)("goods_imp")?(v(),f("li",_t,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:r[4]||(r[4]=e=>c())},{default:t(()=>[...r[17]||(r[17]=[g("导入",-1)])]),_:1})])):le("",!0),r[19]||(r[19]=s("li",null,"|",-1))],64)):le("",!0),s("li",null,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:r[5]||(r[5]=e=>ge())},{default:t(()=>[g("打印标签("+i(d.value.print)+")",1)]),_:1})])]),s("div",ft,[r[20]||(r[20]=g(" 标签价: ",-1)),s("b",null,i(w(u)(d.value.sale_price)),1),r[21]||(r[21]=g(" 元   吊牌价: ",-1)),s("b",null,i(w(u)(d.value.market_price)),1),r[22]||(r[22]=g(" W   数量: ",-1)),s("b",null,i(d.value.num),1)])])]),bottom:t(()=>[I.data.status==0?(v(),Z(H,{key:0,type:"primary",height:"40px",padding:"0 32px",onClick:r[6]||(r[6]=e=>M())},{default:t(()=>[r[29]||(r[29]=g(" 按品牌拆分( ",-1)),(v(!0),f(q,null,be(b.value.info,(e,n)=>(v(),f("span",null,[g(i(n)+": ",1),s("b",null,i(e),1)]))),256)),r[30]||(r[30]=g(" ) ",-1))]),_:1})):le("",!0)]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref_key:"tableList",ref:N,columns:d.value.columns,options:d.value.list,onOrderBy:T,onPartially:C,maxLen:100},{index:t(e=>[s("div",gt,i(d.value.list.length-e.index),1)]),img:t(e=>[s("div",xt,[s("span",{onClick:n=>e.img?X(e.img):""},[p(We,{img:e.img?e.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,ht)])]),sku_id:t(e=>[s("div",{class:Se(["copy",e.is_date?"c_danger":"c_primary"])},[g(i(e.sku_id),1),s("span",{onClick:n=>ue("sku_id",e.sku_id)},"复",8,kt)],2)]),short_name:t(e=>[s("div",wt,i(e.short_name||"-"),1)]),i_id:t(e=>[s("div",yt,i(e.i_id||"-"),1)]),supply_price:t(e=>[s("div",bt,[e.supply_price>0?(v(),f(q,{key:0},[e.ratio!="1.00"?(v(),f("span",$t,[s("del",null,i(w(u)(e.supply_price)),1),r[23]||(r[23]=g()),s("b",null,i(w(u)(e.supply_price*e.ratio)),1)])):(v(),f("b",Ct,i(w(u)(e.supply_price)),1))],64)):(v(),f("span",At,"-"))])]),sale_price:t(e=>[s("div",Tt,[e.sale_price>0?(v(),f(q,{key:0},[e.ratio!="1.00"?(v(),f("span",St,[s("del",null,i(w(u)(e.sale_price)),1),r[24]||(r[24]=g()),s("b",null,i(w(u)(e.sale_price*e.ratio)),1)])):(v(),f("b",Ut,i(w(u)(e.sale_price)),1))],64)):(v(),f("span",Dt,"-"))])]),market_price:t(e=>[s("div",Lt,[e.market_price>0?(v(),f(q,{key:0},[e.ratio!="1.00"?(v(),f("span",Wt,[s("del",null,i(w(u)(e.market_price)),1),r[25]||(r[25]=g()),s("b",null,i(w(u)(e.market_price*e.ratio)),1)])):(v(),f("b",Pt,i(w(u)(e.market_price)),1))],64)):(v(),f("span",It,"-"))])]),unit:t(e=>[s("div",Bt,i(e.unit||"-"),1)]),weight:t(e=>[s("div",Yt,i(e.weight||"-"),1)]),num:t(e=>[s("div",Ht,[I.data.status==0&&e.loading!=0?(v(),Z(_e,{key:0,value:e.num,"onUpdate:value":n=>e.num=n,"onUpdate:blur":n=>ve(n,e.id,e.sku_id),inputAlign:"center"},null,8,["value","onUpdate:value","onUpdate:blur"])):(v(),f("span",Rt,[s("b",null,i(e.num||"-"),1)]))])]),ratio:t(e=>[s("div",Mt,i(e.ratio||"-"),1)]),labels:t(e=>[s("div",Nt,i(e.labels||"-"),1)]),category:t(e=>[s("div",Ft,i(e.category||"-"),1)]),brand:t(e=>[e.brand!=I.data.brand?(v(),f("div",jt,i(e.brand||">"),1)):(v(),f("div",Vt,i(e.brand||">"),1))]),owner:t(e=>[s("div",Et,i(e.owner||"-"),1)]),view:t(e=>[s("div",Ot,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:n=>{w(D).goods.show=!0,w(D).goods.sku_id=e.sku_id}},{default:t(()=>[g(i(w(U).flow),1)]),_:1},8,["onClick"])])]),action:t(e=>[s("div",Kt,[I.data.status==0?(v(),f(q,{key:0},[e.loading==0?(v(),Z(H,{key:0,type:"warning",effect:"text",padding:"0 4px"},{default:t(()=>[...r[26]||(r[26]=[g("加载中",-1)])]),_:1})):e.loading==1?(v(),Z(H,{key:1,type:"success",effect:"text",padding:"0 4px",onClick:n=>ne([{id:e.id,sku_id:e.sku_id,num:e.num}])},{default:t(()=>[...r[27]||(r[27]=[g("刷新",-1)])]),_:1},8,["onClick"])):le("",!0),e.loading!=0?(v(),Z(H,{key:2,type:"danger",effect:"text",padding:"0 4px",onClick:n=>ce("one",e)},{default:t(()=>[...r[28]||(r[28]=[g("移除",-1)])]),_:1},8,["onClick"])):le("",!0)],64)):(v(),f(q,{key:1},[e.status==0?(v(),f("span",zt,"待退货")):e.status==1?(v(),f("span",Gt,"完成")):le("",!0)],64))])]),utime:t(e=>[s("div",{class:"tCenter color1",title:"创建: "+e.ctime+`
更新: `+e.utime},i(e.ctime?e.ctime.substr(11,8):"-"),9,qt)]),operator_name:t(e=>[s("div",Jt,i(e.operator_name||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title","bottom"]),p(ee,{show:d.value.remove.show,"onUpdate:show":r[10]||(r[10]=e=>d.value.remove.show=e),title:d.value.remove.title,width:"360px",bottom:"40px",isClose:!0},{bottom:t(()=>[p(H,{effect:"dark",type:"danger",height:"40px",padding:"0 32px",onClick:r[9]||(r[9]=e=>Y())},{default:t(()=>[g(i(w(U).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[g(i(d.value.remove.info),1)]),_:1})]),_:1},8,["show","title"]),p(ee,{show:b.value.show,"onUpdate:show":r[12]||(r[12]=e=>b.value.show=e),title:b.value.title,width:"480px",bottom:"40px",isClose:!0},{bottom:t(()=>[p(H,{type:"primary",height:"40px",padding:"0 32px",onClick:r[11]||(r[11]=e=>G())},{default:t(()=>[g(i(w(U).confirm),1)]),_:1})]),default:t(()=>[p(te,{lineHeight:"60px"},{default:t(()=>[(v(!0),f(q,null,be(b.value.info,(e,n)=>(v(),f("span",null,[g(i(n)+": ",1),s("b",null,i(e),1)]))),256))]),_:1})]),_:1},8,["show","title"]),p(pt,{show:A.value.show,"onUpdate:show":r[13]||(r[13]=e=>A.value.show=e),title:A.value.title,data:{wms_co_id:$.data.wms_co_id},onSubmit:r[14]||(r[14]=e=>o(e))},null,8,["show","title","data"]),p(Te,{show:B.value,"onUpdate:show":r[15]||(r[15]=e=>B.value=e),index:R.value,options:P.value},null,8,["show","index","options"])],64))}}),Xt=Ce(Qt,[["__scopeId","data-v-a36dad82"]]),Zt={class:"goods_info flex"},el={class:"goods_info_tools flex"},tl={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},ll={class:"tCenter"},sl={class:"flex_center"},al=["onClick"],ol={class:"copy c_primary"},nl=["onClick"],il={class:"tCenter"},ul={class:"tRight"},dl={key:0},rl={key:1},pl={key:1},ml={class:"tRight"},vl={key:0},cl={key:1},_l={key:1},fl={class:"tCenter"},gl={class:"tCenter"},xl={class:"tCenter"},hl={class:"tCenter"},kl={class:"tCenter"},wl={key:0,class:"c_danger"},yl={key:1,class:"c_success"},bl={class:"tCenter type"},$l={key:0,class:"type_warning"},Cl={key:1,class:"type_success"},Al={key:2,class:"type_warning"},Tl={key:3,class:"type_success"},Sl={key:4,class:"type_info"},Ul={key:5,class:"type_danger"},Dl={key:6,class:"type_primary"},Ll={key:7,class:"type_info"},Wl={class:"tCenter"},Pl={class:"goods_info flex"},Il={class:"goods_info_tools flex"},Bl={class:"goods_info_total scrollbar",style:{"max-width":"calc(100% - 600px)"}},Yl={class:"tCenter"},Hl={class:"tCenter"},Rl={class:"tCenter"},Ml={class:"tCenter"},Nl={class:"tCenter"},Fl={key:0,class:"flex_center status0"},jl={key:1,class:"flex_center status1"},Vl={key:2,class:"flex_center status2"},El={key:3,class:"tCenter"},Ol=ae({__name:"diff",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(I,{emit:O}){const $=I,F=O,N=L(),S=L(),U=oe().state,u=U.langs,k=$e.priceEncode,W=L(!1);let _=L([]);const m=L({key:"",order:"",columns:[{title:"序号",slot:"index",width:"40px",minWidth:"30px",textAlign:"center"},{title:u.img,slot:"img",width:"60px",textAlign:"center"},{title:"商品编码",slot:"sku_id",index:"sku_id",width:"120px",minWidth:"120px"},{title:"款式编码",slot:"i_id",index:"i_id",textAlign:"center",width:"80px"},{title:"标签价(元)",slot:"sale_price",index:"sale_price",textAlign:"center",width:"100px"},{title:"吊牌价(W)",slot:"market_price",index:"market_price",textAlign:"center",width:"100px"},{title:"单位",slot:"unit",textAlign:"center",width:"60px"},{title:"重量",slot:"weight",index:"weight",textAlign:"center",width:"60px"},{title:"数量",slot:"num",index:"num",textAlign:"center",width:"60px",minWidth:"60px"},{title:"状态",slot:"action",index:"status",textAlign:"center",width:"60px",minWidth:"60px"},{title:"查看",slot:"view",textAlign:"center",width:"60px",minWidth:"60px"},{title:"类型",slot:"type_name",textAlign:"center",width:"60px"},{title:"采购员",slot:"owner",textAlign:"center",width:"60px"},{title:"仓库",index:"warehouse"}],list:[],sale_price:0,market_price:0,num:0,out_num:0}),d=L({show:!1,key:"",order:"",columns:[{title:"单号",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:u.date,index:"date",slot:"date",width:"90px",textAlign:"center"},{title:"类型",slot:"type",width:"80px",minWidth:"80px",textAlign:"center"},{title:"仓库",index:"wms_co_name"},{title:"数量",slot:"num",textAlign:"center"},{title:"条数",slot:"total",textAlign:"center"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:"制单员",index:"creator_name",textAlign:"center"},{title:"备注",index:"remark"}],list:[],total:0,num:0}),A=L(!1),b=L(0),B=L([]);re(()=>$.show,Y=>{if(W.value=Y,Y){_.value=[];for(let c of $.data)E.Post("erp_purchase_out/goods_list?lang="+U.lang,{token:U.token,id:c},o=>{const{code:M,msg:G,data:X}=o.data;if(M==0)for(let ue of X)_.value.push(ue);else y.Toast(G)})}},{deep:!0});const R=Y=>{m.value.order=Y,C(m.value.key)},P=()=>{const Y=se.LTrim(m.value.key.trim().toUpperCase(),"0");C(Y)},C=Y=>{m.value.list=[],m.value.out_num=0;const c=Y.split(" ");for(let o of c){const M=y.Loading();E.Post("erp_purchase_in/goods_list?lang="+U.lang,{token:U.token,id:o},G=>{M.clear();const{code:X,msg:ue,data:ge}=G.data;if(X==0)for(let de of ge)m.value.out_num+=de.num,T(de.sku_id)||(m.value.list.push({sku_id:de.sku_id}),j(de.sku_id));else y.Toast(ue)})}},T=(Y="")=>{for(let c of _.value)if(Y===c.sku_id)return!0;return!1},j=Y=>{E.Post("goods/direct?lang="+U.lang,{token:U.token,sku_id:Y,time:24},c=>{const{code:o,msg:M,data:G}=c.data;if(o==0){if(G.list.length===0)return;for(let X in m.value.list)m.value.list[X].sku_id==G.list[0].sku_id&&(m.value.list[X]=G.list[0],J())}else y.Toast(M)})},J=()=>{m.value.sale_price=0,m.value.market_price=0,m.value.num=0;for(let Y of m.value.list)m.value.sale_price+=Y.sale_price*Y.num,m.value.market_price+=Y.market_price*Y.num,m.value.num+=Y.num},z=()=>{const Y=se.LTrim(d.value.key.trim().toUpperCase(),"0");d.value.key="",Q(Y)},Q=Y=>{d.value.list=[];const c=y.Loading();E.Post("erp_purchase_in/list?lang="+U.lang,{token:U.token,data:{key:Y},page:1,limit:30,order:""},o=>{c.clear();const{code:M,msg:G,data:X,time:ue}=o.data;M==0?(d.value.list=X,xe(()=>{S.value.checkboxAll(!1)})):y.Toast(G)})},fe=(Y,c)=>{d.value.total=Y,d.value.num=0;const o=S.value.getData();for(let M of o)d.value.num+=parseInt(M.num)},ne=()=>{const Y=S.value.getData();if(Y.length==0)return y.Toast("请选择入库单");let c=[];for(let o of Y)c.push(o.id);d.value.show=!1,m.value.key=c.join(" "),P()},ie=Y=>{let c=[],o=0;for(let M of m.value.list)M.img&&(M.img==Y&&(b.value=o),c.push({label:M.sku_id,value:M.img,other:{颜色及规格:M.properties_value,标签价:M.sale_price+"元",吊牌价:M.market_price+"W"}}),o++);A.value=!0,B.value=c},ve=(Y,c)=>{const o=N.value.getData();let M="";for(let G in o)M+=o[G][Y]+" ";M?se.CopyText(M):se.CopyText(c)},ce=()=>{_.value=[],m.value.key="",m.value.list=[],m.value.num=0,m.value.out_num=0,m.value.sale_price=0,m.value.market_price=0,F("update:show",!1)};return(Y,c)=>(v(),f(q,null,[p(ee,{show:W.value,"onUpdate:show":c[4]||(c[4]=o=>W.value=o),title:I.title,width:"calc(100% - 40px)",maxWidth:"1366px",overflow:"auto",top:"56px",bottom:"0px",bgClose:!1,onClose:c[5]||(c[5]=o=>ce())},{top:t(()=>[s("div",Zt,[s("ul",el,[s("li",null,[p(_e,{value:m.value.key,"onUpdate:value":c[0]||(c[0]=o=>m.value.key=o),onKeyup:c[1]||(c[1]=ke(o=>P(),["enter"])),onIconClick:c[2]||(c[2]=o=>P()),placeholder:"入库单号,多个空格分离",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])]),s("li",null,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:c[3]||(c[3]=o=>{d.value.show=!0,Q(d.value.key)})},{default:t(()=>[...c[13]||(c[13]=[g("选择入库单",-1)])]),_:1})])]),s("div",tl,[c[14]||(c[14]=g(" 入库数: ",-1)),s("b",null,i(m.value.out_num),1),c[15]||(c[15]=g("    采退数: ",-1)),s("b",null,i(I.num),1),c[16]||(c[16]=g("    标签价: ",-1)),s("b",null,i(w(k)(m.value.sale_price)),1),c[17]||(c[17]=g(" 元   吊牌价: ",-1)),s("b",null,i(w(k)(m.value.market_price)),1),c[18]||(c[18]=g(" W   数量: ",-1)),s("b",null,i(m.value.num),1)])])]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref_key:"tableList",ref:N,columns:m.value.columns,options:m.value.list,onOrderBy:R},{index:t(o=>[s("div",ll,i(m.value.list.length-o.index),1)]),img:t(o=>[s("div",sl,[s("span",{onClick:M=>o.img?ie(o.img):""},[p(We,{img:o.img?o.img+"&x-oss-process=image/resize,h_40":"",isView:!1},null,8,["img"])],8,al)])]),sku_id:t(o=>[s("div",ol,[g(i(o.sku_id),1),s("span",{onClick:M=>ve("sku_id",o.sku_id)},"复",8,nl)])]),i_id:t(o=>[s("div",il,i(o.i_id||"-"),1)]),sale_price:t(o=>[s("div",ul,[o.sale_price>0?(v(),f(q,{key:0},[o.ratio!="1.00"?(v(),f("span",dl,[s("del",null,i(w(k)(o.sale_price)),1),c[19]||(c[19]=g()),s("b",null,i(w(k)(o.sale_price*o.ratio)),1)])):(v(),f("b",rl,i(w(k)(o.sale_price)),1))],64)):(v(),f("span",pl,"-"))])]),market_price:t(o=>[s("div",ml,[o.market_price>0?(v(),f(q,{key:0},[o.ratio!="1.00"?(v(),f("span",vl,[s("del",null,i(w(k)(o.market_price)),1),c[20]||(c[20]=g()),s("b",null,i(w(k)(o.market_price*o.ratio)),1)])):(v(),f("b",cl,i(w(k)(o.market_price)),1))],64)):(v(),f("span",_l,"-"))])]),unit:t(o=>[s("div",fl,i(o.unit||"-"),1)]),weight:t(o=>[s("div",gl,i(o.weight||"-"),1)]),num:t(o=>[s("div",xl,[s("b",null,i(o.num||"-"),1)])]),view:t(o=>[s("div",hl,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:M=>{w(U).goods.show=!0,w(U).goods.sku_id=o.sku_id}},{default:t(()=>[g(i(w(u).flow),1)]),_:1},8,["onClick"])])]),action:t(o=>[s("div",kl,[o.status==0?(v(),f("span",wl,"进行中")):o.status==1?(v(),f("span",yl,"完成")):le("",!0)])]),type_name:t(o=>[s("div",bl,[o.type=="6"?(v(),f("span",$l,i(o.type_name||"-"),1)):o.type=="5"?(v(),f("span",Cl,i(o.type_name||"-"),1)):o.type=="4"?(v(),f("span",Al,i(o.type_name||"-"),1)):o.type=="3"?(v(),f("span",Tl,i(o.type_name||"-"),1)):o.type=="2"?(v(),f("span",Sl,i(o.type_name||"-"),1)):o.type=="1"?(v(),f("span",Ul,i(o.type_name||"-"),1)):o.type=="0"?(v(),f("span",Dl,i(o.type_name||"-"),1)):o.type=="-1"?(v(),f("span",Ll,i(o.type_name||"-"),1)):le("",!0)])]),owner:t(o=>[s("div",Wl,i(o.owner||"-"),1)]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show","title"]),p(Te,{show:A.value,"onUpdate:show":c[6]||(c[6]=o=>A.value=o),index:b.value,options:B.value},null,8,["show","index","options"]),p(ee,{show:d.value.show,"onUpdate:show":c[11]||(c[11]=o=>d.value.show=o),title:"选择入库单",width:"calc(100% - 40px)",maxWidth:"1280px",overflow:"auto",top:"56px",bottom:"40px",onClose:c[12]||(c[12]=o=>d.value.show=!1)},{top:t(()=>[s("div",Pl,[s("ul",Il,[s("li",null,[p(_e,{value:d.value.key,"onUpdate:value":c[7]||(c[7]=o=>d.value.key=o),onKeyup:c[8]||(c[8]=ke(o=>z(),["enter"])),onIconClick:c[9]||(c[9]=o=>z()),placeholder:"单号、商品编码、备注",maxlength:"32",icon:"ui ui_search",iconAlign:"right",padding:"0 40px 0 10px"},null,8,["value"])])]),s("div",Bl,[c[21]||(c[21]=g(" 入库数: ",-1)),s("b",null,i(d.value.num),1),c[22]||(c[22]=g("   采退数: ",-1)),s("b",null,i(I.num),1),c[23]||(c[23]=g("    差异: ",-1)),s("b",null,i(d.value.num-I.num>0?d.value.num-I.num:I.num-d.value.num),1)])])]),bottom:t(()=>[p(H,{height:"40px",padding:"0 32px",onClick:c[10]||(c[10]=o=>ne())},{default:t(()=>[g(i(w(u).confirm),1)]),_:1})]),default:t(()=>[p(te,{paddingY:"4px"},{default:t(()=>[p(he,{ref_key:"formList",ref:S,overflow:"auto",columns:d.value.columns,options:d.value.list,onPartially:fe},{id:t(o=>[s("div",Yl,i(o.id),1)]),date:t(o=>[s("div",Hl,[p(Ue,{title:"创建: "+o.ctime+`
更新: `+o.utime+`
制单: `+o.creator_name+", 审核: "+o.operator_name+`
备注: `+o.remark},{default:t(()=>[g(i(o.utime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(o=>[s("div",Rl,i(o.type_name),1)]),num:t(o=>[s("div",Ml,i(o.num),1)]),total:t(o=>[s("div",Nl,i(o.total),1)]),status:t(o=>[o.status=="0"?(v(),f("div",Fl,i(o.status_name),1)):o.status=="1"?(v(),f("div",jl,i(o.status_name),1)):o.status=="2"?(v(),f("div",Vl,i(o.status_name),1)):(v(),f("div",El,i(o.status_name),1))]),_:1},8,["columns","options"])]),_:1})]),_:1},8,["show"])],64))}}),Kl=Ce(Ol,[["__scopeId","data-v-f3a99bca"]]),zl={class:"app_action flex"},Gl={class:"app_action_tools scrollbar"},ql={key:0,class:"line"},Jl={key:0,class:"line"},Ql={class:"app_action_search flex"},Xl={class:"custom_time flex_center"},Zl=["onClick"],es={class:"app_ct"},ts={class:"tCenter"},ls={class:"tCenter"},ss={class:"tCenter"},as={class:"tCenter"},os={class:"tRight"},ns={class:"tRight"},is={class:"tCenter"},us={class:"tCenter"},ds={key:0,class:"flex_center status0"},rs={key:1,class:"flex_center status1"},ps={key:2,class:"flex_center status2"},ms={key:3,class:"tCenter"},vs={class:"tCenter"},cs={key:2,class:"c_info"},_s={class:"tCenter"},fs={class:"tCenter"},gs={class:"app_page"},xs=ae({__name:"index",setup(I){const O=L(!1),$=L(),N=oe().state,S=N.langs,D=De.isAction,U=$e.priceEncode,u=L({show:!1,key:"",placeholder:"ID、品牌、操作员、备注",time:[V.Date("Y/m/d",V.StrToTime("-1 month")),V.Date("Y/m/d")],maxDate:V.Date("Y/m/d"),customTime:{active:"",list:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"3个月",value:"month"},{label:"近1年",value:"year"}]},columns:[{label:"",value:"",slot:"customTime"},{label:S.select,value:"",slot:"time"},{label:"仓库名称",value:"",slot:"wms_co_id"},{label:"退货类型",value:"",slot:"type"},{label:"状态",value:"",slot:"status"},{label:"品牌",value:"",slot:"brand"},{label:"单号, 多条空格分离",value:"",name:"id"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label:"制单员",value:"",name:"creator_name"},{label:"操作员",value:"",name:"operator_name"},{label:"备注",value:"",name:"remark"}],type:"",wms_co_id:"",brand:"",status:""}),k=L({time:"",list:{num:0,cost_price:0,sale_price:0,purchase_price:0,market_price:0}}),W=L({columns:[{title:"单号",slot:"id",textAlign:"center",width:"100px"},{title:S.date,slot:"date",textAlign:"center",width:"90px"},{title:"类型",slot:"type",index:"type",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"退货仓库",index:"wms_co_name",width:"200px"},{title:"品牌",slot:"brand",index:"brand",order:"",textAlign:"center",width:"80px",minWidth:"80px"},{title:"标签总额(元)",slot:"sale_price",index:"sale_price",order:"",textAlign:"center",width:"100px"},{title:"吊牌总额(W)",slot:"market_price",index:"market_price",order:"",textAlign:"center",width:"100px"},{title:"数量",slot:"num",index:"num",order:"",textAlign:"center",width:"60px"},{title:"条数",slot:"total",index:"total",order:"",textAlign:"center",width:"60px"},{title:"状态",slot:"status",width:"80px",minWidth:"80px",textAlign:"center"},{title:S.action,slot:"action",textAlign:"center",width:"40px"},{title:"商品",slot:"goods",textAlign:"center",width:"40px"},{title:S.review,slot:"print",textAlign:"center",width:"40px"},{title:"制单员",index:"creator_name",textAlign:"center",width:"100px"},{title:"操作员",index:"operator_name",textAlign:"center",width:"100px"},{title:"备注",index:"remark"}],data:[],num:0,total:0,order:""}),_=L({total:0,num:1,limit:100}),m=L({show:!1,title:"添加/编辑",data:{}}),d=L({show:!1,title:"删除",data:[]}),A=L({show:!1,title:"推送",info:"",num:0,data:[]}),b=L({show:!1,title:"撤回",info:"",data:[]}),B=L({show:!1,title:"导出",num:0,data:[]}),R=L({show:!1,title:"对比",num:0,data:[]}),P=L({show:!1,title:"商品",data:{}}),C=L({show:!1,title:"入库单",info:{},columns:[],data:[]}),T=L({partner_name:[],brand_name:[],type_name:[],status_name:[]});He(()=>{N.token&&e()}),Re(()=>{O&&N.isLogin&&j()});const j=()=>{u.value.show=!1,W.value.data=[];const n=y.Loading();E.Post("erp_purchase_out/list?lang="+N.lang,{token:N.token,data:J(),page:_.value.num,limit:_.value.limit,order:W.value.order},l=>{n.clear();const{code:a,msg:h,data:K,time:pe}=l.data;a==0?(k.value.time=pe,W.value.data=K,xe(()=>ne())):y.Toast(h)}),_.value.total=0,k.value.list.num=0,k.value.list.cost_price=0,k.value.list.sale_price=0,k.value.list.purchase_price=0,k.value.list.market_price=0,E.Post("erp_purchase_out/total?lang="+N.lang,{token:N.token,data:J()},l=>{const{code:a,msg:h,data:K,time:pe}=l.data;a==0?(k.value.time=pe,_.value.total=K.total,k.value.list.cost_price=K.cost_price,k.value.list.sale_price=K.sale_price,k.value.list.purchase_price=K.purchase_price,k.value.list.market_price=K.market_price,k.value.list.num=K.num):y.Toast(h)})},J=()=>{const n={key:u.value.key,stime:typeof u.value.time[0]=="string"?u.value.time[0]:V.Date("Y/m/d",u.value.time[0]),etime:typeof u.value.time[1]=="string"?u.value.time[1]:V.Date("Y/m/d",u.value.time[1]),wms_co_id:u.value.wms_co_id,type:u.value.type,status:u.value.status,brand:u.value.brand};for(let l of u.value.columns)l.name&&(n[l.name]=l.value);return n},z=(n,l)=>{W.value.num=n,W.value.total=l;const a=$.value.getData();d.value.data=[],A.value.data=[],A.value.num=0,B.value.data=[],B.value.num=0,R.value.data=[],R.value.num=0;for(let h of a)h.status==0&&(d.value.data.push(h.id),A.value.data.push(h.id),A.value.num+=parseInt(h.num)),B.value.data.push(h.id),B.value.num+=parseInt(h.num),R.value.data.push(h.id),R.value.num+=parseInt(h.num)},Q=n=>{W.value.order=n,j()},fe=()=>{u.value.time=[V.Date("Y/m/d",V.StrToTime("-1 month")),V.Date("Y/m/d")],u.value.customTime.active="",u.value.key="",u.value.wms_co_id="",u.value.type="",u.value.status="",u.value.brand="";for(let n of u.value.columns)n.value="";W.value.order="",_.value.num=1,j()},ne=()=>{xe(()=>{$.value.checkboxAll(!1)})},ie=n=>{switch(u.value.customTime.active=n,n){case"today":u.value.time=[V.Date("Y/m/d"),V.Date("Y/m/d")];break;case"yesterday":u.value.time=[V.Date("Y/m/d",V.StrToTime("-1 day")),V.Date("Y/m/d",V.StrToTime("-1 day"))];break;case"month":u.value.time=[V.Date("Y/m/d",V.StrToTime("-3 month")),V.Date("Y/m/d")];break;case"year":u.value.time=[V.Date("Y/m/d",V.StrToTime("-1 year")),V.Date("Y/m/d")];break}},ve=(n,l={})=>{m.value.show=!0,m.value.data=l,m.value.data.tp=n,n=="add"?m.value.title=S.add:n=="edit"&&(m.value.title=S.edit+"( "+l.id+" )",m.value.data.id=l.id)},ce=n=>{n&&(m.value.show=!1,j())},Y=()=>{d.value.show=!0},c=n=>{n&&(d.value.show=!1,j())},o=()=>{A.value.show=!0,A.value.info="单号:[ <b>"+A.value.data.join(",")+"</b> ]&nbsp;&nbsp;&nbsp;&nbsp;数量: <b>"+A.value.num+"</b>"},M=n=>{n&&(A.value.show=!1,j())},G=(n,l)=>{b.value.show=!0,b.value.data=[n],b.value.info="单号: <b>"+n+"</b>&nbsp;&nbsp;&nbsp;&nbsp;数量: <b>"+l+"</b>"},X=n=>{n&&(b.value.show=!1,j())},ue=()=>{B.value.show=!0},ge=n=>{n&&(B.value.show=!1,ne())},de=()=>{R.value.show=!0,R.value.title="对比入库单( "+R.value.data.join(",")+" )"},we=n=>{P.value.show=!0,P.value.title=n.wms_co_name+"( "+n.id+" )",P.value.data.id=n.id,P.value.data.ctime=n.ctime,P.value.data.utime=n.utime,P.value.data.wms_co_id=n.wms_co_id,P.value.data.status=n.status,P.value.data.brand=n.brand},x=n=>{n&&(P.value.show=!1,j())},r=n=>{C.value.show=!0,C.value.info={title:"[采退] "+n.wms_co_name,id:n.id,cost_price:n.cost_price,sale_price:n.sale_price,purchase_price:n.purchase_price,market_price:n.market_price,num:n.num,ctime:n.ctime,utime:n.utime,creator_name:n.creator_name,operator_name:n.operator_name,remark:n.remark},C.value.columns=[{label:"商品编码",value:"sku_id",checked:!0,textAlign:"center"},{label:"商品名称",value:"name",checked:!0,textAlign:"center"},{label:"颜色及规格",value:"properties_value",checked:!0},{label:"成本金额(元)",value:"cost_price",checked:!1,price:!0,textAlign:"right"},{label:"标签金额(元)",value:"sale_price",checked:!0,price:!0,textAlign:"right"},{label:"采购金额(W)",value:"purchase_price",checked:!1,price:!0,textAlign:"right"},{label:"吊牌金额(W)",value:"market_price",checked:!0,price:!0,textAlign:"right"},{label:"数量",value:"num",checked:!0,textAlign:"center"},{label:"折扣",value:"ratio",checked:!0,textAlign:"center"},{label:"单位",value:"unit",checked:!0,textAlign:"center"},{label:"重量",value:"weight",checked:!0,textAlign:"center"},{label:"标签",value:"labels",checked:!1,textAlign:"center"},{label:"商品分类",value:"category",checked:!1,textAlign:"center"},{label:"品牌",value:"brand",checked:!0,textAlign:"center"},{label:"采购员",value:"owner",checked:!0,textAlign:"center"},{label:"供应商",value:"supplier_name",checked:!1,textAlign:"center"},{label:"制单员",value:"operator_name",checked:!0,textAlign:"center"},{label:"创建时间",value:"ctime",checked:!0,textAlign:"center"},{label:"更新时间",value:"ctime",checked:!1,textAlign:"center"}];const l=y.Loading();E.Post("erp_purchase_out/goods_list?lang="+N.lang,{token:N.token,id:n.id,ctime:n.ctime,utime:n.utime,wms_co_id:n.wms_co_id},a=>{l.clear();const{code:h,msg:K,data:pe}=a.data;h==0?C.value.data=pe:y.Toast(K)})},e=()=>{E.Post("erp_purchase_out/get_select?lang="+N.lang,{token:N.token},n=>{const{code:l,msg:a,data:h}=n.data;l==0?(T.value.partner_name=h.partner_name,T.value.brand_name=h.brand_name,T.value.type_name=h.type_name,T.value.status_name=h.status_name,O.value=!0):y.Toast(a)})};return(n,l)=>(v(),f(q,null,[p(Ve,{time:k.value.time,onRefresh:l[0]||(l[0]=a=>j())},{default:t(()=>[l[35]||(l[35]=g(" 标签金额: ",-1)),s("b",null,i(w(U)(k.value.list.sale_price)),1),l[36]||(l[36]=g(" 元   吊牌金额: ",-1)),s("b",null,i(w(U)(k.value.list.market_price)),1),l[37]||(l[37]=g(" W   数量: ",-1)),s("b",null,i(k.value.list.num),1),l[38]||(l[38]=g("   ",-1))]),_:1},8,["time"]),s("div",zl,[s("div",Gl,[p(Ne,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line1"},{action:"push",slot:"push",is_action:!0},{action:"line",slot:"line2"},{action:"export",slot:"export",is_action:!0},{action:"diff",slot:"diff",is_action:!1}]},{add:t(()=>[p(H,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:l[1]||(l[1]=a=>ve("add"))},{default:t(()=>[g(i(w(S).add),1)]),_:1})]),del:t(()=>[p(H,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:d.value.data.length==0,onClick:l[2]||(l[2]=a=>Y())},{default:t(()=>[g(i(w(S).del)+"("+i(d.value.data.length)+")",1)]),_:1},8,["disabled"])]),line1:t(()=>[w(D)("save")?(v(),f("span",ql,"|")):le("",!0)]),push:t(()=>[p(H,{effect:"plain",type:"primary",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:A.value.data.length==0,onClick:l[3]||(l[3]=a=>o())},{default:t(()=>[g("推送("+i(A.value.data.length)+")",1)]),_:1},8,["disabled"])]),line2:t(()=>[w(D)("push")?(v(),f("span",Jl,"|")):le("",!0)]),export:t(()=>[p(H,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:B.value.data.length==0,onClick:l[4]||(l[4]=a=>ue())},{default:t(()=>[g(i(w(S).export)+"("+i(B.value.num)+")",1)]),_:1},8,["disabled"])]),diff:t(()=>[p(H,{effect:"plain",icon:"ui ui_safety",padding:"0 16px 0 8px",disabled:R.value.data.length==0,onClick:l[5]||(l[5]=a=>de())},{default:t(()=>[g("对比("+i(R.value.num)+")",1)]),_:1},8,["disabled"])]),_:1})]),s("div",Ql,[p(Fe,{show:u.value.show,"onUpdate:show":l[11]||(l[11]=a=>u.value.show=a),keys:u.value.key,"onUpdate:keys":l[12]||(l[12]=a=>u.value.key=a),columns:u.value.columns,placeholder:u.value.placeholder,onKeyup:l[13]||(l[13]=ke(a=>{_.value.num=1,j()},["enter"])),onSearch:l[14]||(l[14]=a=>{_.value.num=1,j()}),onReset:l[15]||(l[15]=a=>fe())},{customTime:t(a=>[s("ul",Xl,[(v(!0),f(q,null,be(u.value.customTime.list,h=>(v(),f("li",{key:h.value,onClick:K=>ie(h.value),class:Se({active:u.value.customTime.active===h.value})},i(h.label),11,Zl))),128))])]),time:t(a=>[p(Me,{value:u.value.time,"onUpdate:value":l[6]||(l[6]=h=>u.value.time=h),range:"",maxDate:u.value.maxDate,placeholder:a.label},null,8,["value","maxDate","placeholder"])]),wms_co_id:t(a=>[p(me,{value:u.value.wms_co_id,"onUpdate:value":l[7]||(l[7]=h=>u.value.wms_co_id=h),options:T.value.partner_name,placeholder:a.label,clearable:"",multiple:""},null,8,["value","options","placeholder"])]),type:t(a=>[p(me,{value:u.value.type,"onUpdate:value":l[8]||(l[8]=h=>u.value.type=h),options:T.value.type_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),status:t(a=>[p(me,{value:u.value.status,"onUpdate:value":l[9]||(l[9]=h=>u.value.status=h),options:T.value.status_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),brand:t(a=>[p(me,{value:u.value.brand,"onUpdate:value":l[10]||(l[10]=h=>u.value.brand=h),options:T.value.brand_name,placeholder:a.label,clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["show","keys","columns","placeholder"])])]),s("div",es,[p(he,{ref_key:"tableList",ref:$,overflow:"auto",columns:W.value.columns,options:W.value.data,onOrderBy:Q,onPartially:z},{id:t(a=>[s("div",ts,i(a.id),1)]),date:t(a=>[s("div",ls,[p(Ue,{title:"创建: "+a.ctime+`
更新: `+a.utime+`
制单: `+a.creator_name+", 审核: "+a.operator_name+`
备注: `+a.remark},{default:t(()=>[g(i(a.ctime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:t(a=>[s("div",ss,i(a.type_name),1)]),brand:t(a=>[s("div",as,i(a.brand),1)]),sale_price:t(a=>[s("div",os,i(a.sale_price>0?w(U)(a.sale_price):"-"),1)]),market_price:t(a=>[s("div",ns,i(a.market_price>0?w(U)(a.market_price):"-"),1)]),num:t(a=>[s("div",is,i(a.num),1)]),total:t(a=>[s("div",us,i(a.total),1)]),status:t(a=>[a.status=="0"?(v(),f("div",ds,i(a.status_name),1)):a.status=="1"?(v(),f("div",rs,i(a.status_name),1)):a.status=="2"?(v(),f("div",ps,i(a.status_name),1)):(v(),f("div",ms,i(a.status_name),1))]),action:t(a=>[s("div",vs,[w(D)("save")&&a.state=="0"?(v(),Z(H,{key:0,onClick:h=>ve("edit",a)},{default:t(()=>[g(i(w(S).edit),1)]),_:1},8,["onClick"])):w(D)("save")&&a.state=="1"?(v(),Z(H,{key:1,type:"danger",effect:"text",onClick:h=>G(a.id,a.num)},{default:t(()=>[...l[39]||(l[39]=[g("撤回",-1)])]),_:1},8,["onClick"])):(v(),f("span",cs,[...l[40]||(l[40]=[s("i",{class:"ui ui_safety"},null,-1)])]))])]),goods:t(a=>[s("div",_s,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:h=>we(a)},{default:t(()=>[...l[41]||(l[41]=[g("商品",-1)])]),_:1},8,["onClick"])])]),print:t(a=>[s("div",fs,[p(H,{type:"primary",effect:"text",padding:"0 4px",onClick:h=>r(a),disabled:a.num==0},{default:t(()=>[g(i(w(S).print),1)]),_:1},8,["onClick","disabled"])])]),_:1},8,["columns","options"])]),s("div",gs,[p(je,{total:_.value.total,"onUpdate:total":l[16]||(l[16]=a=>_.value.total=a),page:_.value.num,"onUpdate:page":[l[17]||(l[17]=a=>_.value.num=a),l[18]||(l[18]=a=>j())],limit:_.value.limit,"onUpdate:limit":[l[19]||(l[19]=a=>_.value.limit=a),l[20]||(l[20]=a=>{_.value.num=1,j()})]},null,8,["total","page","limit"])]),p(Oe,{show:m.value.show,"onUpdate:show":l[21]||(l[21]=a=>m.value.show=a),title:m.value.title,data:m.value.data,onSubmit:l[22]||(l[22]=a=>ce(a))},null,8,["show","title","data"]),p(ze,{show:d.value.show,"onUpdate:show":l[23]||(l[23]=a=>d.value.show=a),data:d.value.data,onSubmit:l[24]||(l[24]=a=>c(a))},null,8,["show","data"]),p(qe,{show:A.value.show,"onUpdate:show":l[25]||(l[25]=a=>A.value.show=a),title:A.value.title,info:A.value.info,data:A.value.data,onSubmit:l[26]||(l[26]=a=>M(a))},null,8,["show","title","info","data"]),p(Qe,{show:b.value.show,"onUpdate:show":l[27]||(l[27]=a=>b.value.show=a),title:b.value.title,info:b.value.info,data:b.value.data,onSubmit:l[28]||(l[28]=a=>X(a))},null,8,["show","title","info","data"]),p(Ze,{show:B.value.show,"onUpdate:show":l[29]||(l[29]=a=>B.value.show=a),data:B.value.data,num:B.value.num,onSubmit:l[30]||(l[30]=a=>ge(a))},null,8,["show","data","num"]),p(Kl,{show:R.value.show,"onUpdate:show":l[31]||(l[31]=a=>R.value.show=a),title:R.value.title,data:R.value.data,num:R.value.num},null,8,["show","title","data","num"]),p(Xt,{show:P.value.show,"onUpdate:show":l[32]||(l[32]=a=>P.value.show=a),title:P.value.title,data:P.value.data,onSubmit:l[33]||(l[33]=a=>x(a))},null,8,["show","title","data"]),p(Ee,{show:C.value.show,"onUpdate:show":l[34]||(l[34]=a=>C.value.show=a),title:C.value.title,info:C.value.info,columns:C.value.columns,data:C.value.data},null,8,["show","title","info","columns","data"])],64))}}),As=Ce(xs,[["__scopeId","data-v-fb0a078d"]]);export{As as default};
