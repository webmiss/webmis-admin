import{d as F,g as oe,r as _,w as j,y as Z,n as B,s as ee,i as o,f as m,p as V,A as ie,t as y,o as b,_ as J,u as O,c as z,a as u,e as Q,G as ue,h as de,b as f,j as H,k as X,l as U,m as L,U as $,R,S as W,F as re,T as P,z as me,C as pe,D as ve,E as ge,x as ce}from"./index-CJjQp9e8.js";import{w as fe,a as ye,f as G,b as we,c as xe,d as _e,e as ke,P as be}from"./index-CD7-TaBm.js";import{w as he}from"./index-u7Uf1dQH.js";import{w as Se}from"./view-68KWnSYC.js";import{w as Ce}from"./Total-QVPIQqvP.js";import{w as $e}from"./index-BYFiKpUE.js";const Ue={ref:"wmImage"},Te=F({__name:"index",props:{img:{type:String,default:""},imgTitle:{type:String,default:""},width:{type:String,default:"32px"},height:{type:String,default:"32px"},radius:{type:String,default:"50%"},bgColor:{type:String,default:"#00000010"},icoSize:{type:String,default:"18px"},icoColor:{type:String,default:"#00000050"},isView:{type:Boolean,default:!0},redNum:{type:String,default:""},redBgColor:{type:String,default:"#FF3300"}},emits:["imgClick"],setup(g,{emit:A}){const d=g,{proxy:T}=oe(),S=A,l=_(!1),p=_(""),i=_(!1),h=_([]);j(()=>d.img,s=>{x()},{deep:!0}),Z(()=>{x()});const x=()=>{const s=T.$refs.wmImage;s.src=d.img,s.onload=()=>{l.value=!0,p.value=d.img}},a=s=>{S("imgClick",s),d.isView&&(i.value=!0,h.value=[{label:d.imgTitle||s,value:s}])};return(s,v)=>(b(),B(ee,null,[o("div",{class:"wm-image",style:V({width:g.width,height:g.height,lineHeight:"calc("+g.height+" + 4px)",borderRadius:g.radius,backgroundColor:g.bgColor})},[g.redNum!=""?(b(),B("span",{key:0,class:"rednum",style:V({backgroundColor:g.redBgColor})},y(g.redNum),5)):ie("",!0),o("img",Ue,null,512),g.img?l.value?(b(),B("div",{key:3,class:"img",style:V({backgroundImage:p.value?"url("+g.img+")":"",borderRadius:g.radius}),onClick:v[0]||(v[0]=D=>a(g.img))},null,4)):(b(),B("i",{key:2,class:"ui ui_loading loading",style:V({fontSize:g.icoSize})},null,4)):(b(),B("i",{key:1,class:"ui ui_image",style:V({fontSize:g.icoSize,color:g.icoColor})},null,4))],4),m(Se,{show:i.value,"onUpdate:show":v[1]||(v[1]=D=>i.value=D),options:h.value},null,8,["show","options"])],64))}}),De=J(Te,[["__scopeId","data-v-5f34c672"]]),Ie={class:"label"},Ae={colspan:"3"},Le={class:"label"},Pe={class:"label"},Be={colspan:"4",class:"c_info"},Re={class:"label"},He={colspan:"3"},ze={class:"label"},Me={class:"label"},Ne={class:"label"},Ye={class:"label"},Ve={class:"label"},Fe={colspan:"3"},We=F({__name:"save",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Object,default:{}}},emits:["update:show","submit"],setup(g,{emit:A}){const d=g,T=A,l=O().state,p=l.langs,i=_(!1),h=_("base"),x=_([{label:p.info,value:"base",slot:"base"},{label:p.sys_user_role,value:"sole",slot:"sole"},{label:p.sys_user_perm,value:"perm",slot:"perm"}]),a=_({id:0,status:!0,uname:"",passwd:"",type:[],nickname:"",name:"",department:"",position:"",remark:"",role:"",perm:""}),s=_({type:[],role:[],perm:[]});j(()=>d.show,w=>{i.value=w,w&&(a.value.id=d.data.id||0,a.value.status=typeof d.data.status<"u"?d.data.status:!0,a.value.uname=d.data.uname||d.data.tel||d.data.email||"",a.value.passwd=d.data.passwd||"",a.value.nickname=d.data.nickname||"",a.value.name=d.data.name||"",a.value.department=d.data.department||"",a.value.position=d.data.position||"",a.value.remark=d.data.remark||"",v(),a.value.type=typeof d.data.type<"u"?[d.data.type]:[],a.value.role=d.data.role||"",a.value.perm=d.data.perm||"",D())},{deep:!0});const v=()=>{R.Post("sys_user/get_select?lang="+l.lang,{token:l.token},w=>{const n=w.data;n.code==0?(s.value.type=n.data.type,s.value.role=n.data.role,setTimeout(()=>{a.value.type=typeof d.data.type<"u"?[parseInt(d.data.type)]:[],a.value.role=d.data.role||""},300)):$.Toast(n.msg)})},D=()=>{R.Post("sys_user/get_perm?lang="+l.lang,{token:l.token,perm:a.value.perm},w=>{const n=w.data;n.code==0&&(s.value.perm=n.data)})},M=w=>{let n={},r=[];for(let N of w)r=N.split(":"),n[r[0]]?n[r[0]]+=parseInt(r[1]):n[r[0]]=parseInt(r[1]);let I="";for(let N in n)I+=N+":"+n[N].toString()+" ";a.value.perm=I.trim()},C=w=>!W.IsRight("uname",w.uname)&&!W.IsRight("tel",w.uname)&&!W.IsRight("email",w.uname)?$.Toast(p.sys_user_verify_uname):(!w.id||w.passwd)&&!W.IsRight("passwd",w.passwd)?$.Toast(p.sys_user_verify_passwd):w,Y=()=>{const w=C(a.value);if(!w)return;const n=$.Loading();R.Post("sys_user/save?lang="+l.lang,{token:l.token,data:w},r=>{n.clear();const I=r.data;$.Toast(I.msg),T("submit",I.code==0)})},E=()=>{T("update:show",!1)};return(w,n)=>(b(),z(Q,{show:i.value,"onUpdate:show":n[12]||(n[12]=r=>i.value=r),title:g.title,width:"720px",bottom:"40px",overflow:h.value=="perm"?"hidden auto":"hidden",onClose:n[13]||(n[13]=r=>E())},{bottom:u(()=>[m(L,{height:"40px",padding:"0 32px",onClick:n[11]||(n[11]=r=>Y())},{default:u(()=>[U(y(f(p).confirm),1)]),_:1})]),default:u(()=>[m(X,{paddingY:"0"},{default:u(()=>[m(fe,{value:h.value,"onUpdate:value":n[10]||(n[10]=r=>h.value=r),columns:x.value},{base:u(()=>[m(de,null,{default:u(()=>[o("tr",null,[o("td",Ie,y(f(p).status),1),o("td",Ae,[m(ye,{value:a.value.status,"onUpdate:value":n[0]||(n[0]=r=>a.value.status=r)},null,8,["value"])])]),o("tr",null,[o("td",Le,y(f(p).sys_user_uname),1),o("td",null,[m(H,{value:a.value.uname,"onUpdate:value":n[1]||(n[1]=r=>a.value.uname=r),placeholder:f(p).sys_user_uname_placeholder,maxlength:"16"},null,8,["value","placeholder"])]),o("td",Pe,y(f(p).sys_user_passwd),1),o("td",null,[m(H,{value:a.value.passwd,"onUpdate:value":n[2]||(n[2]=r=>a.value.passwd=r),placeholder:f(p).sys_user_passwd_placeholder,maxlength:"32"},null,8,["value","placeholder"])])]),o("tr",null,[o("td",Be,[o("b",null,y(f(p).sys_user_base),1)])]),o("tr",null,[o("td",Re,y(f(p).sys_user_type),1),o("td",He,[m(G,{value:a.value.type,"onUpdate:value":n[3]||(n[3]=r=>a.value.type=r),options:s.value.type},null,8,["value","options"])])]),o("tr",null,[o("td",ze,y(f(p).sys_user_nickname),1),o("td",null,[m(H,{value:a.value.nickname,"onUpdate:value":n[4]||(n[4]=r=>a.value.nickname=r),maxlength:"16"},null,8,["value"])]),o("td",Me,y(f(p).sys_user_name),1),o("td",null,[m(H,{value:a.value.name,"onUpdate:value":n[5]||(n[5]=r=>a.value.name=r),maxlength:"16"},null,8,["value"])])]),o("tr",null,[o("td",Ne,y(f(p).sys_user_department),1),o("td",null,[m(H,{value:a.value.department,"onUpdate:value":n[6]||(n[6]=r=>a.value.department=r),maxlength:"16"},null,8,["value"])]),o("td",Ye,y(f(p).sys_user_position),1),o("td",null,[m(H,{value:a.value.position,"onUpdate:value":n[7]||(n[7]=r=>a.value.position=r),maxlength:"16"},null,8,["value"])])]),o("tr",null,[o("td",Ve,y(f(p).remark),1),o("td",Fe,[m(H,{value:a.value.remark,"onUpdate:value":n[8]||(n[8]=r=>a.value.remark=r),type:"textarea",height:"120px",maxlength:"32"},null,8,["value"])])])]),_:1})]),sole:u(()=>[m(ue,{value:a.value.role,"onUpdate:value":n[9]||(n[9]=r=>a.value.role=r),options:s.value.role},null,8,["value","options"])]),perm:u(()=>[m($e,{"onUpdate:value":M,options:s.value.perm},null,8,["options"])]),_:1},8,["value","columns"])]),_:1})]),_:1},8,["show","title","overflow"]))}}),je=J(We,[["__scopeId","data-v-dbbab12a"]]),Oe=["innerHTML"],Ee=F({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(g,{emit:A}){const d=g,T=A,l=O().state,p=l.langs,i=_(!1);j(()=>d.show,a=>{i.value=a},{deep:!0});const h=()=>{const a=$.Loading();R.Post("sys_user/del?lang="+l.lang,{token:l.token,data:d.data},s=>{a.clear();const v=s.data;$.Toast(v.msg),T("submit",v.code==0)})},x=()=>{T("update:show",!1)};return(a,s)=>(b(),z(Q,{show:i.value,"onUpdate:show":s[1]||(s[1]=v=>i.value=v),title:g.title||f(p).del,width:"360px",bottom:"40px",onClose:s[2]||(s[2]=v=>x())},{bottom:u(()=>[m(L,{effect:"dark",type:"danger",height:"40px",onClick:s[0]||(s[0]=v=>h())},{default:u(()=>[U(y(f(p).confirm),1)]),_:1})]),default:u(()=>[m(X,{lineHeight:"60px"},{default:u(()=>[o("span",{innerHTML:f(p).del_warn(g.data.length)},null,8,Oe)]),_:1})]),_:1},8,["show","title"]))}}),Ke=["innerHTML"],qe=F({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(g,{emit:A}){const d=g,T=A,l=O().state,p=l.langs,i=_(!1);j(()=>d.show,a=>{i.value=a},{deep:!0});const h=()=>{const a=$.Loading();R.Post("sys_user/export?lang="+l.lang,{token:l.token,data:d.data,order:d.order},s=>{a.clear();const v=s.data;$.Toast(v.msg),v.code==0&&re.Down(v.data.path+v.data.filename,v.data.filename),T("submit",v.code==0)})},x=()=>{T("update:show",!1)};return(a,s)=>(b(),z(Q,{show:i.value,"onUpdate:show":s[1]||(s[1]=v=>i.value=v),title:g.title||f(p).export,width:"360px",bottom:"40px",onClose:s[2]||(s[2]=v=>x())},{bottom:u(()=>[m(L,{height:"40px",padding:"0 32px",onClick:s[0]||(s[0]=v=>h())},{default:u(()=>[U(y(f(p).confirm),1)]),_:1})]),default:u(()=>[m(X,{lineHeight:"60px"},{default:u(()=>[o("span",{innerHTML:f(p).export_warn(g.num)},null,8,Ke)]),_:1})]),_:1},8,["show","title"]))}}),Ge=["innerHTML"],Je={class:"app_action flex"},Qe={class:"app_action_tools scrollbar"},Xe={class:"app_action_search flex"},Ze={class:"app_ct"},et={class:"tCenter"},tt={class:"tCenter"},at={class:"tCenter"},lt={class:"flex_center"},st={class:"tCenter"},nt={class:"tCenter"},ot={key:1},it={key:0,class:"tCenter"},ut={key:1,class:"tCenter"},dt={class:"tCenter"},rt={class:"app_page"},mt=F({__name:"index",setup(g){const A=_(!1),d=_(),S=O().state,l=S.langs,p=be.isAction,i=_({show:!1,key:"",placeholder:"Fid、名称、接口等",time:[P.Date("Y/m/d",P.StrToTime("-1 year")),P.Date("Y/m/d")],maxDate:P.Date("Y/m/d"),columns:[{label:l.select,value:"",slot:"time"},{label:l.sys_user_type,value:"",slot:"type"},{label:l.sys_user_role,value:"",slot:"role"},{label:l.sys_user_uname,value:"",name:"uname"},{label:l.sys_user_nickname,value:"",name:"nickname"},{label:l.sys_user_department,value:"",name:"department"},{label:l.sys_user_position,value:"",name:"position"},{label:l.sys_user_name,value:"",name:"name"},{label:l.remark,value:"",name:"remark"}],type:"",role:""}),h=_({time:"",list:{}}),x=_({columns:[{title:"UID",index:"id",slot:"id",order:"",width:"80px",minWidth:"60px",textAlign:"center"},{title:l.date,index:"date",slot:"date",width:"120px",minWidth:"110px",textAlign:"center"},{title:l.sys_user_type,index:"type",slot:"type",order:"",width:"80px",minWidth:"80px",textAlign:"center"},{title:l.sys_user_image,index:"img",slot:"img",width:"60px",minWidth:"60px",textAlign:"center"},{title:l.sys_user_uname,index:"uname",slot:"uname",order:"",width:"120px"},{title:l.status,index:"status",slot:"status",width:"60px",textAlign:"center"},{title:l.action,index:"action",slot:"action",width:"60px",textAlign:"center"},{title:l.sys_user_perm,index:"perm",slot:"perm",width:"120px",textAlign:"center"},{title:l.sys_user_nickname,index:"nickname"},{title:l.sys_user_department,index:"department"},{title:l.sys_user_position,index:"position"},{title:l.sys_user_name,index:"name"},{title:l.sys_user_gender,index:"gender",slot:"gender",textAlign:"center"},{title:l.sys_user_birthday,index:"birthday"},{title:l.remark,index:"remark"}],data:[],num:0,total:0,order:""}),a=_({total:0,num:1,limit:100}),s=_({show:!1,title:"添加/编辑",type:"",data:{}}),v=_({show:!1,title:"删除",data:[]}),D=_({show:!1,title:"导出",num:0}),M=_({type:[],role:[],perm:[]});Z(()=>{S.token&&ne()}),me(()=>{A&&C()});const C=()=>{i.value.show=!1,x.value.data=[];const c=$.Loading();R.Post("sys_user/list?lang="+S.lang,{token:S.token,data:Y(),page:a.value.num,limit:a.value.limit,order:x.value.order},e=>{c.clear();const{code:t,msg:k,time:K,data:q}=e.data;t===0?(h.value.time=K,x.value.data=q,r()):$.Toast(k)}),a.value.total=0,R.Post("sys_user/total?lang="+S.lang,{token:S.token,data:Y()},e=>{const{code:t,msg:k,time:K,data:q}=e.data;t==0?(h.value.time=K,a.value.total=q.total):$.Toast(k)})},Y=()=>{const c={key:i.value.key,stime:typeof i.value.time[0]=="string"?i.value.time[0]:P.Date("Y/m/d",i.value.time[0]),etime:typeof i.value.time[1]=="string"?i.value.time[1]:P.Date("Y/m/d",i.value.time[1]),type:i.value.type,role:i.value.role};for(let e of i.value.columns)e.name&&(c[e.name]=e.value);return c},E=(c,e)=>{x.value.num=c,x.value.total=e},w=c=>{x.value.order=c,C()},n=()=>{i.value.time=[P.Date("Y/m/d",P.StrToTime("-3 year")),P.Date("Y/m/d")],i.value.key="",i.value.type="",i.value.role="";for(let c of i.value.columns)c.value="";x.value.order="",a.value.num=1,C()},r=()=>{ve(()=>{d.value.checkboxAll(!1)})},I=(c,e)=>{s.value.show=!0,s.value.type=c,c=="add"?(s.value.title=l.add,s.value.data={}):c=="edit"?(s.value.title=l.edit+"( "+(e.uname||e.tel||e.email||"")+" )",s.value.data=e):c=="copy"&&(s.value.title=l.copy,e.id="",e.uname="",e.tel="",e.email="",s.value.data=e)},N=c=>{c&&(s.value.show=!1,C())},te=()=>{v.value.show=!0;const c=d.value.getData();let e=[];for(let t of c)e.push(t.id);v.value.data=e},ae=c=>{c&&(v.value.show=!1,C())},le=c=>{D.value.show=!0,D.value.num=c},se=c=>{c&&(D.value.show=!1,r())},ne=()=>{R.Post("sys_user/get_select?lang="+S.lang,{token:S.token},c=>{const{code:e,msg:t,data:k}=c.data;e==0?(M.value.type=k.type,M.value.role=k.role,A.value=!0,C()):$.Toast(t)})};return(c,e)=>(b(),B(ee,null,[m(Ce,{time:h.value.time,onRefresh:e[0]||(e[0]=t=>C())},{default:u(()=>[o("span",{innerHTML:f(l).sys_user_total(a.value.total)},null,8,Ge)]),_:1},8,["time"]),o("div",Je,[o("div",Qe,[m(we,{columns:[{action:"save",slot:"add",is_action:!0},{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0}]},{add:u(()=>[m(L,{effect:"dark",type:"primary",icon:"ui ui_add",padding:"0 16px 0 8px",onClick:e[1]||(e[1]=t=>I("add"))},{default:u(()=>[U(y(f(l).add),1)]),_:1})]),del:u(()=>[m(L,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:x.value.num==0,onClick:e[2]||(e[2]=t=>te())},{default:u(()=>[U(y(f(l).del)+"("+y(x.value.num)+")",1)]),_:1},8,["disabled"])]),line:u(()=>e[23]||(e[23]=[o("span",{class:"line"},"|",-1)])),export:u(()=>[m(L,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!a.value.total,onClick:e[3]||(e[3]=t=>le(a.value.total))},{default:u(()=>[U(y(f(l).export)+"("+y(a.value.total)+")",1)]),_:1},8,["disabled"])]),_:1})]),o("div",Xe,[m(xe,{show:i.value.show,"onUpdate:show":e[7]||(e[7]=t=>i.value.show=t),keys:i.value.key,"onUpdate:keys":e[8]||(e[8]=t=>i.value.key=t),columns:i.value.columns,onKeyup:e[9]||(e[9]=pe(t=>C(),["enter"])),onSearch:e[10]||(e[10]=t=>C()),onReset:e[11]||(e[11]=t=>n())},{time:u(t=>[m(ge,{value:i.value.time,"onUpdate:value":e[4]||(e[4]=k=>i.value.time=k),range:"",maxDate:i.value.maxDate,placeholder:t.label},null,8,["value","maxDate","placeholder"])]),type:u(t=>[m(G,{value:i.value.type,"onUpdate:value":e[5]||(e[5]=k=>i.value.type=k),options:M.value.type,placeholder:t.label,clearable:""},null,8,["value","options","placeholder"])]),role:u(t=>[m(G,{value:i.value.role,"onUpdate:value":e[6]||(e[6]=k=>i.value.role=k),options:M.value.role,placeholder:t.label,clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["show","keys","columns"])])]),o("div",Ze,[m(_e,{ref_key:"tableList",ref:d,overflow:"auto",columns:x.value.columns,options:x.value.data,onOrderBy:w,onPartially:E},{id:u(t=>[o("div",et,y(t.id),1)]),date:u(t=>[o("div",tt,[m(he,{title:"注册: "+t.rtime+`
更新: `+t.utime+`
登录: `+t.ltime+`
备注: `+t.remark},{default:u(()=>[U(y(t.ltime.substr(0,10)),1)]),_:2},1032,["title"])])]),type:u(t=>[o("div",at,y(t.type_name||"-"),1)]),img:u(t=>[o("div",lt,[m(De,{img:t.img,"onUpdate:img":k=>t.img=k},null,8,["img","onUpdate:img"])])]),uname:u(t=>[U(y(t.uname||t.tel||t.email),1)]),status:u(t=>[o("div",st,[o("span",{class:ce(t.status?"c_success":"c_danger")},y(t.status?f(l).enable:f(l).disable),3)])]),action:u(t=>[o("div",nt,[f(p)("save")?(b(),z(L,{key:0,onClick:k=>I("copy",t)},{default:u(()=>[U(y(f(l).copy),1)]),_:2},1032,["onClick"])):(b(),B("span",ot,"-"))])]),perm:u(t=>[f(p)("save")?(b(),B("div",it,[t.perm?(b(),z(L,{key:0,effect:"text",type:"danger",padding:"0 8px",onClick:k=>I("edit",t)},{default:u(()=>e[24]||(e[24]=[U("私有")])),_:2},1032,["onClick"])):t.role?(b(),z(L,{key:1,effect:"text",type:"primary",padding:"0 8px",onClick:k=>I("edit",t)},{default:u(()=>[U(y(t.role_name),1)]),_:2},1032,["onClick"])):(b(),z(L,{key:2,effect:"text",type:"info",padding:"0 8px",onClick:k=>I("edit",t)},{default:u(()=>e[25]||(e[25]=[U("设置")])),_:2},1032,["onClick"]))])):(b(),B("div",ut,"-"))]),gender:u(t=>[o("div",dt,y(t.gender||"-"),1)]),_:1},8,["columns","options"])]),o("div",rt,[m(ke,{total:a.value.total,"onUpdate:total":e[12]||(e[12]=t=>a.value.total=t),page:a.value.num,"onUpdate:page":[e[13]||(e[13]=t=>a.value.num=t),e[14]||(e[14]=t=>C())],limit:a.value.limit,"onUpdate:limit":[e[15]||(e[15]=t=>a.value.limit=t),e[16]||(e[16]=t=>{a.value.num=1,C()})]},null,8,["total","page","limit"])]),m(je,{show:s.value.show,"onUpdate:show":e[17]||(e[17]=t=>s.value.show=t),title:s.value.title,data:s.value.data,onSubmit:e[18]||(e[18]=t=>N(t))},null,8,["show","title","data"]),m(Ee,{show:v.value.show,"onUpdate:show":e[19]||(e[19]=t=>v.value.show=t),data:v.value.data,onSubmit:e[20]||(e[20]=t=>ae(t))},null,8,["show","data"]),m(qe,{show:D.value.show,"onUpdate:show":e[21]||(e[21]=t=>D.value.show=t),data:Y(),order:x.value.order,num:D.value.num,onSubmit:e[22]||(e[22]=t=>se(t))},null,8,["show","data","order","num"])],64))}}),wt=J(mt,[["__scopeId","data-v-cbad2c45"]]);export{wt as default};
