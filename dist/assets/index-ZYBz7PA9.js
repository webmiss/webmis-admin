import{d as H,u as M,r as k,w as V,c as F,a as n,b as f,e as I,f as v,i as p,k as z,l as D,t as w,m as L,U as C,R as A,o as Y,F as X,T as i,y as Z,z as ee,n as U,D as te,E as ae,s as N,G as oe,B as le,H as se,v as ne,x as ie,I as ue,Q as R}from"./index-CkPR886e.js";import{w as de,a as re,b as me,P as ve}from"./Search-Cqah4TYq.js";import{w as pe}from"./Total-CTn3KGGG.js";const ce=["innerHTML"],fe=H({__name:"del",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},data:{type:Array,default:[]}},emits:["update:show","submit"],setup(y,{emit:S}){const g=y,$=S,r=M().state,h=r.langs,a=k(!1);V(()=>g.show,o=>{a.value=o},{deep:!0});const _=()=>{const o=C.Loading();A.Post("erp_goods_log/del?lang="+r.lang,{token:r.token,data:g.data},l=>{o.clear();const{code:u,msg:c}=l.data;C.Toast(c),$("submit",u==0)})},d=()=>{$("update:show",!1)};return(o,l)=>(Y(),F(I,{show:a.value,"onUpdate:show":l[1]||(l[1]=u=>a.value=u),title:y.title||f(h).del,width:"360px",bottom:"40px",onClose:l[2]||(l[2]=u=>d())},{bottom:n(()=>[v(L,{effect:"dark",type:"danger",height:"40px",onClick:l[0]||(l[0]=u=>_())},{default:n(()=>[D(w(f(h).confirm),1)]),_:1})]),default:n(()=>[v(z,{lineHeight:"60px"},{default:n(()=>[p("span",{innerHTML:f(h).del_warn(y.data.length)},null,8,ce)]),_:1})]),_:1},8,["show","title"]))}}),we=["innerHTML"],ge=H({__name:"export",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},num:{type:Number,default:0},data:{type:Object,default:{}},order:{type:String,default:""}},emits:["update:show","submit"],setup(y,{emit:S}){const g=y,$=S,r=M().state,h=r.langs,a=k(!1);V(()=>g.show,o=>{a.value=o},{deep:!0});const _=()=>{const o=C.Loading();A.Post("erp_goods_log/export?lang="+r.lang,{token:r.token,data:g.data,order:g.order},l=>{o.clear();const{code:u,msg:c,data:b}=l.data;C.Toast(c),u==0&&X.Down(b.path+b.filename,b.filename),$("submit",u==0)})},d=()=>{$("update:show",!1)};return(o,l)=>(Y(),F(I,{show:a.value,"onUpdate:show":l[1]||(l[1]=u=>a.value=u),title:y.title||f(h).export,width:"360px",bottom:"40px",onClose:l[2]||(l[2]=u=>d())},{bottom:n(()=>[v(L,{height:"40px",padding:"0 32px",onClick:l[0]||(l[0]=u=>_())},{default:n(()=>[D(w(f(h).confirm),1)]),_:1})]),default:n(()=>[v(z,{lineHeight:"60px"},{default:n(()=>[p("span",{innerHTML:f(h).export_warn(y.num)},null,8,we)]),_:1})]),_:1},8,["show","title"]))}}),xe=["innerHTML"],_e={class:"app_action flex"},ke={class:"app_action_tools scrollbar"},he={key:0,class:"line"},ye={class:"app_action_search flex"},be={class:"custom_time flex_center"},Te=["onClick"],De={class:"app_ct"},Ce={class:"tCenter"},Se={class:"tCenter"},$e={class:"copy"},Ye=["onClick"],Le={class:"tCenter"},Ue={class:"tCenter"},Ae={class:"app_page"},Pe=H({__name:"index",setup(y){const S=k(!1),g=k(),x=M().state,r=x.langs,h=ve.isAction,a=k({show:!1,key:"",placeholder:"商品编码、内容",time:[i.Date("Y/m/d",i.StrToTime("-7 day")),i.Date("Y/m/d")],maxDate:i.Date("Y/m/d"),customTime:{active:"",list:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"3个月",value:"month"},{label:"近1年",value:"year"}]},columns:[{label:"",value:"",slot:"customTime"},{label:r.select,value:"",slot:"time"},{label:"商品编码, 多条空格分离",value:"",name:"sku_id"},{label:"操作员",value:"",name:"operator"},{label:"内容",value:"",name:"content"}]}),_=k({time:"",list:{num:0}}),d=k({columns:[{title:"ID",index:"id",slot:"id",width:"100px",textAlign:"center"},{title:r.date,slot:"date",width:"150px",textAlign:"center"},{title:r.goods_sku_id,slot:"sku_id",index:"sku_id",order:"",width:"150px",textAlign:"center"},{title:r.view,slot:"view",textAlign:"center",width:"40px"},{title:"UID",slot:"operator_id",width:"60px",textAlign:"center"},{title:"操作员名称",index:"operator_name",width:"100px"},{title:"内容",index:"content"}],data:[],num:0,total:0,order:""}),o=k({total:0,num:1,limit:100}),l=k({show:!1,title:"删除",data:[]}),u=k({show:!1,title:"导出",num:0});Z(()=>{S.value=!0}),ee(()=>{S&&x.isLogin&&c()});const c=()=>{a.value.show=!1,d.value.data=[];const s=C.Loading();A.Post("erp_goods_log/list?lang="+x.lang,{token:x.token,data:b(),page:o.value.num,limit:o.value.limit,order:d.value.order},e=>{s.clear();const{code:t,msg:m,data:T,time:B}=e.data;t==0?(_.value.time=B,d.value.data=T,P()):C.Toast(m)}),o.value.total=0,_.value.list.num=0,A.Post("erp_goods_log/total?lang="+x.lang,{token:x.token,data:b()},e=>{const{code:t,msg:m,data:T,time:B}=e.data;t==0?(_.value.time=B,o.value.total=T.total,_.value.list.num=T.total):C.Toast(m)})},b=()=>{const s={key:a.value.key,stime:typeof a.value.time[0]=="string"?a.value.time[0]:i.Date("Y/m/d",a.value.time[0]),etime:typeof a.value.time[1]=="string"?a.value.time[1]:i.Date("Y/m/d",a.value.time[1])};for(let e of a.value.columns)e.name&&(s[e.name]=e.value);return s},E=(s,e)=>{d.value.num=s,d.value.total=e},K=s=>{d.value.order=s,c()},O=()=>{a.value.time=[i.Date("Y/m/d",i.StrToTime("-1 month")),i.Date("Y/m/d")],a.value.customTime.active="",a.value.key="";for(let s of a.value.columns)s.value="";d.value.order="",o.value.num=1,c()},P=()=>{oe(()=>{d.value.num=0,g.value.checkboxAll(!1)})},j=s=>{switch(a.value.customTime.active=s,s){case"today":a.value.time=[i.Date("Y/m/d"),i.Date("Y/m/d")];break;case"yesterday":a.value.time=[i.Date("Y/m/d",i.StrToTime("-1 day")),i.Date("Y/m/d",i.StrToTime("-1 day"))];break;case"month":a.value.time=[i.Date("Y/m/d",i.StrToTime("-3 month")),i.Date("Y/m/d")];break;case"year":a.value.time=[i.Date("Y/m/d",i.StrToTime("-1 year")),i.Date("Y/m/d")];break}},q=()=>{l.value.show=!0;const s=g.value.getData();let e=[];for(let t of s)e.push(t.id);l.value.data=e},G=s=>{s&&(l.value.show=!1,c())},Q=s=>{u.value.show=!0,u.value.num=s},W=s=>{s&&(u.value.show=!1,P())},J=(s,e)=>{const t=g.value.getData();let m="";for(let T in t)m+=t[T][s]+" ";m?R.CopyText(m):R.CopyText(e)};return(s,e)=>(Y(),U(N,null,[v(pe,{time:_.value.time,onRefresh:e[0]||(e[0]=t=>c())},{default:n(()=>[p("span",{innerHTML:f(r).total_info(_.value.list.num)},null,8,xe)]),_:1},8,["time"]),p("div",_e,[p("div",ke,[v(de,{columns:[{action:"del",slot:"del",is_action:!0},{action:"line",slot:"line"},{action:"export",slot:"export",is_action:!0}]},{del:n(()=>[v(L,{effect:"plain",type:"danger",icon:"ui ui_del",padding:"0 16px 0 8px",disabled:d.value.num==0,onClick:e[1]||(e[1]=t=>q())},{default:n(()=>[D(w(f(r).del)+"("+w(d.value.num)+")",1)]),_:1},8,["disabled"])]),line:n(()=>[f(h)("del")?(Y(),U("span",he,"|")):le("",!0)]),export:n(()=>[v(L,{effect:"plain",icon:"ui ui_export",padding:"0 16px 0 8px",disabled:!o.value.total,onClick:e[2]||(e[2]=t=>Q(o.value.total))},{default:n(()=>[D(w(f(r).export)+"("+w(o.value.total)+")",1)]),_:1},8,["disabled"])]),_:1})]),p("div",ye,[v(re,{show:a.value.show,"onUpdate:show":e[4]||(e[4]=t=>a.value.show=t),keys:a.value.key,"onUpdate:keys":e[5]||(e[5]=t=>a.value.key=t),columns:a.value.columns,placeholder:a.value.placeholder,onKeyup:e[6]||(e[6]=te(t=>{o.value.num=1,c()},["enter"])),onSearch:e[7]||(e[7]=t=>{o.value.num=1,c()}),onReset:e[8]||(e[8]=t=>O())},{customTime:n(t=>[p("ul",be,[(Y(!0),U(N,null,ne(a.value.customTime.list,m=>(Y(),U("li",{key:m.value,onClick:T=>j(m.value),class:ie({active:a.value.customTime.active===m.value})},w(m.label),11,Te))),128))])]),time:n(t=>[v(se,{value:a.value.time,"onUpdate:value":e[3]||(e[3]=m=>a.value.time=m),range:"",maxDate:a.value.maxDate,placeholder:t.label},null,8,["value","maxDate","placeholder"])]),_:1},8,["show","keys","columns","placeholder"])])]),p("div",De,[v(ae,{ref_key:"tableList",ref:g,overflow:"auto",columns:d.value.columns,options:d.value.data,onOrderBy:K,onPartially:E},{id:n(t=>[p("div",Ce,w(t.id),1)]),date:n(t=>[p("div",Se,[v(ue,{title:"时间: "+t.ctime},{default:n(()=>[D(w(t.ctime),1)]),_:2},1032,["title"])])]),sku_id:n(t=>[p("div",$e,[D(w(t.sku_id),1),p("span",{onClick:m=>J("sku_id",t.sku_id)},"复",8,Ye)])]),view:n(t=>[p("div",Le,[v(L,{type:"primary",effect:"text",padding:"0 4px",onClick:m=>{f(x).goods.show=!0,f(x).goods.sku_id=t.sku_id}},{default:n(()=>[D(w(f(r).goods_flow),1)]),_:2},1032,["onClick"])])]),operator_id:n(t=>[p("div",Ue,w(t.operator_id),1)]),_:1},8,["columns","options"])]),p("div",Ae,[v(me,{total:o.value.total,"onUpdate:total":e[9]||(e[9]=t=>o.value.total=t),page:o.value.num,"onUpdate:page":[e[10]||(e[10]=t=>o.value.num=t),e[11]||(e[11]=t=>c())],limit:o.value.limit,"onUpdate:limit":[e[12]||(e[12]=t=>o.value.limit=t),e[13]||(e[13]=t=>{o.value.num=1,c()})]},null,8,["total","page","limit"])]),v(fe,{show:l.value.show,"onUpdate:show":e[14]||(e[14]=t=>l.value.show=t),data:l.value.data,onSubmit:e[15]||(e[15]=t=>G(t))},null,8,["show","data"]),v(ge,{show:u.value.show,"onUpdate:show":e[16]||(e[16]=t=>u.value.show=t),data:b(),order:d.value.order,num:u.value.num,onSubmit:e[17]||(e[17]=t=>W(t))},null,8,["show","data","order","num"])],64))}});export{Pe as default};
